{{
  limit = 10
  data = []
}}
<% SWITCH cmd %>
    <% CASE 'USER_NOT_FOUND' %>
    {
        "sendMessage": {
            "text": "üåê <b>{{ config.company.name }}</b> –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç:\n\nüí∏ <b>–õ—É—á—à–∏–µ —Ç–∞—Ä–∏—Ñ—ã:</b>\n‚úîÔ∏è –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã.\n‚úîÔ∏è –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö.\n‚úîÔ∏è –®–∏—Ä–æ–∫–æ–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ.\n\nüì≤ <b>–ü—Ä–æ—Å—Ç–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ –ø–∞—Ä—É —à–∞–≥–æ–≤!</b>\n–°–∫–∞—á–∞–π—Ç–µ –Ω–∞—à–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:\n- <a href=\"{{ config.apk.android }}\">üì≤ <b>–î–ª—è Android</b></a>\n- <a href=\"{{ config.apk.ios }}\">üì≤ <b>–î–ª—è iOS</b></a>\n\nüíº <b>–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç –Ω–∞—Å?</b>\n–ú—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –∫–∞—á–µ—Å—Ç–≤–æ –∏ –∑–∞—â–∏—Ç—É, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å—Å—è.\n\n",
            "reply_markup": {
                "inline_keyboard": [
                    [
                        {
                            "text": "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å...",
                            "callback_data": "/register {{ args.0 }}"
                        }
                    ]
                ]
            }
        }
    }
<% CASE '/register' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "shmRegister": {
        "partner_id": "{{ args.0 }}",
        "callback_data": "/start",
        "error": "–û–®–ò–ë–ö–ê: –õ–æ–≥–∏–Ω {{ message.chat.username }} –∏–ª–∏ chat_id {{ message.chat.id }} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    }
}

<% CASE ['/select_service', 'üåê –í—ã–±–æ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö —É—Å–ª—É–≥'] %>
{
    "deleteMessage": { "message_id": "{{ message.message_id }}" }
},
{
    "sendPhoto": {
        "photo": "{{ config.logo.url }}",
        "chat_id": "{{ message.chat.id }}",
        "protect_content": true,
        "caption": "üëã <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <u>{{ user.full_name }}</u>!</b>\n\nüåê <b>{{ config.company.name }}</b> ‚Äî <i>–∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è –≤–∞—à–µ–≥–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏ –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ –æ–Ω–ª–∞–π–Ω-–æ–ø—ã—Ç–∞.</i>\n\nüí° <i>–ú—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –∞ —Ç–∞–∫–∂–µ –≤—ã—Å–æ–∫–æ—Å–∫–æ—Ä–æ—Å—Ç–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É.</i>\n\n‚è≥ <b>–ú—ã —É–∂–µ –ø—Ä–∏—Å—Ç—É–ø–∏–ª–∏ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –≤–∞—à–µ–π —É—Å–ª—É–≥–∏. –≠—Ç–æ –∑–∞–π–º–µ—Ç –≤—Å–µ–≥–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥!</b>\n\nüîí <i>–í—Å–∫–æ—Ä–µ –≤—ã —Å–º–æ–∂–µ—Ç–µ –Ω–∞—Å–ª–∞–¥–∏—Ç—å—Å—è –ø–æ–ª–Ω–æ–π –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å—é –∏ –∑–∞—â–∏—â–µ–Ω–Ω–æ—Å—Ç—å—é –≤ —Å–µ—Ç–∏.</i>",
        "parse_mode": "HTML"
    }
},
{
    "shmServiceOrder": {
        "user_id": "{{ message.chat.id }}",
        "service_id": "1",
        "success": {
            "sendMessage": {
                "chat_id": "{{ message.chat.id }}",
                "text": "‚úÖ <b>–£—Å–ª—É–≥–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!</b>\n\n–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å, —á—Ç–æ–±—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ–∑–¥–∞–Ω–Ω–æ–π —É—Å–ª—É–≥–µ. –ú—ã –∑–∞–±–æ—Ç–∏–º—Å—è –æ –≤–∞—à–µ–º —É–¥–æ–±—Å—Ç–≤–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏! üíº",
                "parse_mode": "HTML",
                "reply_markup": {
                    "inline_keyboard": [
                        [
                            {
                                "text": "üë§ –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å",
                                "callback_data": "/service"
                            }
                        ]
                    ]
                }
            }
        },
        "error": {
    "sendMessage": {
        "chat_id": "{{ message.chat.id }}",
        "text": "‚ùå <b>–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —É—Å–ª—É–≥—É.</b>\n\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π, –µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è. üòî",
        "parse_mode": "HTML",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üîô –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    },
                    {
                        "text": "üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π",
                        "callback_data": "/support"
                    }
                ]
            ]
        }
    }
}


<% CASE ['/start', '/menu', 'üåç –ì–ª–∞–≤–Ω–æ–µ –ú–µ–Ω—é', 'üîÑ –û–±–Ω–æ–≤–∏—Ç—å'] %>
    {{ IF cmd != '/start' }}
    {
        "deleteMessage": { 
            "message_id": {{ message.message_id }} 
        }
    },
    {{ END }}
    {
        "sendPhoto": {
            "photo": "{{ config.logo.url }}",
            "caption": "üëã <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <u>{{ user.full_name }}</u>!</b>\nüåê <b>{{ config.company.name }}</b> ‚Äî –≤–∞—à –Ω–∞–¥—ë–∂–Ω—ã–π –ø–∞—Ä—Ç–Ω—ë—Ä –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏ —É–¥–æ–±–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.\n\n–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è.",
            "parse_mode": "HTML"
        }
    },
    {
        "sendMessage": {
            "text": "üåê <b>{{ config.company.name }}</b> –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç:\n\nüí∏ <b>–õ—É—á—à–∏–µ —Ç–∞—Ä–∏—Ñ—ã:</b>\n‚úîÔ∏è –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã.\n‚úîÔ∏è –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö.\n‚úîÔ∏è –®–∏—Ä–æ–∫–æ–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ.\n\nüì≤ <b>–ü—Ä–æ—Å—Ç–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ –ø–∞—Ä—É —à–∞–≥–æ–≤!</b>\n–°–∫–∞—á–∞–π—Ç–µ –Ω–∞—à–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:\n- <a href=\"{{ config.apk.android }}\">üì≤ <b>–î–ª—è Android</b></a>\n- <a href=\"{{ config.apk.ios }}\">üì≤ <b>–î–ª—è iOS</b></a>\n\nüíº <b>–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç –Ω–∞—Å?</b>\n–ú—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –∫–∞—á–µ—Å—Ç–≤–æ –∏ –∑–∞—â–∏—Ç—É, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å—Å—è.\n\n",
            "reply_markup": {
                 "inline_keyboard": [
                [
                        {
                            "text": "üí∏ –ë–∞–ª–∞–Ω—Å: {{ user.balance }} ‚ÇΩ",
                            "callback_data": "/balance"
                        },
                        {
                            "text": "‚ûï –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å",
                            "web_app": {
                                "url": "{{ config.api.url }}/shm/v1/template/tg_payments?format=html&session_id={{ user.gen_session.id }}"
                            }
                        },
						{
                            "text": "üéüÔ∏è –ü—Ä–æ–º–æ–∫–æ–¥—ã",
                            "web_app": {
                                "url": "{{ config.api.url }}/shm/v1/template/promo_webapp?format=html&session_id={{ user.gen_session.id }}"
                            }
                        }
                    ],
                [
                        {
                            "text": "üõí –ö—É–ø–∏—Ç—å –∫–ª—é—á",
                            "callback_data": "/buy_mz_key"
                        },
                        {
                            "text": "üóù –°–ø–∏—Å–æ–∫ VPN –∫–ª—é—á–µ–π",
                            "callback_data": "/list"
                        }
                    ],
                [
                        {
                            "text": "ü§ù –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞",
                            "callback_data": "/referrals"
                        }
                    ],
                    [
                        {
                            "text": "üìñ –ü–æ–º–æ—â—å",
                            "callback_data": "/help"
                        }
                    ]
                {{ IF message.chat.id == config.telegram_admin.id }},
                [
                    {
                        "text": "üîß –ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/adminmenu"
                    }
                ]
                {{ END }},
                [
                        {
                            "text": "üîÑ –û–±–Ω–æ–≤–∏—Ç—å",
                            "callback_data": "/menu"
                        },
                        {
                            "text": "üîÑ –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞",
                            "callback_data": "/keyboard"
                        }
                    ]
            ]
            },
            "parse_mode": "HTML"
        }
    }


<% CASE ['/keyboard', 'üåç –ú–µ–Ω—é'] %>
{
    "sendPhoto": {
        "photo": "{{ config.logo.url }}", 
        "caption": "üôå <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <u>{{ user.full_name }}</u>!</b>\n\nüîí <b>{{ config.company.name }}</b> ‚Äî –≤–∞—à –Ω–∞–¥—ë–∂–Ω—ã–π —Å–ø—É—Ç–Ω–∏–∫ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞. –ú—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º:\n\nüíé <b>–í—ã–≥–æ–¥–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã:</b>\n‚úîÔ∏è –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å.\n‚úîÔ∏è –ù–∞–¥—ë–∂–Ω–∞—è –∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö.\n‚úîÔ∏è –ü–æ–∫—Ä—ã—Ç–∏–µ –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É.\n\nüì± <b>–ù–∞—á–Ω–∏—Ç–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!</b>\n–°–∫–∞—á–∞–π—Ç–µ –Ω–∞—à–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:\n- <a href=\"{{ config.apk.android }}\">üì± <b>Android</b></a>\n- <a href=\"{{ config.apk.ios }}\">üì± <b>iOS</b></a>\n\nüõ°Ô∏è <b>WireGuard –ø–æ–¥–¥–µ—Ä–∂–∫–∞</b>\n–ü–æ–ª—É—á–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤–∞—à–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:\n- <a href=\"{{ config.apk.wireguard_and }}\">üõ°Ô∏è <b>WireGuard Android</b></a>\n- <a href=\"{{ config.apk.wireguard_ios }}\">üõ°Ô∏è <b>WireGuard iOS</b></a>\n\nüåü <b>–ü–æ—á–µ–º—É –≤—ã–±–∏—Ä–∞—é—Ç –Ω–∞—Å?</b>\n–ú—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –∫–∞—á–µ—Å—Ç–≤–æ –∏ –Ω–µ–ø—Ä–µ–≤–∑–æ–π–¥—ë–Ω–Ω—É—é –∑–∞—â–∏—Ç—É.",
        "parse_mode": "HTML",
        "reply_markup": {
    "keyboard": [
        [
            {
                "text": "üîÑ –û–±–Ω–æ–≤–∏—Ç—å"
            }
        ]
    ],
    "resize_keyboard": true,
    "one_time_keyboard": false
}
    }
}

<% CASE ['/profile'] %>
    {{ us = user.services.list_for_api('usi', args.0) }}
    {{ item = us.id(args.0) }}
    {
        "sendPhoto": {
            "photo": "{{ config.logo.url }}",
            "caption": "üëã <b>–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, <u>{{ user.full_name }}</u>!</b>\n\n–≠—Ç–æ –≤–∞—à–∞ –ø—Ä–æ—Ñ–∏–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:\n",
            "parse_mode": "HTML"
        }
    },
    {
        "sendMessage": {
            "text": "üìá <b>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å:</b>\n\nüí≥ <b>–ë–∞–ª–∞–Ω—Å:</b> {{ user.balance }} ‚ÇΩ\nüìÖ <b>–ê–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞:</b> {{ user.subscription.active ? '–î–∞' : '–ù–µ—Ç' }}\nüóì <b>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏:</b> {{ user.subscription.expiry_date }}\nüíº <b>–¢–∞—Ä–∏—Ñ–Ω—ã–π –ø–ª–∞–Ω:</b> {{ user.tariff.name }}\nüìà <b>–¢–µ–∫—É—â–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å:</b> {{ user.current_speed }} Mbps\nüìä <b>–õ–∏–º–∏—Ç –¥–∞–Ω–Ω—ã—Ö:</b> {{ user.data_limit }} GB\nüîß <b>–¢–µ–∫—É—â–∞—è —É—Å–ª—É–≥–∞:</b> {{ item }}\n\n–ß—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ.",
            "reply_markup": {
                "inline_keyboard": [
                    [
                        {
                            "text": "üîÑ –û–±–Ω–æ–≤–∏—Ç—å",
                            "callback_data": "/profile"
                        },
                        {
                            "text": "üõ† –ò–∑–º–µ–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ",
                            "callback_data": "/switchtariff"
                        }
                    ],
                    [
                        {
                            "text": "üíº –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å",
                            "callback_data": "/editprofile"
                        }
                    ],
                    [
                        {
                            "text": "üìñ –ü–æ–º–æ—â—å",
                            "callback_data": "/help"
                        }
                    ]
                ]
            },
            "parse_mode": "HTML"
        }
    }

<% CASE '/balance' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendMessage": {
        "text": "üí∞ <b>–ë–∞–ª–∞–Ω—Å</b>: {{ user.balance }}\n\n–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø–ª–∞—Ç–∏—Ç—å: <b>{{ user.pays.forecast('blocked',1).total }}</b>",
        "reply_markup" : {
            "inline_keyboard": [
                [
                    {
                        "text": "‚úö –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å",
                        "web_app": {
                            "url": "{{ config.api.url }}/shm/v1/public/tg_payments_webapp?format=html&user_id={{ user.id }}"
                        }
                    }
                ],
                [
                    {
                        "text": "‚ò∞ –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π",
                        "callback_data": "/pays"
                    }
                ],
                [
                    {
                        "text": "üîÑ –û–±–Ω–æ–≤–∏—Ç—å",
                        "callback_data": "/balance"
                    }
                ],
                [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}

<% CASE '/pays' %>
{
    "deleteMessage": { 
        "message_id": {{ message.message_id }} 
    },
    "sendPhoto": {
        "photo": "{{ config.logo.url }}",
        "protect_content": false,
        "parse_mode": "HTML",
        "caption": "üí≥ <b>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π</b> üßæ\n\nüìÖ <i>–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è.</i>\n\nüîΩ <b>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ:</b>\n\n{{ IF user.pays.list_for_api('limit', 1) }}\n{{ FOR item IN ref(user.pays.list_for_api('limit', 1)) }}\n<u>üìÖ <b>–î–∞—Ç–∞:</b> {{ item.date }} | üíµ <b>–°—É–º–º–∞:</b> {{ item.money }} —Ä—É–±.</u>\n{{ END }}\n{{ ELSE }}\n<i>–£ –≤–∞—Å –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è—Ö.</i>\n{{ END }}\n\n<b>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π:</b>",
        "reply_markup": {
            "inline_keyboard": [
                [ { "text": "üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é", "callback_data": "/pays" } ],
                [ 
                    { 
                        "text": "üìä –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
                        "callback_data": "/payment_stats"
                    }
                ],
                [ 
                    { 
                        "text": "üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é",
                        "callback_data": "/menu" 
                    }
                ]
            ]
        }
    }
}

<% CASE '/payment_stats' %>
{
    "deleteMessage": { 
        "message_id": {{ message.message_id }} 
    },
    "sendPhoto": {
        "photo": "{{ config.logo.url }}",
        "protect_content": false,
        "parse_mode": "HTML",
        "caption": "üí≥ <b>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π –∏ –≤—ã–≤–æ–¥–æ–≤</b> üßæ\n\nüìÖ <i>–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è, –≤—ã–≤–æ–¥—ã –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã–µ –±–æ–Ω—É—Å—ã –¥–ª—è –≤–∞—à–µ–≥–æ —É–¥–æ–±—Å—Ç–≤–∞.</i>\n\nüîΩ <b>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ:</b>\n\n{{ IF user.pays.list_for_api('limit', 1) }}\n{{ FOR item IN ref(user.pays.list_for_api('limit', 1)) }}\n<u>üìÖ <b>–î–∞—Ç–∞:</b> {{ item.date }} | üíµ <b>–°—É–º–º–∞:</b> {{ item.money }} —Ä—É–±.</u>\n{{ END }}\n{{ ELSE }}\n<i>–£ –≤–∞—Å –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è—Ö.</i>\n{{ END }}\n\nüîΩ <b>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–≤–æ–¥—ã:</b>\n\n{{ IF wd.list_for_api('limit', 10) | length > 0 }}\n{{ FOR wd IN ref(wd.list_for_api('limit', 10)) }}\n<u>üìÖ <b>–î–∞—Ç–∞:</b> {{ wd.withdraw_date }} | üí∏ <b>–°—É–º–º–∞:</b> {{ wd.cost }} ‚ÇΩ</u>\n{{ END }}\n{{ ELSE }}\n<i>–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –æ –≤—ã–≤–æ–¥–∞—Ö.</i>\n{{ END }}\n\nüîΩ <b>–ù–∞—á–∏—Å–ª–µ–Ω–Ω—ã–µ –±–æ–Ω—É—Å—ã:</b>\n\n{{ IF bonus.list_for_api('limit', 20) | length > 0 }}\n{{ FOR bonus IN ref(bonus.list_for_api('limit', 20)) }}\n<u>üìÖ <b>–î–∞—Ç–∞:</b> {{ bonus.date }} | üéÅ <b>–°—É–º–º–∞:</b> {{ bonus.bonus }} ‚ÇΩ</u>\n{{ END }}\n{{ ELSE }}\n<i>–ù–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤.</i>\n{{ END }}\n\n<b>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π:</b>",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É",
                        "callback_data": "/payment_stats"
                    }
                ],
                [
                    {
                        "text": "üí≥ –ò—Å—Ç–æ—Ä–∏—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π",
                        "callback_data": "/pays"
                    }
                ],
                [
                    {
                        "text": "üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}

<% CASE '/list' %>
{{ hasnotpaidus = ref(user.services.list_for_api('category', '%', 'filter', { 'status' => 'NOT PAID' } )).size }}
{{ hasblocked = ref(user.services.list_for_api('category', '%', 'filter', { 'status' => 'BLOCK' } )).size }}
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendPhoto": {
        "photo": "{{ config.logo.url }}",
		"parse_mode": "HTML",
        "caption": "‚≠êÔ∏è <b>–ú–æ–π ID:</b> {{ user.id }} ‚≠êÔ∏è\n\nüí° –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–∞—à–µ–º –∫–ª—é—á–µ, –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –µ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏–µ.\n\n‚ùáÔ∏è –î–ª—è <b>—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏–ª–∏ –ø—Ä–æ–¥–ª–µ–Ω–∏—è</b> —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –∫–ª—é—á–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å.\n\nüîë <b>–í–∞—à–∏ –∫—É–ø–ª–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏:</b>",
        "reply_markup": {
            "inline_keyboard": [
                {{ FOR item IN ref( user.services.list_for_api( 'category', '%' ) ) }}
                {{ SWITCH item.status }}
                  {{ CASE 'ACTIVE' }}
                  {{ icon = '‚úÖ' }}
                  {{ status = ' –†–∞–±–æ—Ç–∞–µ—Ç' }}
                  {{ CASE 'BLOCK' }}
                  {{ icon = '‚ùå' }}
                  {{ status = ' –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞' }}
                  {{ CASE 'NOT PAID' }}
                  {{ icon = 'üí∞' }}
                  {{ status = ' –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã' }}
                  {{ CASE }}
                  {{ icon = '‚è≥' }}
                  {{ status = ' –û–±—Ä–∞–±–æ—Ç–∫–∞' }}
                {{ END }}
                [
                    {
                        "text": "{{ item.name }} - {{ icon }} {{ status }}",
                        "callback_data": "/service {{ item.user_service_id }}"
                    }
                ],
                {{ END }}
                [
                    {
                        "text": "üõí –ö—É–ø–∏—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á üõí",
                        {{ IF hasnotpaidus > 0 || hasblocked > 0 }}
                            "callback_data": "/hint"
                        {{ ELSE }}
                            "callback_data": "/buy_mz_key"
                        {{ END }}
                    }
                ],
                [
                    {
                        "text": "üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ üîÑ",
                        "callback_data": "/list"
                    }
                ],
                [
                    {
                        "text": "üîå –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫–ª—é—á? üîå",
                        "url": "https://telegra.ph/Instrukciya-dlya-iPhoneiPad-11-27"
                    }
                ],
                [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é ‚á¶",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}


<% CASE '/hint' %>
{
   "answerCallbackQuery": {
        "callback_query_id": {{ callback_query.id }},
        "parse_mode":"HTML",
        "text": "üßê –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ üí≥ –∏–ª–∏ —É–¥–∞–ª–∏—Ç–µ üóëÔ∏è –≤—Å–µ –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ –∏–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏..–≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤–∞—à–µ–π —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏",
        "show_alert": true
    }
}

<% CASE '/service' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{{ item = us.id(args.0) }}
{{ us = user.services.list_for_api( 'usi', args.0 ) }}
{{ sub_url = storage.read('name','vpn_mrzb_' _ args.0 ).subscription_url }}
{{ bytes = http.get("$sub_url/info").used_traffic }}
{{ gb = bytes / 1073741824 FILTER format("%.0f") }}
{{ mb = (bytes % 1073741824) / 1048576 FILTER format("%.0f") }}
{
    "sendPhoto": {
        {{ SWITCH us.status }}
  {{ CASE 'ACTIVE' }}
  {{ icon = '' }}
  {{ status = '–†–∞–±–æ—Ç–∞–µ—Ç' }}
  {{ CASE 'BLOCK' }}
  {{ icon = '' }}
  {{ status = '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞' }}
  {{ CASE 'NOT PAID' }}
  {{ icon = '' }}
  {{ status = '–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã' }}
  {{ CASE }}
  {{ icon = '' }}
  {{ status = '–û–±—Ä–∞–±–æ—Ç–∫–∞' }}
{{ END }}
{{ TEXT = BLOCK }}
<b>–£—Å–ª—É–≥–∞</b>: {{ us.name }}
    {{ IF us.expire }}
<b>–û–ø–ª–∞—á–µ–Ω–∞ –¥–æ</b>: {{ us.expire }}
    {{ END }}
<b>–°—Ç–∞—Ç—É—Å</b>: {{ icon}} {{ status }}
    {{ IF mb == 0 }}
    {{ ELSE}}
        {{ IF gb >= 1 }}
–ò–∑—Ä–∞—Å—Ö–æ–¥–æ–≤–∞–Ω–æ —Ç—Ä–∞—Ñ–∏–∫–∞: {{ gb }} Gb.{{ mb }} Mb
        {{ ELSE }}
–ò–∑—Ä–∞—Å—Ö–æ–¥–æ–≤–∞–Ω–æ —Ç—Ä–∞—Ñ–∏–∫–∞: {{ mb }} Mb
        {{ END }}
    {{ END }}
{{ END }}
        "photo": "https://vpnbot.pro/images/DALL-E-2024-11-30-19-58.jpg",
        "caption": "{{ TEXT.replace('\n','\n') }}",
        "parse_mode": "HTML",
        "reply_markup": {
            "inline_keyboard": [
                {{ IF us.status == 'ACTIVE' }}
                {{ subscription_url = storage.read('name', 'vpn_mrzb_' _ args.0).subscription_url }}
                {{ IF us.category.grep('^(vpn-lt-mz|vpn-sw-mz|vpn-spain-mz)').first }}
                {{ IF subscription_url.grep('^https:').first }}
                [
                    {
                        "text": "üîó –ü–æ–∫–∞–∑–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É",
                        "callback_data": "/show_mz_keys {{ args.0 }}"
                    }
                ],
                {{ ELSE }}
                [
                    {
                        "text": "‚ö†Ô∏è –û–®–ò–ë–ö–ê: –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ SSL –¥–ª—è Marzban",
                        "callback_data": "/menu"
                    }
                ],
                {{ END }}
                {{ ELSE }}
                [
                    {
                        "text": "üóù –°–∫–∞—á–∞—Ç—å –∫–ª—é—á",
                        "callback_data": "/download_qr {{ args.0 }}"
                    },
                    {
                        "text": "üëÅ –ü–æ–∫–∞–∑–∞—Ç—å QR –∫–æ–¥",
                        "callback_data": "/show_qr {{ args.0 }}"
                    }
                ],
                {{ END }}
                {{ END }}
                  {{ IF us.status == 'NOT PAID' || us.status == 'BLOCK' }}
                [
                    {
                        "text": "üí≥ –û–ø–ª–∞—Ç–∏—Ç—å —Å–µ–π—á–∞—Å",
                        "callback_data": "/balance {{ user.pays.forecast('blocked', 1).total }}"
                    }
                ],
                {{ END }}
                {{ IF us.status != 'PROGRESS' }}
                [
                    {
                        "text": "üóë –£–¥–∞–ª–∏—Ç—å —É—Å–ª—É–≥—É",
                        "callback_data": "/delete {{ args.0 }}"
                    }
                ],
                {{ END }}
                [
                    {
                        "text": "üîç –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ VPN",
                        "callback_data": "/xray"
                    }
                ],
				[
                    {
                        "text": "üîÑ –°–º–µ–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ",
                        "callback_data": "/change {{ args.0 }}"
                    }
                ],
                [
                    {
                        "text": "‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É —É—Å–ª—É–≥",
                        "callback_data": "/list"
                    }
                ]
            ]
        }
    }
}

<% CASE ['/pricelist', 'üöÄ –ü—Ä–∞–π—Å –ª–∏—Å—Ç'] %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendPhoto": {
        "photo": "{{ config.logo.url }}",
        "protect_content": true,
        "parse_mode": "HTML",
        "caption": "üí°<b>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É üîê –í—ã–¥–∞—Ç—å VPN:</b>\n",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üîê –í—ã–¥–∞—Ç—å VPN",
                        "callback_data": "/buy_mz_key"
                    }
                ],
                [
                    {
                        "text": "üìã –ú–æ–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–ª—é—á–∏",
                        "callback_data": "/list"
                    }
                ],
                [
                    {
                        "text": "üí¨ –ü–æ–º–æ—â—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞",
                        "callback_data": "/support"
                    }
                ],
                [
                    {
                        "text": "‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}


<% CASE '/buy_mz_key' %>
{{ hasnotpaidus = ref(user.services.list_for_api('category', '%', 'filter',{ 'status' => 'NOT PAID' } )).size }}
{{ hasblocked = ref(user.services.list_for_api('category', '%', 'filter',{ 'status' => 'BLOCK' } )).size }}
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendMessage": {
        "text": "üéâ **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞–Ω –ø–æ–¥–ø–∏—Å–∫–∏!**\n\n–ú—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –≤–∞–º –ª—É—á—à–∏–µ —Ç–∞—Ä–∏—Ñ—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å —Å –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –ø—Ä–æ–±–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞ –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å –æ–¥–∏–Ω –∏–∑ –Ω–∞—à–∏—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.\n\nüí≥ **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?**\n\n1. **–ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥** ‚Äî –ø–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º –Ω–∞ 1 —á–∞—Å –±–µ–∑ –æ–ø–ª–∞—Ç—ã.\n2. **–ü–ª–∞—Ç–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞** ‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ç–∞—Ä–∏—Ñ –∏ –æ–ø–ª–∞—á–∏–≤–∞–π—Ç–µ –µ–≥–æ —É–¥–æ–±–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º.\n\n–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞–Ω, –∫–æ—Ç–æ—Ä—ã–π –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤–∞—Å:",
        "parse_mode": "Markdown",
        "reply_markup": {
            "inline_keyboard": [
                {{ FOR item IN ref(service.api_price_list).nsort('service_id') }}
                    {{ IF item.category == 'vpn-lt-mz' or item.category == 'vpn-sw-mz' or item.category == 'vpn-spain-mz' }}
                        {{ IF item.service_id }}
                            [
                                {
                                    "text": "{{ item.name }} ‚Äî {{ item.cost }} —Ä—É–±/–º–µ—Å",
                                    {{ IF hasnotpaidus > 0 || hasblocked > 0 }}
                                    "callback_data": "/hint"
                                    {{ ELSE }}
                                    "callback_data": "/serviceorder {{ item.service_id }}"
                                    {{ END }}
                                },
                                {
                                    "text": "6 –º–µ—Å ‚Äî {{ item.cost * 6 }} —Ä—É–±.",
                                    {{ IF hasnotpaidus > 0 || hasblocked > 0 }}
                                    "callback_data": "/hint"
                                    {{ ELSE }}
                                    "callback_data": "/serviceorder {{ item.service_id }} 6"
                                    {{ END }}
                                }
                            ],
                        {{ ELSE }}
                            [
                                {
                                    "text": "‚ùå –û—à–∏–±–∫–∞: –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Å–ª—É–≥.",
                                    "callback_data": "/service"
                                }
                            ]
                        {{ END }}
                    {{ END }}
                {{ END }}
                [
                    {
                        "text": "‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}

<% CASE '/serviceorder' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "shmServiceOrder": {
        "service_id": "{{ args.0 }}",
        "callback_data": "/list",
        "cb_not_enough_money": "/menu",
        "error": "–û–®–ò–ë–ö–ê"
    }
},
{
    "answerCallbackQuery": {
        "callback_query_id": {{ callback_query.id }},
        "parse_mode":"HTML",
        "text": "–í–∞—à –∫–ª—é—á —Å–æ–∑–¥–∞–µ—Ç—Å—è...",
        "show_alert": true
    }
}


<% CASE '/notifications_active' %>
{{ item = us.id( args.0 ) }}
{{ subscription_url = storage.read('name','vpn_mrzb_' _ args.0 ).subscription_url }}
{
    "sendMessage": {
        "text": "üéâ <b>–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞!</b>\n\n<b>–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å–ª—É–≥–∏:</b> {{ item.name ? item.name : '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}\n<b>–ù–æ–º–µ—Ä –ø–æ–¥–ø–∏—Å–∫–∏:</b> {{ item.user_service_id ? item.user_service_id : '–ù–µ —É–∫–∞–∑–∞–Ω' }}\n\nüóì <b>–î–∞—Ç–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏:</b> {{ USE date }}{{ date.format(item.created, '%d.%m.%Y–≥. %H:%M') }}\n<b>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</b> {{ USE date }}{{ date.format(item.expire, '%d.%m.%Y–≥. %H:%M') }}\n\n–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–∞—à–µ–π –ø–æ–¥–ø–∏—Å–∫–∏.",
        "parse_mode": "HTML",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üöÄ –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏",
                        "web_app": {
                            "url": "{{ config.api.url }}/shm/v1/template/subscriptions_link?format=html&session_id={{ user.gen_session.id }}&service_id={{ args.0 }}"
                        }
                    }
                ],
                [
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                        "callback_data": "/start"
                    }
                ]
            ]
        }
    }
}


<% CASE '/delete' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendMessage": {
        "text": "ü§î <b>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∏. –£—Å–ª—É–≥—É –Ω–µ–ª—å–∑—è –±—É–¥–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å!</b>",
        "reply_markup" : {
            "inline_keyboard": [
                [
                    {
                        "text": "üß® –î–ê, –£–î–ê–õ–ò–¢–¨! üî•",
                        "callback_data": "/delete_confirmed {{ args.0 }}"
                    }
                ],

                [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/list"
                    }
                ]
            ]
        }
    }
}
<% CASE '/delete_confirmed' %>
{
    "deleteMessage": { 
        "message_id": "{{ message.message_id }}" 
    }
},
{
    "shmServiceDelete": {
        "usi": "{{ args.0 }}",
        "callback_data": "/list",
        "error": "–û–®–ò–ë–ö–ê"
    }
},
{
    "answerCallbackQuery": {
        "callback_query_id": "{{ callback_query.id }}",
        "parse_mode": "HTML",
        "text": "–í–∞—à –∫–ª—é—á —É–¥–∞–ª—è–µ—Ç—Å—è...",
        "show_alert": true
    }
}


<% CASE '/referrals' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendMessage": {
        "text": "ü§ù <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à—É —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É!</b>\n\n–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ <b>{{ config.billing.partner.income_percent }}% –æ—Ç –∫–∞–∂–¥–æ–≥–æ –∏—Ö –ø–ª–∞—Ç–µ–∂–∞</b>.\n\nüîó <b>–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</b>\n<code>{{ config.tg_bot.url }}?start={{ user.id }}</code>\n\n–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å—Å—ã–ª–∫–æ–π —Å –¥—Ä—É–∑—å—è–º–∏!\n\n",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π",
                        "switch_inline_query": "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ {{ config.company.name }} –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π —Å –Ω–∞–º–∏! üõ° {{ config.tg_bot.url }}?start={{ user.id }}"
                    }
                ],
                [
                    {
                        "text": "üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∞—à–∏—Ö –¥–æ—Ö–æ–¥–æ–≤",
                        "callback_data": "/referral_stats"
                    },
                    {
                        "text": "‚ùì –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?",
                        "callback_data": "/referral_help"
                    }
                ],
                [
                    {
                        "text": "üîô –ù–∞–∑–∞–¥",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}

<% CASE '/referral_stats' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendMessage": {
        "text": "üìä <b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∞—à–µ–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã</b>\n\nüë• <b>–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ –¥—Ä—É–∑–µ–π:</b> {{ user.referrals_count }}\nüí≥ <b>–û–±—â–∏–π –¥–æ—Ö–æ–¥ –æ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤:</b> {{ user.get_bonus }} —Ä—É–±.\n\nüîó <b>–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</b>\n<code>{{ config.tg_bot.url }}?start={{ user.id }}</code>\n\nüìà <b>–ö–∞–∫ —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ—Ö–æ–¥?</b>\n–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –±–æ–ª—å—à–µ –¥—Ä—É–∑–µ–π! –ö–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤–∞—à—É –ø—Ä–∏–±—ã–ª—å, –∞ —Ç–∞–∫–∂–µ –ø–æ–º–æ–≥–∞–µ—Ç –≤–∞—à–∏–º –¥—Ä—É–∑—å—è–º –æ—Ç–∫—Ä—ã—Ç—å –¥–æ—Å—Ç—É–ø –∫ –Ω–∞—à–µ–º—É –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–º—É —Å–µ—Ä–≤–∏—Å—É.",
        "parse_mode": "HTML",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π",
                        "switch_inline_query": "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ {{ config.company.name }} –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π —Å –Ω–∞–º–∏! üõ° {{ config.tg_bot.url }}?start={{ user.id }}"
                    }
                ],
                [
                    {
                        "text": "‚ùì –£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –æ –ø—Ä–æ–≥—Ä–∞–º–º–µ",
                        "callback_data": "/referral_help"
                    },
                    {
                        "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}


<% CASE '/referral_help' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendMessage": {
        "text": "üîç <b>–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞?</b>\n\n–í –Ω–∞—à–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å, –ø—Ä–∏–≥–ª–∞—à–∞—è –¥—Ä—É–∑–µ–π! –ö–∞–∂–¥—ã–π –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–π —á–µ–ª–æ–≤–µ–∫ –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –æ–Ω –º–æ–∂–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ –Ω–∞—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–∞—à–∏–º–∏ —É—Å–ª—É–≥–∞–º–∏.\n\nüí∏ <b>–ß—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ:</b>\n–í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ <b>{{ config.billing.partner.income_percent }}%</b> –æ—Ç –∫–∞–∂–¥–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–¥–µ–ª–∞–µ—Ç –≤–∞—à —Ä–µ—Ñ–µ—Ä–∞–ª. –≠—Ç–æ –æ—Ç–ª–∏—á–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥!\n\nüîó <b>–ö–∞–∫ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞:</b>\n1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–≤–æ—é —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É.\n2. –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –µ—é —Å –¥—Ä—É–∑—å—è–º–∏, –∫–æ–ª–ª–µ–≥–∞–º–∏ –∏–ª–∏ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö.\n3. –ö–æ–≥–¥–∞ –≤–∞—à —Ä–µ—Ñ–µ—Ä–∞–ª —Å–¥–µ–ª–∞–µ—Ç –ø–µ—Ä–≤—ã–π –ø–ª–∞—Ç—ë–∂, –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —Å–≤–æ—é –¥–æ–ª—é!\n\nüí° <b>–°–æ–≤–µ—Ç—ã –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –¥–æ—Ö–æ–¥–∞:</b>\n1. –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ —Å—Å—ã–ª–∫—É –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö –∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞—Ö.\n2. –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞—Ö –Ω–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –∏ –±–æ–Ω—É—Å–∞—Ö –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.\n\n–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã, –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –Ω–∞—à—É —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏.\n\nüîó –í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:\n<code>{{ config.tg_bot.url }}?start={{ user.id }}</code>",
        "parse_mode": "HTML",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üéØ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π",
                        "switch_inline_query": "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ {{ config.company.name }} –∏ –ø–æ–ª—É—á–∞–π –±–æ–Ω—É—Å—ã! üõ° {{ config.tg_bot.url }}?start={{ user.id }}"
                    }
                ],
                [
                    {
                        "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}


<% CASE ['/help', '‚ùì –ü–æ–º–æ—â—å'] %>
{{ IF cmd == '/help' OR cmd == '‚ùì –ü–æ–º–æ—â—å' }}
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{{ END }}
{
    "sendMessage": {
        "text": "üì° <b>–ü–æ–º–æ—â—å –∏ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</b>\n\n–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π –≤–∞—Å –ø—É–Ω–∫—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–∏–∂–µ:",
        "parse_mode": "HTML",
        "reply_markup": {
            "keyboard": [
                [
                    {
                        "text": "üñ• –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ VPN"
                    }
                ],
                [
                    {
                        "text": "üåç –ì–ª–∞–≤–Ω–æ–µ –ú–µ–Ω—é"
                    }
                ]
            ],
            "one_time_keyboard": false,
            "resize_keyboard": true
        }
    }
}


<% CASE ['/xray', 'üñ• –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ VPN'] %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendPhoto": {
        "photo": "{{ config.logo.url }}",
        "protect_content": false,
        "parse_mode": "HTML",
        "caption": "üõ°Ô∏è <b>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ VPN</b>\n\nüì±\n1Ô∏è‚É£ –°–∫–æ–ø–∏—Ä—É–π—Ç–µ <b>URL –∞–¥—Ä–µ—Å –ø–æ–¥–ø–∏—Å–∫–∏</b> (—Ñ–æ—Ä–º–∞—Ç <i>https://</i>).\n2Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ \niPhone <a href=\"{{ config.apk.ios }}\">Streisand</a>\n Android<a href=\"{{ config.apk.android }}\">v2rayNG </a>\n Huawei <a href=\"{{ config.apk.huawei }}\">v2RayTun</a>\n3Ô∏è‚É£ –í—Å—Ç–∞–≤—å—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ(+ –î–æ–±–∞–≤–∏—Ç—å –∏–∑ –±—É—Ñ–µ—Ä–∞).\n4Ô∏è‚É£ –í—ã–±–∏—Ä–∞–π—Ç–µ –õ–æ–∫–∞—Ü–∏—é –∏ –ù–∞–∂–º–∏—Ç–µ <b>'–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è'</b> ‚Äî –≥–æ—Ç–æ–≤–æ!\n\nüí°–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ –≤ üñ• –ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏!",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üñ• –ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏",
                        "url": "https://t.me/idsmef"
                    },
                    {
                        "text": "üîë –ú–æ–π VPN",
                        "callback_data": "/list"
                    }
                ],
                [
                    {
                        "text": "üìñ –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏",
                        "web_app": {
                            "url": "https://telegra.ph/Instrukciya-dlya-iPhoneiPad-11-27"
                        }
                    }
                ],
				
                [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}

<% CASE '/show_mz_keys' %>
{{ location = storage.read('name', 'vpn_mrzb_' _ args.0).location }}
{{ item = us.id(args.0) }}
{{ subscription_url = storage.read('name', 'vpn_mrzb_' _ args.0 _ location).subscription_url }}
{
    "sendPhoto": {
        "photo": "https://sun9-73.userapi.com/impg/e8pkzF2oh-Ac40ZO_dpgJLHT__K9BlIX3I5aaA/O0QGe8WxUg0.jpg?size=1024x1024&quality=95&sign=7bda3be0397d08e13d7edb0db5e1f8a5&type=album",
        "protect_content": false,
        "parse_mode": "HTML",
        "caption": "üåê <b>–í–∞—à–∏ VPN –∫–ª—é—á–∏ –∏ –ø–æ–¥–ø–∏—Å–∫–∞:</b>\n\nüîó <b>URL –ø–æ–¥–ø–∏—Å–∫–∏:</b>\n<code>{{ subscription_url }}</code>\n\nüí° <i>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç URL –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.</i>\n\nüîê <b>–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª—é—á –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è:</b>",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üîë –ü–æ–∫–∞–∑–∞—Ç—å 'TCP' ",
                        "callback_data": "/trojan_key {{ args.0 }}"
                    },
                    {
                        "text": "üîë –ü–æ–∫–∞–∑–∞—Ç—å 'UDP' ",
                        "callback_data": "/vless_key {{ args.0 }}"
                    }
                ],
                [
                    {
                        "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ —É—Å–ª—É–≥–∞–º",
                        "callback_data": "/service {{ args.0 }}"
                    }
                ]
            ]
        }
    }
}


<% CASE '/vless_key' %>
{{ vless_tcp = storage.read('name', 'vpn_mrzb_' _ args.0).links.grep('^vless:').first }}
{
    "printQrCode": {
        "data": "{{ vless_tcp }}",
        "parameters": {
            "parse_mode": "HTML",
            "caption": "‚úÖ <b>–í–∞—à VLESS TCP –∫–ª—é—á —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!</b>\n\nüì• <i>QR-–∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.</i>"
        }
    }
},
{
    "sendMessage": {
        "text": "üîë <b>–í–∞—à VLESS TCP –∫–ª—é—á</b>\n\nüåê <b>–ü—Ä–æ—Ç–æ–∫–æ–ª:</b> VLESS TCP\n\nüóùÔ∏è <b>–ö–ª—é—á:</b> <code>{{ vless_tcp }}</code>\n\nüì≤ <i>–°–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞—à–µ–≥–æ VPN –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.</i>\n\nüí° <b>–°–æ–≤–µ—Ç:</b> –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ—Ç –∫–ª—é—á –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ.",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üîÑ –ò–∑–º–µ–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ",
                        "callback_data": "/selectservice {{ args.0 }}"
                    }
                ],
                [
                    {
                        "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –∫–ª—é—á–∞–º",
                        "callback_data": "/show_mz_keys {{ args.0 }}"
                    }
                ]
            ]
        }
    }
}


<% CASE '/trojan_key' %>
{{ trojan = storage.read('name', 'vpn_mrzb_' _ args.0).links.grep('^trojan:').first }}
{
    "printQrCode": {
        "data": "{{ trojan }}",
        "parameters": {
            "parse_mode": "HTML",
            "caption": "‚úÖ <b>–í–∞—à Trojan TCP –∫–ª—é—á —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!</b>\n\nüîí <i>QR-–∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.</i>\n\nüí° <b>–ù–µ –∑–∞–±—É–¥—å—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–ª—é—á –≤ –Ω–∞–¥–µ–∂–Ω–æ–º –º–µ—Å—Ç–µ.</b>"
        }
    }
},
{
    "sendMessage": {
        "text": "üîë <b>–í–∞—à Trojan TCP –∫–ª—é—á</b>\n\n<b>–ü—Ä–æ—Ç–æ–∫–æ–ª:</b> Trojan TCP\n\nüóùÔ∏è<b>–ö–ª—é—á:</b> <code>{{ trojan }}</code>\n\nüì≤ <i>–°–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞—à–µ–≥–æ VPN –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.</i>\n\nüí° <b>–°–æ–≤–µ—Ç:</b> –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–ª—é—á –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ, —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –¥–æ—Å—Ç—É–ø –∫ –≤–∞—à–µ–º—É VPN-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—é.\n\nüîí <b>–ß—Ç–æ —Ç–∞–∫–æ–µ Trojan?</b>\nTrojan ‚Äî —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∏ –±—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∏ –∑–∞—â–∏—Ç—ã –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏. –≠—Ç–æ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —Å—Ç—Ä–∞–Ω–∞—Ö —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Ä–µ—Å—É—Ä—Å–∞–º.",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –∫–ª—é—á–∞–º",
                        "callback_data": "/show_mz_keys {{ args.0 }}"
                    }
                ]
            ]
        }
    }
}

<% CASE '/change' %>
{
    "sendMessage": {
        "parse_mode": "HTML",
        "text":"–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ –¥–ª—è —Å–º–µ–Ω—ã:",
        "reply_markup" : {
            "inline_keyboard": [
                {{ FOR item IN ref(service.api_price_list( 'category', 'vpn-%' )).nsort('cost') }}
                    [
                        {
                            "text": "{{ item.name }} - {{ item.cost }} ‚ÇΩ",
                            "callback_data": "/change_id {{ args.0 }}_{{ item.service_id }}"
                        }
                    ],
                {{ END }}
                [
                    {
                        "text": "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}

<% CASE '/change_id' %>
{{ args_split = args.0.split('_') }}
{{ id = args_split.0 }}
{{ next_id = args_split.1 }}
{{ change = us.id(id).set('next', next_id ) }}
{{ next = services.list_for_api( 'service_id', next_id ) }}
{
    "sendMessage": {
        "text": "–í—ã —Å–º–µ–Ω–∏–ª–∏ —Ç–∞—Ä–∏—Ñ –Ω–∞ {{ next.name }}",
        "parse_mode": "HTML",
        "reply_markup" : {
            "inline_keyboard": [
                [
                    {
                        "text": "–ù–∞–∑–∞–¥",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}

<% CASE %>
{{ IF message.chat.id == config.telegram_admin.id OR message.chat.id == config.telegram_admin2.id OR message.chat.id == config.telegram_admin3.id }}
{{ text = message.reply_to_message.caption || message.reply_to_message.text }}
{{ chatid = text.split('#').1 }}
{{ IF chatid }}
{{ IF message.photo }}
{
    "sendPhoto": {
        "chat_id": "{{ chatid }}",
        "photo": "{{ message.photo.0.file_id }}",
        "caption": "–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏:\n\n{{ message.caption }}."
    }
}
{{ ELSIF message.text }}
{
    "sendMessage": {
        "chat_id": "{{ chatid }}",
        "text": "–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏:\n\n{{ message.text }}."
    }
}
{{ ELSE }}
{
    "sendMessage": {
        "chat_id": "{{ chatid }}",
        "text": "–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ"
    }
}
{{ END }}
{{ ELSE }}
{
    "sendMessage": {
        "chat_id": "{{ tpl.settings.admin.chat_id }}",
        "text": "–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –≤—ã –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ"
        }
}
{{ END }}
{{ ELSE }}
{{ IF message.photo }}
{
    "sendPhoto": {
        "chat_id": "{{ tpl.settings.admin.chat_id }}",
        "photo": "{{ message.photo.0.file_id }}",
        "caption": "#{{ user.settings.telegram.chat_id }}#\n\n{{ message.caption }}."
    }
}
{{ ELSIF message.text }}
{
    "sendMessage": {
        "chat_id": "{{ tpl.settings.admin.chat_id }}",
        "text": "#{{ user.settings.telegram.chat_id }}# \n–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ user.full_name }}:\n\n{{ message.text }}"
    }
}
{{ ELSE }}
{
    "sendMessage": {
        "text": "–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ç–æ"
    }
}
{{ END }}
{{ END }}

<% END %>
