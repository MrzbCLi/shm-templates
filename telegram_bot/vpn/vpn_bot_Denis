<% SWITCH cmd %>
<% CASE 'USER_NOT_FOUND' %>
{
    "shmRegister": {
        "partner_id": "{{ args.0 }}",
        "callback_data": "/start",
        "error": "–û–®–ò–ë–ö–ê: –õ–æ–≥–∏–Ω {{ message.chat.username }} –∏–ª–∏ chat_id {{ message.chat.id }} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    }
}
<% CASE ['/start', '/menu', 'üè† –ì–ª–∞–≤–Ω–æ–µ –ú–µ–Ω—é', 'üîÑ –û–±–Ω–æ–≤–∏—Ç—å'] %>
{{ IF cmd != '/start' }}
{
    "deleteMessage": {
        "message_id": {{ message.message_id }}
    }
},
{{ END }}
{
    "sendPhoto": {
        "photo": "{{ config.logo.url }}", 
        "caption": "üëã <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <u>{{ user.full_name }}</u>!</b>\n\nüåê <b>{{ config.company.name }}</b>\n\n‚úîÔ∏è –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.\n‚úîÔ∏è –ù–∞–¥—ë–∂–Ω–∞—è –∑–∞—â–∏—Ç–∞ –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö.\n‚úîÔ∏è –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.\n\nüì≤ <b>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:</b>\n- <a href=\"{{ config.apk.ios }}\"><b>–°–∫–∞—á–∞—Ç—å –¥–ª—è iOS</b></a>\n- <a href=\"{{ config.apk.android }}\"><b>–°–∫–∞—á–∞—Ç—å –¥–ª—è Android</b></a>",
		"parse_mode": "HTML",
        "reply_markup": {
            "inline_keyboard": [
				{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin'; }}
                [
                    {
                        "text": "üë®‚Äçüíª –ú–µ–Ω—é {{ menuRole = (user.settings.role == 'admin' ? '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞' : '–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞'); menuRole; }}",
                        "callback_data": "admin:menu"
                    }
                ],
                {{ END }}
                [
                    {
                        "text": "üí∞ –ë–∞–ª–∞–Ω—Å: {{ user.balance }} ‚ÇΩ",
                        "callback_data": "/balance"
                    },
                    {
                        "text": "‚úö –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å",
                        "web_app": {
                            "url": "{{ config.api.url }}/shm/v1/template/tg_payments_webapp?format=html&session_id={{ user.gen_session.id }}"
                        }
                    }
                ],
                [
                    {
                        "text": "üîë –°–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π",
                        "callback_data": "/list"
                    },
                    {
                        "text": "üõí –ö—É–ø–∏—Ç—å –∫–ª—é—á",
                        "callback_data": "/buy_mz_key"
                    }
                ],
                [
                    {
                        "text": "üéÅ –¢–µ—Å—Ç 1 –ú–µ—Å—è—Ü",
                        "callback_data": "/test_mz"
                    },
					{
                        "text": "ü§ù –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞",
                        "callback_data": "/referrals"
                    }
                ],
                [
                    {
                        "text": "üìñ –ü–æ–º–æ—â—å",
                        "callback_data": "/help"
                    }
                ],
                [
                    {
                        "text": "üîÑ –û–±–Ω–æ–≤–∏—Ç—å",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}

<% CASE '/balance' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendMessage": {
        "text": "üí∞ <b>–ë–∞–ª–∞–Ω—Å</b>: {{ user.balance }}\n\n–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø–ª–∞—Ç–∏—Ç—å: <b>{{ user.pays.forecast('blocked',1).total }}</b>",
        "reply_markup" : {
            "inline_keyboard": [
                [ { "text": "‚úö –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å", "web_app": { "url": "{{ config.api.url }}/shm/v1/template/tg_payments_webapp?format=html&session_id={{ user.gen_session.id }}" } } ],
                [ { "text": "üîÑ –û–±–Ω–æ–≤–∏—Ç—å", "callback_data": "/balance" } ],
                [ { "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –ú–µ–Ω—é", "callback_data": "/menu" } ]
            ]
        }
    }
}

<% CASE '/pays' %>
{
    "deleteMessage": { 
        "message_id": {{ message.message_id }} 
    },
    "sendPhoto": {
        "photo": "{{ config.logo.url }}",
        "protect_content": false,
        "parse_mode": "HTML",   
        "caption": "<b>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π</b>\n\nüîΩ <b>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏:</b>\n{{ FOR item IN ref(user.pays.list_for_api('limit', 1)) }}\n<u>üìÖ <b>–î–∞—Ç–∞:</b> {{ item.date }} | üíµ <b>–°—É–º–º–∞:</b> {{ item.money }} —Ä—É–±.</u>\n{{ END }}\n\n<b>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π:</b>",
        "reply_markup": {
            "inline_keyboard": [
                [ { "text": "üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é", "callback_data": "/pays" } ],
                [ 
                    { 
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –ú–µ–Ω—é",
                        "callback_data": "/menu" 
                    }
                ]
            ]
        }
    }
}


<% CASE '/list' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{{ hasnotpaidus = ref(user.services.list_for_api('category', '%', 'filter', { 'status' => 'NOT PAID' } )).size }}
{{ hasblocked = ref(user.services.list_for_api('category', '%', 'filter', { 'status' => 'BLOCK' } )).size }}
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendPhoto": {
        "photo": "{{ config.logo.url }}",
		"parse_mode": "HTML",
        "caption": "‚≠êÔ∏è <b>–ú–æ–π ID:</b> {{ user.id }} ‚≠êÔ∏è\n\nüí° –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–∞—à–µ–º –∫–ª—é—á–µ, –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –µ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏–µ.\n\n‚ùáÔ∏è –î–ª—è <b>—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏–ª–∏ –ø—Ä–æ–¥–ª–µ–Ω–∏—è</b> —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –∫–ª—é—á–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å.\n\nüîë <b>–í–∞—à–∏ –∫—É–ø–ª–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏:</b>",
        "reply_markup": {
            "inline_keyboard": [
                {{ FOR item IN ref( user.services.list_for_api( 'category', '%' ) ) }}
                {{ SWITCH item.status }}
                  {{ CASE 'ACTIVE' }}
                  {{ icon = '‚úÖ' }}
                  {{ status = ' –†–∞–±–æ—Ç–∞–µ—Ç' }}
                  {{ CASE 'BLOCK' }}
                  {{ icon = '‚ùå' }}
                  {{ status = ' –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞' }}
                  {{ CASE 'NOT PAID' }}
                  {{ icon = 'üí∞' }}
                  {{ status = ' –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã' }}
                  {{ CASE }}
                  {{ icon = '‚è≥' }}
                  {{ status = ' –û–±—Ä–∞–±–æ—Ç–∫–∞' }}
                {{ END }}
                [
                    {
                        "text": "{{ item.name }} - {{ icon }} {{ status }}",
                        "callback_data": "/service {{ item.user_service_id }}"
                    }
                ],
                {{ END }}
                [
                    {
                        "text": "üõí –ö—É–ø–∏—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á üõí",
                        {{ IF hasnotpaidus > 0 || hasblocked > 0 }}
                            "callback_data": "/hint"
                        {{ ELSE }}
                            "callback_data": "/buy_mz_key"
                        {{ END }}
                    }
                ],
                [
                    {
                        "text": "üîå –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫–ª—é—á? üîå",
                        "url": "https://telegra.ph/Instrukciya-dlya-iPhoneiPad-12-28"
                    }
                ],
                [
                    {
                        "text": "üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫",
                        "callback_data": "/list"
                    }
                ],
                [
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –ú–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}


<% CASE '/hint' %>
{
   "answerCallbackQuery": {
        "callback_query_id": {{ callback_query.id }},
        "parse_mode":"HTML",
        "text": "üßê –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ üí≥ –∏–ª–∏ —É–¥–∞–ª–∏—Ç–µ üóëÔ∏è –≤—Å–µ –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ –∏–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏..–≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤–∞—à–µ–π —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏",
        "show_alert": true
    }
}

<% CASE '/service' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{{ item = us.id(args.0) }}
{{ us = user.services.list_for_api('usi', args.0) }}
{
    "sendPhoto": {
        {{ SWITCH us.status }}
          {{ CASE 'ACTIVE' }}
              {{ icon = '‚úÖ' }}
              {{ status = ' –†–∞–±–æ—Ç–∞–µ—Ç' }}
          {{ CASE 'BLOCK' }}
              {{ icon = '‚ùå' }}
              {{ status = ' –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞' }}
          {{ CASE 'NOT PAID' }}
              {{ icon = 'üí∞' }}
              {{ status = ' –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã' }}
          {{ CASE }}
              {{ icon = '‚è≥' }}
              {{ status = ' –û–±—Ä–∞–±–æ—Ç–∫–∞' }}
        {{ END }}
        "photo": "https://w-w-w.click/images/log.jpg",
        "caption": "üîî <b>–ü–æ–¥–ø–∏—Å–∫–∞:</b> <i>{{ item.name }}</i>\nüìÖ <b>–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞:</b> {{ USE date }}{{ date.format(item.created, '%d.%m.%Y–≥. %H:%M') }}\n‚è≥ <b>–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ:</b> {{ USE date }}{{ date.format(item.expire, '%d.%m.%Y–≥. %H:%M') }}",
        "parse_mode": "HTML",
        "reply_markup": {
            "inline_keyboard": [
                {{ IF us.status == 'ACTIVE' }}
                {{ subscription_url = storage.read('name', 'vpn_mrzb_' _ args.0).subscription_url }}
                {{ IF us.category.grep('^(VPN-)').first }}
                {{ IF subscription_url.grep('^https:').first }}
                [
                    {
                        "text": "üîó –ü–æ–∫–∞–∑–∞—Ç—å –∫–ª—é—á–∏ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è",
                        "callback_data": "/show_mz_keys {{ args.0 }}"
                    }
                ],
                {{ ELSE }}
                [
                    {
                        "text": "‚ö†Ô∏è –û–®–ò–ë–ö–ê: –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ SSL –¥–ª—è Marzban",
                        "callback_data": "/menu"
                    }
                ],
                {{ END }}
                {{ ELSE }}
                [
                    {
                        "text": "üóù –°–∫–∞—á–∞—Ç—å –∫–ª—é—á",
                        "callback_data": "/download_qr {{ args.0 }}"
                    },
                    {
                        "text": "üëÅ –ü–æ–∫–∞–∑–∞—Ç—å QR –∫–æ–¥",
                        "callback_data": "/show_qr {{ args.0 }}"
                    }
                ],
                {{ END }}
                {{ END }}
                  {{ IF us.status == 'NOT PAID' || us.status == 'BLOCK' }}
                [
                    {
                        "text": "üí≥ –û–ø–ª–∞—Ç–∏—Ç—å —Å–µ–π—á–∞—Å",
                        "callback_data": "/balance {{ user.pays.forecast('blocked', 1).total }}"
                    }
                ],
                {{ END }}
                {{ IF us.status != 'PROGRESS' }}
                [
                    {
                        "text": "üóë –£–¥–∞–ª–∏—Ç—å –∫–ª—é—á",
                        "callback_data": "/delete {{ args.0 }}"
                    }
                ],
                {{ END }}
                [
                    {
                        "text": "üîç –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ NPV",
                        "callback_data": "/xray"
                    }
                ],
				[
                    {
                        "text": "üîë –°–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π",
                        "callback_data": "/list"
                    }
                ],
                [
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –ú–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}



<% CASE ['/pricelist', 'üöÄ –ü—Ä–∞–π—Å –ª–∏—Å—Ç'] %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendPhoto": {
        "photo": "{{ config.logo.url }}",
        "protect_content": true,
        "parse_mode": "HTML",
        "caption": "üí°<b>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É üîê –í—ã–¥–∞—Ç—å VPN:</b>\n",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üîê –í—ã–¥–∞—Ç—å VPN",
                        "callback_data": "/buy_mz_key"
                    }
                ],
                [
                    {
                        "text": "üìã –ú–æ–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–ª—é—á–∏",
                        "callback_data": "/list"
                    }
                ],
                [
                    {
                        "text": "üí¨ –ü–æ–º–æ—â—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞",
                        "callback_data": "/support"
                    }
                ],
                [
                    {
                        "text": "‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}


<% CASE '/buy_mz_key' %>
{{ hasnotpaidus = ref(user.services.list_for_api('category', '%', 'filter',{ 'status' => 'NOT PAID' } )).size }}
{{ hasblocked = ref(user.services.list_for_api('category', '%', 'filter',{ 'status' => 'BLOCK' } )).size }}
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendMessage": {
        "text": "üîë <b>–ü–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –Ω–∞—à–∏–º VPN —Å–µ—Ä–≤–∏—Å–∞–º –∏ —É–ª—É—á—à–∏—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å!</b>\n\nüåç –°—Ç–∞–±–∏–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –≤ –ï–≤—Ä–æ–ø–µ –∏ –†–æ—Å—Å–∏–∏!\nüíª –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ –ø–µ—Ä–≤–æ–º –º–µ—Å—Ç–µ —Å –Ω–∞—à–∏–º–∏ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏.\nüöÄ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ –∏–ª–∏ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.\n\n–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ç–∞—Ä–∏—Ñ:",
        "reply_markup": {
            "inline_keyboard": [
                {{ FOR item IN ref(service.api_price_list).nsort('service_id') }}
                    {{ IF item.category == 'VPN-EUROPE-1M' or item.category == 'VPN-EUROPE-3M' or item.category == 'VPN-RUSSIA-1M' or item.category == 'VPN-RUSSIA-3M' }}
                        {{ IF item.service_id }}
                            [
                                {
                                    "text": "{{ item.name }} - {{ item.cost }} —Ä—É–±/–º–µ—Å.",
                                    {{ IF hasnotpaidus > 0 || hasblocked > 0 }}
                                    "callback_data": "/hint"
                                    {{ ELSE }}
                                    "callback_data": "/serviceorder {{ item.service_id }}"
                                    {{ END }}
                                }
                            ],
                        {{ ELSE }}
                            [
                                {
                                    "text": "–û—à–∏–±–∫–∞: –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Å–ª—É–≥.",
                                    "callback_data": "/menu"
                                }
                            ]
                        {{ END }}
                    {{ END }}
                {{ END }}
                [
                    {
                        "text": "üîÑ –û–±–Ω–æ–≤–∏—Ç—å",
                        "callback_data": "/buy_mz_key"
                    },
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –ú–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}

<% CASE '/serviceorder' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "shmServiceOrder": {
        "service_id": "{{ args.0 }}",
        "callback_data": "/list",
        "cb_not_enough_money": "/menu",
        "error": "–û–®–ò–ë–ö–ê"
    }
},
{
    "answerCallbackQuery": {
        "callback_query_id": {{ callback_query.id }},
        "parse_mode":"HTML",
        "text": "–í–∞—à –∫–ª—é—á —Å–æ–∑–¥–∞–µ—Ç—Å—è...",
        "show_alert": true
    }
}


<% CASE '/notifications_active' %>
{{ item = us.id( args.0 ) }}
{{ subscription_url = storage.read('name','vpn_mrzb_' _ args.0 ).subscription_url }}
{
    "sendMessage": {
        "text": " –ü–æ–¥–ø–∏—Å–∫–∞: {{ item.name }} {{ item.user_service_id }} –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞.\nÔø®  {{ USE date }}{{  date.format( item.created, '%d.%m.%Y–≥. %H:%M')  }}\n–¥–æ: {{ USE date }}{{  date.format( item.expire, '%d.%m.%Y–≥. %H:%M')  }}",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üöÄ –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏",
                        "web_app": {
                            "url": "{{ config.api.url }}/shm/v1/template/subscriptions_link?format=html&session_id={{ user.gen_session.id }}&service_id={{ args.0 }}"
                        }
                    }
                ],
                [
                    {
                        "text": "–ú–µ–Ω—é",
                        "callback_data": "/start"
                    }
                ]
            ]
        }
    }
}


<% CASE '/delete' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendMessage": {
        "text": "ü§î <b>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∏. –£—Å–ª—É–≥—É –Ω–µ–ª—å–∑—è –±—É–¥–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å!</b>",
        "reply_markup" : {
            "inline_keyboard": [
                [
                    {
                        "text": "üß® –î–ê, –£–î–ê–õ–ò–¢–¨! üî•",
                        "callback_data": "/delete_confirmed {{ args.0 }}"
                    }
                ],

                [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/list"
                    }
                ]
            ]
        }
    }
}
<% CASE '/delete_confirmed' %>
{
    "deleteMessage": { 
        "message_id": "{{ message.message_id }}" 
    }
},
{
    "shmServiceDelete": {
        "usi": "{{ args.0 }}",
        "callback_data": "/list",
        "error": "–û–®–ò–ë–ö–ê"
    }
},
{
    "answerCallbackQuery": {
        "callback_query_id": "{{ callback_query.id }}",
        "parse_mode": "HTML",
        "text": "–í–∞—à –∫–ª—é—á —É–¥–∞–ª—è–µ—Ç—Å—è...",
        "show_alert": true
    }
}


<% CASE '/referrals' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendMessage": {
        "text": "ü§ù <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à—É —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É!</b>\n\n–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ <b>{{ config.billing.partner.income_percent }}% –æ—Ç –∫–∞–∂–¥–æ–≥–æ –∏—Ö –ø–ª–∞—Ç–µ–∂–∞</b>.\n\nüë• <b>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö –¥—Ä—É–∑–µ–π:</b> {{ user.referrals_count }}\nüí∞ <b>–í–∞—à –¥–æ—Ö–æ–¥ –æ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤:</b> {{ user.get_bonus }}\n\nüîó <b>–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</b>\n<code>{{ config.tg_bot.url }}?start={{ user.id }}</code>\n\n–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å—Å—ã–ª–∫–æ–π —Å –¥—Ä—É–∑—å—è–º–∏!",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π",
                        "switch_inline_query": "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ {{ config.company.name }} –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π —Å –Ω–∞–º–∏! üõ° {{ config.tg_bot.url }}?start={{ user.id }}"
                    }
                ],
                [
                    {
                        "text": "‚ùì –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?",
                        "callback_data": "/referral_help"
                    }
                ],
                [
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –ú–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}


<% CASE '/referral_help' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendMessage": {
        "text": "üîç <b>–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞?</b>\n\n–í –Ω–∞—à–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å, –ø—Ä–∏–≥–ª–∞—à–∞—è –¥—Ä—É–∑–µ–π! –ö–∞–∂–¥—ã–π –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–π —á–µ–ª–æ–≤–µ–∫ –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –æ–Ω –º–æ–∂–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ –Ω–∞—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–∞—à–∏–º–∏ —É—Å–ª—É–≥–∞–º–∏.\n\nüí∏ <b>–ß—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ:</b>\n–í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ <b>{{ config.billing.partner.income_percent }}%</b> –æ—Ç –∫–∞–∂–¥–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–¥–µ–ª–∞–µ—Ç –≤–∞—à —Ä–µ—Ñ–µ—Ä–∞–ª. –≠—Ç–æ –æ—Ç–ª–∏—á–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–∞—à–∏–º–∏ —É—Å–ª—É–≥–∞–º–∏ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ!\n\nüîó <b>–ö–∞–∫ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞:</b>\n1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–≤–æ—é —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É.\n2. –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –µ—é —Å –í–∞—à–∏–º–∏ –±–ª–∏–∑–∫–∏–º–∏, –¥—Ä—É–∑—å—è–º–∏ –∏–ª–∏ –∫–æ–ª–ª–µ–≥–∞–º–∏. –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞—Ö –Ω–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –∏ –±–æ–Ω—É—Å–∞—Ö –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.\n\n3. –ö–æ–≥–¥–∞ –í–∞—à —Ä–µ—Ñ–µ—Ä–∞–ª —Å–¥–µ–ª–∞–µ—Ç –ø–µ—Ä–≤—ã–π –ø–ª–∞—Ç—ë–∂, –í—ã –ø–æ–ª—É—á–∏—Ç–µ —Å–≤–æ—é –¥–æ–ª—é!\n\nüí° <b>–°–æ–≤–µ—Ç—ã:</b>\n1. <b>–ù–ï –†–∞–∑–º–µ—â—è–π—Ç–µ —Å—Å—ã–ª–∫—É –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö –∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞—Ö</b>, –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å—Ç—Ä–∞–Ω–∞—Ö —Ä–µ–∫–ª–∞–º–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ –∑–∞–ø—Ä–µ—â–µ–Ω–∞.\n\n–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã, –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –Ω–∞—à—É —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏.\n\nüîó –í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:\n<code>{{ config.tg_bot.url }}?start={{ user.id }}</code>",
        "parse_mode": "HTML",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üéØ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π",
                        "switch_inline_query": "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ {{ config.company.name }} –∏ –ø–æ–ª—É—á–∞–π –±–æ–Ω—É—Å—ã! üõ° {{ config.tg_bot.url }}?start={{ user.id }}"
                    }
                ],
                [
                    {
                        "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ",
                        "callback_data": "/referrals"
                    }
                ],
                [
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –ú–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}

<% CASE ['/help', '‚ùì –ü–æ–º–æ—â—å'] %>
{{ IF cmd == '/help' OR cmd == '‚ùì –ü–æ–º–æ—â—å' }}
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{{ END }}
{
    "sendMessage": {
        "text": "üìñ <b>–ü–æ–º–æ—â—å</b>\n\n–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π –≤–∞—Å –ø—É–Ω–∫—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–∏–∂–µ:",
        "parse_mode": "HTML",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üñ• –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ NPV",
                        "callback_data": "/xray"
                    }
                ],
                [
                    {
                        "text": "üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –≤ —á–∞—Ç",
                        "url": "{{ config.chat.url }}"
                    }
                ],
                [
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –ú–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}

<% CASE '/vpn_instruction' %>
{
    "sendPhoto": {
        "photo": "{{ config.logo.url }}",
        "protect_content": false,
        "parse_mode": "HTML",
        "caption": "<b>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é —á–µ—Ä–µ–∑ VLESS TCP</b>\n\nüöÄ –ß—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ VPN —á–µ—Ä–µ–∑ VLESS —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º TCP, —Å–ª–µ–¥—É–π—Ç–µ –ø–æ—à–∞–≥–æ–≤–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∏–∂–µ.\n\n<b>1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç:</b>\n\n- –î–ª—è Windows –∏ Linux: —Å–∫–∞—á–∞–π—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ [Xray](https://github.com/XTLS/Xray-core/releases)\n- –î–ª—è macOS: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ [V2RayU](https://github.com/yanue/V2rayU)\n- –î–ª—è Android: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ [V2RayNG](https://github.com/2dust/v2rayNG)\n- –î–ª—è iOS: —Å–∫–∞—á–∞–π—Ç–µ [Shadowrocket](https://apps.apple.com/us/app/shadowrocket/id932747118)\n\n<b>2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞:</b>\n\n–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –µ–≥–æ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:\n\n<b>–¢–∏–ø –ø—Ä–æ—Ç–æ–∫–æ–ª–∞:</b> VLESS\n<b>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç:</b> TCP\n<b>–°–µ—Ä–≤–µ—Ä:</b> {{ vpn_server_address }}\n<b>–ü–æ—Ä—Ç:</b> {{ vpn_port }}\n<b>UUID:</b> {{ vpn_uuid }}\n<b>–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ:</b> aes-128-gcm\n<b>–¢–æ–∫–µ–Ω:</b> {{ vpn_token }}\n\n<b>3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:</b>\n\n- –í–∫–ª—é—á–∏—Ç–µ <i>TCP Fast Open</i>, –µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.\n- –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º TLS, –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –∫–ª–∏–µ–Ω—Ç–µ.\n- –î–ª—è –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TLS —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º.\n\n<b>4. –ó–∞–≤–µ—Ä—à–∞—é—â–∏–µ —à–∞–≥–∏:</b>\n\n- –ù–∞–∂–º–∏—Ç–µ <i>–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</i>, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å VPN-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ VLESS TCP.\n- –í —Å–ª—É—á–∞–µ –æ—à–∏–±–æ–∫, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Å–µ—Ä–≤–µ—Ä, –ø–æ—Ä—Ç, UUID –∏ —Ç. –¥.).\n\n<b>5. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</b>\n\n- –î–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å DNS-—Å–µ—Ä–≤–µ—Ä—ã –≤ –≤–∞—à–µ–º –∫–ª–∏–µ–Ω—Ç–µ.\n- –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.\n\n<b>6. –ü–æ–ª—É—á–∏—Ç–µ –ø–æ–º–æ—â—å:</b>\n\n- –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏–ª–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞—à–µ–π —Å–ª—É–∂–±–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏.\n\n<b>–ù–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –∏ –±—ã—Å—Ç—Ä—ã–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º!</b>",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –ú–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}




<% CASE ['/xray', 'üñ• –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ NPV'] %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendPhoto": {
        "photo": "{{ config.logo.url }}",
        "protect_content": false,
        "parse_mode": "HTML",
        "caption": "üõ°Ô∏è <b>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ NPV</b>\n\nüì±\n1Ô∏è‚É£ –°–∫–æ–ø–∏—Ä—É–π—Ç–µ <b>URL –∞–¥—Ä–µ—Å –ø–æ–¥–ø–∏—Å–∫–∏</b> (—Ñ–æ—Ä–º–∞—Ç <i>https://</i>).\n2Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ\niPhone:\n <a href=\"{{ config.apk.ios }}\">Streisand (iOS 14)</a>\n <a href=\"https://apps.apple.com/us/app/foxray/id6448898396\">FoXRay (iOS 16)</a>\n\nAndroid:\n<a href=\"{{ config.apk.android }}\">Hiddify</a>\n<a href=\"{{ config.apk.huawei }}\">v2RayTun</a> (Huawei)\n3Ô∏è‚É£ –í—Å—Ç–∞–≤—å—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ(+ –î–æ–±–∞–≤–∏—Ç—å –∏–∑ –±—É—Ñ–µ—Ä–∞).\n4Ô∏è‚É£ –í—ã–±–∏—Ä–∞–π—Ç–µ –õ–æ–∫–∞—Ü–∏—é –∏ –ù–∞–∂–º–∏—Ç–µ <b>'–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è'</b> ‚Äî –≥–æ—Ç–æ–≤–æ!\n\nüí°–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ –≤ üñ• –ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏!",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üñ• –ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏",
                        "url": "{{ config.chat.url }}"
                    },
                    {
                        "text": "üîë –ú–æ–∏ –∫–ª—é—á–∏",
                        "callback_data": "/list"
                    }
                ],
                [
                    {
                        "text": "üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é",
                        "url": "https://telegra.ph/Instrukciya-dlya-iPhoneiPad-12-28"
                    }
                ],
                [
                    {
                        "text": "üìñ –ü–æ–º–æ—â—å",
                        "callback_data": "/help"
                    }
                ],
                [
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –ú–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}

<% CASE '/show_mz_keys' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{{ us = user.services.list_for_api('usi', args.0) }}
{{ subscription_url = storage.read('name','vpn_mrzb_' _ args.0 ).subscription_url }}
{
    "printQrCode": {
        "data": "{{ subscription_url }}",
        "parameters": {
            "parse_mode": "HTML",
            "caption": "<b>Subscription URL:</b>\n<code>{{ subscription_url }}</code>"
        }
    }
},
{{ vless_tcp = storage.read('name','vpn_mrzb_' _ args.0 ).links.grep('^vless:').first }}
{
    "printQrCode": {
        "data": "{{ vless_tcp }}",
        "parameters": {
            "parse_mode": "HTML",
            "caption": "<b>–°—Å—ã–ª–∫–∞ –∫–ª—é—á–∞ VLESS TCP (–ö–æ—Å–Ω–∏—Ç–µ—Å—å —Ç–µ–∫—Å—Ç–∞ —Å—Å—ã–ª–∫–∏, —á—Ç–æ–±—ã —Å—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∞—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):</b>\n<code>{{ vless_tcp }}</code>"
        }
    }
},
{
    "sendMessage": {
        "text": "‚úÖ <b>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞–ª—å–Ω–µ–π—à–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ:</b>",
        "parse_mode": "HTML",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üîë –°–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π",
                        "callback_data": "/list"
                    }
                ],
                [
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –ú–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}

<% CASE ['/test_mz', 'üåê NPV Test'] %>
{
    "sendPhoto": {
        "photo": "https://w-w-w.click/images/test.jpg",
        "protect_content": true,
        "parse_mode": "HTML",
        "caption": "üåê –¢–µ—Å—Ç–æ–≤—ã–π –ø–µ—Ä–∏–æ–¥:",
        "reply_markup": {
            "inline_keyboard": [
                {{ FOR item IN ref(user.services.list_for_api('category', 'VPN-%-TEST')) }}
                {{ SWITCH item.status }}
                    {{ CASE 'ACTIVE' }}
                        {{ icon = '‚úÖ' }}
                        {{ status = '–†–∞–±–æ—Ç–∞–µ—Ç' }}
                    {{ CASE 'BLOCK' }}
                        {{ icon = '‚ùå' }}
                        {{ status = '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞' }}
                    {{ CASE 'NOT PAID' }}
                        {{ icon = 'üí∞' }}
                        {{ status = '–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã' }}
                    {{ CASE }}
                        {{ icon = '‚è≥' }}
                        {{ status = '–û–±—Ä–∞–±–æ—Ç–∫–∞' }}
                {{ END }}
                [
                    {
                        "text": "{{ item.name }} - {{ icon }} {{ status }}",
                        "callback_data": "/service_beta {{ item.user_service_id }}"
                    }
                ],
                {{ END }}
                {{ FOR item IN ref(service.api_price_list('category', 'VPN-%-TEST')) }}
                [
                    {
                        "text": "{{ item.name }}",
                        "callback_data": "/serviceorder {{ item.service_id }} 1"
                    }
                ],
                {{ END }}
                [
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –ú–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}


<% CASE '/service_beta' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{{ item = us.id(args.0) }}
{{ us = user.services.list_for_api('usi', args.0) }}
{
    "sendPhoto": {
        {{ SWITCH us.status }}
          {{ CASE 'ACTIVE' }}
              {{ icon = '‚úÖ' }}
              {{ status = ' –†–∞–±–æ—Ç–∞–µ—Ç' }}
          {{ CASE 'BLOCK' }}
              {{ icon = '‚ùå' }}
              {{ status = ' –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞' }}
          {{ CASE 'NOT PAID' }}
              {{ icon = 'üí∞' }}
              {{ status = ' –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã' }}
          {{ CASE }}
              {{ icon = '‚è≥' }}
              {{ status = ' –û–±—Ä–∞–±–æ—Ç–∫–∞' }}
        {{ END }}
        "photo": "https://w-w-w.click/images/log.jpg",
        "caption": "üîî <b>–ü–æ–¥–ø–∏—Å–∫–∞:</b> <i>{{ item.name }}</i>\nüìÖ <b>–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞:</b> {{ USE date }}{{ date.format(item.created, '%d.%m.%Y–≥. %H:%M') }}\n‚è≥ <b>–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ:</b> {{ USE date }}{{ date.format(item.expire, '%d.%m.%Y–≥. %H:%M') }}",
        "parse_mode": "HTML",
        "reply_markup": {
            "inline_keyboard": [
                {{ IF us.status == 'ACTIVE' }}
                {{ subscription_url = storage.read('name', 'vpn_mrzb_' _ args.0).subscription_url }}
                {{ IF us.category.grep('^(VPN-EUROPE-TEST|VPN-RUSSIA-TEST|VPN-EUROPE-MONTH|VPN-RUSSIA-MONTH)').first }}
                {{ IF subscription_url.grep('^https:').first }}
                [
                    {
                        "text": "üîó –ü–æ–∫–∞–∑–∞—Ç—å –ö–ª—é—á –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É",
                        "callback_data": "/show_mz_keys {{ args.0 }}"
                    }
                ],
                {{ ELSE }}
                [
                    {
                        "text": "‚ö†Ô∏è –û–®–ò–ë–ö–ê: –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ SSL –¥–ª—è Marzban",
                        "callback_data": "/menu"
                    }
                ],
                {{ END }}
                {{ ELSE }}
                [
                    {
                        "text": "üîë –°–∫–∞—á–∞—Ç—å –∫–ª—é—á",
                        "callback_data": "/download_qr {{ args.0 }}"
                    },
                    {
                        "text": "üëÅ –ü–æ–∫–∞–∑–∞—Ç—å QR –∫–æ–¥",
                        "callback_data": "/show_qr {{ args.0 }}"
                    }
                ],
                {{ END }}
                {{ END }}
                  {{ IF us.status == 'NOT PAID' || us.status == 'BLOCK' }}
                [
                    {
                        "text": "üí≥ –û–ø–ª–∞—Ç–∏—Ç—å —Å–µ–π—á–∞—Å",
                        "callback_data": "/balance {{ user.pays.forecast('blocked', 1).total }}"
                    }
                ],
                {{ END }}
                {{ IF us.status != 'PROGRESS' }}
                [
                    {
                        "text": "üóë –£–¥–∞–ª–∏—Ç—å —É—Å–ª—É–≥—É",
                        "callback_data": "/delete {{ args.0 }}"
                    }
                ],
                {{ END }}
                [
                    {
                        "text": "üîç –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ VPN",
                        "callback_data": "/xray"
                    }
                ],
                [
                    {
                        "text": "üîë –°–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π",
                        "callback_data": "/list"
                    }
                ]
            ]
        }
    }
}
<% CASE 'admin:menu' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin'; }}
{{ TEXT = BLOCK }}
<b>–ú–µ–Ω—é {{ role = (user.settings.role == 'admin' ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞' : '–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞'); role; }}</b>

üõë <i>–ë—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã —Å –≤—ã–±–æ—Ä–æ–º –¥–µ–π—Å—Ç–≤–∏–π!</i>

{{ END }}
{
    "sendMessage": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "{{ TEXT.replace('\n','\n') }}",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",
                        "callback_data": "admin:users:list"
                    },
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ],
                {{ IF user.settings.role == 'admin' || (user.settings.role == 'moderator' && user.settings.moderate.settings == 1 )}}
                [
                    {
                        "text": "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞",
                        "callback_data": "admin:settings"
                    }
                ],
                {{ END }}
                [
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}



<% CASE 'admin:settings' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin' }}
{{ TEXT = BLOCK }}
<b>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞</b>

–ó–∞–ø—Ä–µ—Ç–∏—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–ª—é—á–µ–π, –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ: {{ notPaidStatus = (checkNotPaidServices == 0 ? '‚≠ïÔ∏è –í—ã–∫–ª—é—á–µ–Ω–æ' : 'üü¢ –í–∫–ª—é—á–µ–Ω–æ'); notPaidStatus; }}

–¢–∏–ø —Å–æ–æ–±—â–µ–Ω–∏–π: {{ messageTypeStatus = (defaultMessageType == 'editMessageText' ? '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ' : 'üÜï –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ'); messageTypeStatus; }}
{{ END }}

{
    "sendMessage": {
        "parse_mode": "HTML",
        "text": "{{ TEXT.replace('\n','\n') }}",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "–ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–µ—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è",
                        "callback_data": "admin:settings:change_notpaid"
                    }
                ],
                [
                    {
                        "text": "–ò–∑–º–µ–Ω–∏—Ç—å —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏–π",
                        "callback_data": "admin:settings:change_msg"
                    }
                ],
                [
                    {
                        "text": "üë®‚Äçüíª –ú–µ–Ω—é {{ menuRole = (user.settings.role == 'admin' ? '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞' : '–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞'); menuRole; }}",
                        "callback_data": "admin:menu"
                    },
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}


<% CASE 'admin:settings:change' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin' }}
{{ TEXT = BLOCK }}
<b>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞</b>

–ó–∞–ø—Ä–µ—Ç–∏—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–ª—é—á–µ–π, –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ: {{ notPaidStatus = (checkNotPaidServices == 0 ? '‚≠ïÔ∏è –í—ã–∫–ª—é—á–µ–Ω–æ' : 'üü¢ –í–∫–ª—é—á–µ–Ω–æ'); notPaidStatus; }}

–¢–∏–ø —Å–æ–æ–±—â–µ–Ω–∏–π: {{ messageTypeStatus = (defaultMessageType == 'editMessageText' ? '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ' : 'üÜï –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ'); messageTypeStatus; }}
{{ END }}

{
    "sendMessage": {
        "parse_mode": "HTML",
        "text": "{{ TEXT.replace('\n','\n') }}",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "–ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–µ—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è",
                        "callback_data": "admin:settings:change_notpaid"
                    }
                ],
                [
                    {
                        "text": "–ò–∑–º–µ–Ω–∏—Ç—å —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏–π",
                        "callback_data": "admin:settings:change_msg"
                    }
                ],
                [
                    {
                        "text": "üë®‚Äçüíª –ú–µ–Ω—é {{ menuRole = (user.settings.role == 'admin' ? '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞' : '–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞'); menuRole; }}",
                        "callback_data": "admin:menu"
                    },
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}

<% CASE 'admin:settings:change' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin' }}

{{ IF args.0 == 'notpaid' }}
{{      
        IF checkNotPaidServices == 0;
            ret = user.id(1).storage.save('bot_configuration', 'checkNotPaidServices' => 1, 'messageType' => defaultMessageType, 'menuCmd' => mainMenuCmd );
        ELSIF checkNotPaidServices == 1;
            ret = user.id(1).storage.save('bot_configuration', 'checkNotPaidServices' => 0, 'messageType' => defaultMessageType, 'menuCmd' => mainMenuCmd );
        END;
}}
{
    "answerCallbackQuery": {
         "callback_query_id": {{ callback_query.id }},
         "parse_mode":"HTML",
         "text": "‚úÖ –ó–∞–ø—Ä–µ—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∫–ª—é—á–µ–π –∏–∑–º–µ–Ω–µ–Ω!",
        "show_alert": true
     }
},
{
    "shmRedirectCallback": {
        "callback_data": "admin:settings"
    }
}
{{ ELSIF args.0 == 'msg' }}
{{
    IF defaultMessageType == 'sendMessage';
        ret = user.id(1).storage.save('bot_configuration', 'checkNotPaidServices' => checkNotPaidServices, 'messageType' => 'editMessageText', 'menuCmd' => 'menu' );
    ELSIF defaultMessageType == 'editMessageText';
        ret = user.id(1).storage.save('bot_configuration', 'checkNotPaidServices' => checkNotPaidServices, 'messageType' => 'sendMessage', 'menuCmd' => 'start' );
    END;
}}
{
    "answerCallbackQuery": {
         "callback_query_id": {{ callback_query.id }},
         "parse_mode":"HTML",
         "text": "‚úÖ –¢–∏–ø —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑–º–µ–Ω–µ–Ω!",
        "show_alert": true
     }
},
{
    "shmRedirectCallback": {
        "callback_data": "admin:settings"
    }
}
{{ END }}


<% CASE 'admin:users:list' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin'; }}
{{
    limit = 7;
    offset = (args.0 || 0);
    users = ref(user.list_for_api('admin', 1, 'limit', limit, 'offset', offset, 'filter',{"gid" = 0}));
    getCountUsers = ref(user.list_for_api('admin', 1, filter, {"gid" = 0})).size;
}}
{{ TEXT = BLOCK }}
üë®‚Äçüíª –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

üë§ –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {{ getCountUsers - 1 }}
{{ END }}
{
    "sendMessage": {
        "text": "{{ TEXT.replace('\n','\n') }}",
        "reply_markup": {
            "inline_keyboard": [
                {{ FOR item IN users }}
                    {{ status = (item.block == 0 ? "üü¢" : "üî¥") }}
                    [
                        {
                            "text": "{{ status _' '_ item.full_name.replace('"', '\"')  }} ({{ item.user_id _'-'_ item.login }})",
                            "callback_data": "admin:users:id {{ item.user_id _' '_ offset }}"
                        }
                    ],
                {{ END }}
                {{ IF users.size == limit || offset > 0 }}
                    [
                        {{ IF offset > 0 }}
                            {
                                "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
                                "callback_data": "admin:users:list {{ offset - limit }}"
                            },
                        {{ END }}
                        {{ IF users.size == limit }}
                            {
                                "text": "–ï—â—ë ‚û°Ô∏è",
                                "callback_data": "admin:users:list {{ limit + offset }}"
                            }
                        {{ END }}
                    ],
                {{ END }}
                [
                    {
                        "text": "üë®‚Äçüíª –ú–µ–Ω—é {{ menuRole = (user.settings.role == 'admin' ? '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞' : '–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞'); menuRole; }}",
                        "callback_data": "admin:menu"
                    },
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}

<% CASE 'admin:users:id' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin'; }}
{{
    userData = user.id(args.0);
    userPartner = user.id(userData.partner_id);
    userServices = ref(userData.services.list_for_api('category', '%'));
    offset = args.1;
}}

{{ TEXT = BLOCK }}
üë§ <b>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</b>

–°—Ç–∞—Ç—É—Å: {{ userStatus = (userData.block == 0 ? "üü¢ –ê–∫—Ç–∏–≤–µ–Ω" : "üî¥ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω"); userStatus; }}

–ò–º—è: {{ userData.full_name.replace('"', '\"') }}
ID: {{ userData.user_id }}
Telegram: {{ userData.settings.telegram.login }}
–õ–æ–≥–∏–Ω: {{ userData.login }}

–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: {{ userData.created }}
–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ö–æ–¥–∞: {{ userData.last_login }}
–ö—Ç–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª: {{ userPartner ? userPartner.full_name + " - " + userPartner.login : "‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö" }}

–ë–∞–ª–∞–Ω—Å: {{ userData.balance }} —Ä—É–±.  
–ë–æ–Ω—É—Å—ã: {{ userData.get_bonus }} —Ä—É–±.  
–°–∫–∏–¥–∫–∞: {{ userData.discount }}

–ö–æ–ª-–≤–æ –ø–æ–¥–ø–∏—Å–æ–∫: {{ userServices.size }}

{{ END }}

{
    "sendMessage": {
        "parse_mode": "HTML",
        "text": "{{ TEXT.replace('\n','\n') }}",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏",
                        "callback_data": "admin:users:id:subs {{ userData.user_id _' '_ offset }}"
                    }
                ],
                [
                    {
                        "text": "üí∏ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞–º–∏",
                        "callback_data": "admin:users:id:pays {{ userData.user_id }}"
                    }
                ],
                [
                    {
                        "text": "üéÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞–º–∏",
                        "callback_data": "admin:users:id:bonuses {{ userData.user_id }}"
                    }
                ],
                [
                    {
                        "text": "{{ status = (userData.block == 0 ? "üî¥ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å" : "üü¢ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å"); status; }}",
                        "callback_data": "admin:users:block {{ userData.user_id }}"
                    }
                ],
                [
                    {
                        "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
                        "callback_data": "admin:users:list {{ args.1 }}"
                    }
                ],
                [
                    {
                        "text": "üë®‚Äçüíª –ú–µ–Ω—é {{ menuRole = (user.settings.role == 'admin' ? '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞' : '–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞'); menuRole; }}",
                        "callback_data": "admin_menu"
                    },
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}

<% CASE 'admin:users:block' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin' }}
{{ checkModeratorRights(right="blockUser") }}

{{
    # Arguments 
    #   0. - id of user

    # Variables
        userData = user.id(args.0);
}}
{{ retcode = (userData.block == 1 ? "0" : "1"); }}
{{ ret = userData.set(block = retcode) }}
{
    "answerCallbackQuery": {
         "callback_query_id": {{ callback_query.id }},
         "parse_mode":"HTML",
         "text": "‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {{ userData.full_name.replace('"', '\"')  }} ({{ userData.user_id }}) {{ status = (userData.block == 1 ? "üî¥ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω" : "üü¢ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω"); status; }}",
         "show_alert": true
     }
},
{
    "shmRedirectCallback": {
        "callback_data": "admin:users:id {{ userData.user_id }}"
    }
}

<% CASE 'admin:users:id:subs' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin' }}
{{
    limit = 7;
    last_offset = (args.1 || 0);
    offset = (args.2 || 0);
    userData = user.id(args.0);
    userServices = ref(userData.services.list_for_api('limit', limit, 'offset', offset));
}}
{{ TEXT = BLOCK }}
üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏

–ò–º—è: {{ userData.full_name.replace('"', '\"')  }}
ID: {{ userData.user_id }}
Telegram: {{ userData.settings.telegram.login }}
–õ–æ–≥–∏–Ω: {{ userData.login }}

{{ IF userServices.size <= 0}}
<b>–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –ø–æ–¥–ø–∏—Å–æ–∫!</b>
{{ END }}
{{ END }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "{{ TEXT.replace('\n','\n') }}",
        "reply_markup": {
            "inline_keyboard": [
                {{ FOR item in userServices }}
                    {{ status = (item.status == 'ACTIVE' ? "üü¢" : "üî¥") }}
                    [
                        {
                            "text": "{{ status; item.user_service_id _' - '_ item.name  }}",
                            "callback_data": "admin:subs:id {{ item.user_service_id _ ' ' _ item.user_id }}"
                        }
                    ],
                {{ END }}

                {{ IF userServices.size == limit }}
                    [
                        {
                            "text": "–ï—â—ë ‚û°Ô∏è",
                            "callback_data": "admin:users:list {{ limit + offset }}"
                        }
                    ],
                {{ END }}

                {{ IF offset > 0 }}
                    [
                        {
                            "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
                            "callback_data": "admin:users:list {{ offset - limit }}"
                        }
                    ],
                {{ END }}

                [
                    {
                        "text": "‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É",
                        "callback_data": "admin:subs:add {{ userData.user_id }}"
                    }
                ],
                [
                    {
                        "text": "‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)",
                        "callback_data": "admin:subs:add:free {{ userData.user_id }}"
                    }
                ],
                [
                    {
                        "text": "‚¨ÖÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ",
                        "callback_data": "admin:users:id {{ userData.user_id _' '_ last_offset }}"
                    }
                ],
                [
                    {
                        "text": "üë®‚Äçüíª –ú–µ–Ω—é {{ menuRole = (user.settings.role == 'admin' ? '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞' : '–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞'); menuRole }}",
                        "callback_data": "admin:menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}

<% CASE ['admin:users:id:subs'] %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin' }}
{{
    limit = 7;
    last_offset = (args.1 || 0);
    offset = (args.2 || 0);
    userData = user.id(args.0);
    userServices = ref(userData.services.list_for_api('limit', limit, 'offset', offset));
}}

{{ TEXT = BLOCK }}
üîê <b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏</b>

üë§ –ò–º—è: {{ userData.full_name.replace('"', '\"')  }}
üÜî ID: {{ userData.user_id }}  
üì± Telegram: {{ userData.settings.telegram.login }}
üîë –õ–æ–≥–∏–Ω: {{ userData.login }}  

{{ IF userServices.size <= 0 }}
<b>–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –ø–æ–¥–ø–∏—Å–æ–∫!</b>
{{ END }}
{{ END }}

{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "{{ TEXT.replace('\n','\n') }}",
        "reply_markup": {
            "inline_keyboard": [
                {{ FOR item in userServices }}
                {{ status = (item.status == 'ACTIVE' ? "üü¢" : "üî¥") }}
                [
                    {
                        "text": "{{ status }} {{ item.user_service_id }} - {{ item.name }}",
                        "callback_data": "admin:subs:id {{ item.user_service_id _ ' ' _ item.user_id }}"
                    }
                ],
                {{ END }}

                {{ IF userServices.size == limit }}
                [
                    {
                        "text": "‚û°Ô∏è –ï—â—ë",
                        "callback_data": "admin:users:list {{ limit + offset }}"
                    }
                ],
                {{ END }}

                {{ IF offset > 0 }}
                [
                    {
                        "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
                        "callback_data": "admin:users:list {{ offset - limit }}"
                    }
                ],
                {{ END }}

                [
                    {
                        "text": "‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É",
                        "callback_data": "admin:subs:add {{ userData.user_id }}"
                    }
                ],
                [
                    {
                        "text": "‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)",
                        "callback_data": "admin:subs:add:free {{ userData.user_id }}"
                    }
                ],
                [
                    {
                        "text": "‚¨ÖÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ",
                        "callback_data": "admin:users:id {{ userData.user_id _' '_ last_offset }}"
                    }
                ],
                [
                    {
                        "text": "üë®‚Äçüíª –ú–µ–Ω—é {{ menuRole = (user.settings.role == 'admin' ? '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞' : '–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞'); menuRole; }}",
                        "callback_data": "admin:menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}


<% CASE '/admsubsadd' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin' }}
{{
    # Variables
    userData = user.id(args.0);
    servicesArray = ref(service.list_for_api).nsort('service_id');
}}

{{ TEXT = BLOCK }}
‚ûï –í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {{ userData.full_name.replace('"', '\"') }} ({{ userData.user_id }})
{{ END }}

{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "{{ TEXT.replace('\n','\n') }}",
        "reply_markup": {
            "inline_keyboard": [
                {{ FOR item in servicesArray }}
                    [
                        {
                            "text": "{{ item.name }} - {{ item.descr }} - {{ item.cost }} ‚ÇΩ",
                            "callback_data": "admin:subs:add:confirm {{ userData.user_id }} {{ item.service_id }}"
                        }
                    ],
                {{ END }}
                [
                    {
                        "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
                        "callback_data": "admin:users:id:subs {{ userData.user_id }} {{ args.1 }}"
                    }
                ],
                [
                    {
                        "text": "‚¨ÖÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ",
                        "callback_data": "admin:users:id {{ userData.user_id }} {{ last_offset }}"
                    }
                ]
            ]
        }
    }
}
{{ END }}


<% CASE 'admin:subs:add' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin' }}
{{
    # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    userData = user.id(args.0);
    servicesArray = ref(service.list_for_api).nsort('service_id');
    last_offset = args.1 || 0;
}}

{{ TEXT = BLOCK }}
‚ûï <b>–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</b>  
üë§ –ò–º—è: {{ userData.full_name.replace('"', '\"') }}  
üÜî ID: {{ userData.user_id }}

{{ IF servicesArray.size == 0 }}
‚ö†Ô∏è <b>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Å–ª—É–≥ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è.</b>
{{ END }}
{{ END }}

{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "{{ TEXT.replace('\n','\n') }}",
        "reply_markup": {
            "inline_keyboard": [
                {{ FOR item in servicesArray }}
                [
                    {
                        "text": "{{ item.name _' '_ item.descr }} - {{ item.cost }} ‚ÇΩ",
                        "callback_data": "admin:subs:add:confirm {{ userData.user_id _' '_ item.service_id }}"
                    }
                ],
                {{ END }}

                [
                    {
                        "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
                        "callback_data": "admin:users:id:subs {{ userData.user_id _' '_ args.1 }}"
                    }
                ],
                [
                    {
                        "text": "‚¨ÖÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ",
                        "callback_data": "admin:users:id {{ userData.user_id _' '_ last_offset }}"
                    }
                ]
            ]
        }
    }
}
{{ END }}


<% CASE 'admin:subs:add:free' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin' }}
{{
    # Variables
    userData = user.id(args.0);
    servicesArray = ref(service.list_for_api).nsort('service_id');
}}
{{ TEXT = BLOCK }}
‚ûï –í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É —Å 0 —Å—Ç–æ–∏–º–æ—Å—Ç—å—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {{ userData.full_name.replace('"', '\"')  }} ({{ userData.user_id }})
{{ END }}

{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "{{ TEXT.replace('\n','\n') }}",
        "reply_markup": {
            "inline_keyboard": [
    {{ FOR item in servicesArray }}
        [
            {
                "text": "{{ item.name _' '_ item.descr }} - {{ item.cost }} ‚ÇΩ",
                "callback_data": "admin:subs:add:confirm {{ userData.user_id _' '_ item.service_id _' free' }}"
            }
        ],
    {{ END }}
    [
        {
            "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
            "callback_data": "admin:users:id:subs {{ userData.user_id _' '_ args.1 }}"
        }
    ],
    [
        {
            "text": "‚¨ÖÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ",
            "callback_data": "admin:users:id {{ userData.user_id _' '_ last_offset }}"
        }
    ]
            ]
        }
    }
}
{{ END }}


<% CASE '/admusermsg' %>
{
"sendMessage": {
        "text": "#{{ args.0 }}#\n–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
        "reply_markup": {
            "force_reply": true
        }
    }
}

<% CASE 'admin:subs:id' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin' }}
{{
    # Arguments:
        # 0 - ID of user service id 
        # 1 - ID of user
    # Variables:
    USE date;
    userData = user.id(args.1);
    userService = userData.us.id(args.0);
    userServiceData = service.id(userService.service_id);
    userServiceNext = service.id(userService.next);
    userSubUrl = (userData.storage.read('name', 'vpn_mrzb_'_ userService.user_service_id).subscription_url || "https://notfound.com");
    subData = http.get(userSubUrl _'/info');
}}
{{ TEXT = BLOCK }}
üîê –ü–æ–¥–ø–∏—Å–∫–∞ {{ userServiceData.name }} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ userData.full_name.replace('"', '\"') }} ({{ userData.user_id }})

ID: {{ userService.user_service_id }}
ID —Å–ø–∏—Å–∞–Ω–∏—è: {{ userService.withdraw_id }}
–°—Ç–∞—Ç—É—Å: {{ userService.status }}
–°–æ–∑–¥–∞–Ω–∞: {{ userService.created }}
–ó–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è: {{ userService.expire }}
–°–ª–µ–¥—É—é—â–∏–π —Ç–∞—Ä–∏—Ñ: {{ userServiceNext.name }}

–ü–æ—Å–ª–µ–¥–Ω–∏–π –æ–Ω–ª–∞–π–Ω: {{ subData.online_at ? date.format(subData.online_at, '%d.%m.%Y %R') : '–Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏' }}

{{ END }}

{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "{{ TEXT.replace('\n','\n') }}",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üîó –ü–æ–¥–ø–∏—Å–∫–∞ {{ userService.user_service_id }} - {{ userServiceData.name }}",
                        "web_app": {
                            "url": "{{ userSubUrl }}"
                        }
                    }
                ],
                {{ IF userService.status == 'ACTIVE' || userService.status == 'BLOCK' }}
                    [
                        {
                            "text": "{{ status = (userService.status == 'ACTIVE' ? "üî¥ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å" : "üü¢ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å"); status; }}",
                            "callback_data": "admin:subs:change:status {{ userService.user_service_id }}"
                        }
                    ],
                {{ ELSIF userService.status == 'PROGRESS' }}
                    [
                        {
                            "text": "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ (–æ–±–Ω–æ–≤–∏—Ç–µ)",
                            "callback_data": "admin:subs:id {{ userService.user_service_id }}"
                        }
                    ],
                {{ END }}
                {{ IF userService.status == 'BLOCK' || userService.status == 'NOT PAID' }}
                    [
                        {
                            "text": "‚ùå –£–¥–∞–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É",
                            "callback_data": "admin:subs:delete {{ userService.user_service_id }}"
                        }
                    ],
                {{ END }}
                [
                    {
                        "text": "ü´∞ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–ø–∏—Å–∞–Ω–∏–∏",
                        "callback_data": "admin:withdraws:id {{ userService.withdraw_id }}"
                    }
                ],
                [
                    {
                        "text": "‚éò –°–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â. —Ç–∞—Ä–∏—Ñ",
                        "callback_data": "admin:subs:change:current {{ userService.user_service_id }}"
                    }
                ],
                [
                    {
                        "text": "‚éò –°–º–µ–Ω–∏—Ç—å —Å–ª–µ–¥. —Ç–∞—Ä–∏—Ñ",
                        "callback_data": "admin:subs:change:next {{ userService.user_service_id }}"
                    }
                ],
                [
                    {
                        "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
                        "callback_data": "admin:users:id:subs {{ userData.user_id }}"
                    }
                ],
                [
                    {
                        "text": "üë®‚Äçüíª –ú–µ–Ω—é {{ menuRole = (user.settings.role == 'admin' ? '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞' : '–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞'); menuRole; }}",
                        "callback_data": "admin:menu"
                    },
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}

<% CASE 'admin:subs:change:current' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin'; }}
{{
    userService = ref(us.list_for_api('admin', 1, 'filter', {"user_service_id" = args.0})).first;
    userData = user.id(userService.user_id);
    userServiceData = service.id(userService.service_id);
}}
{{ TEXT = BLOCK }}
‚éò –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ {{ userServiceData.name }} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ userData.full_name.replace('"', '\"')  }} ({{ userData.user_id }})

{{ END }}

{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "{{ TEXT.replace('\n','\n') }}",
        "reply_markup": {
            "inline_keyboard": [
                {{ FOR list IN ref(service.api_price_list).nsort('service_id') }}
                    [
                        {
                            "text": "{{ list.name _' '_ list.descr }} - {{ list.cost }} ‚ÇΩ",
                            "callback_data": "admin:subs:change:current:confirm {{ userService.user_service_id _ ' ' _ list.service_id }}"
                        }
                    ],
                {{ END }}
                [
                    {
                        "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
                        "callback_data": "admin:subs:id {{ userService.user_service_id }}"
                    }
                ],
                [
                    {
                        "text": "üë®‚Äçüíª –ú–µ–Ω—é {{ menuRole = (user.settings.role == 'admin' ? '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞' : '–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞'); menuRole; }}",
                        "callback_data": "admin:menu"
                    },
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}

<% CASE 'admin:subs:change:current:confirm' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin'; }}
{{
    nextService = args.1;
    data = ref(us.list_for_api('admin', 1, 'filter', {"user_service_id" = args.0})).first;
    userData = user.id(data.user_id);
    serviceData = service.id(data.service_id);
    userServiceNext = service.id(nextService);
}}
{{ TEXT = BLOCK }}
‚úÖ –¢–∞—Ä–∏—Ñ –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ {{ serviceData.name }} ({{ data.user_service_id }}) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ userData.full_name.replace('"', '\"')  }} ({{ userData.user_id }}) –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ {{ userServiceNext.name }}
{{ END }}
{
    "answerCallbackQuery": {
         "callback_query_id": {{ callback_query.id }},
         "parse_mode":"HTML",
         "text": "{{ TEXT.replace('\n','\n') }}",
         "show_alert": true
     }
},
{
    "shmRedirectCallback": {
        "callback_data": "admin:subs:id {{ data.user_service_id }}"
    }
}
{{ ret = userData.us.id(data.user_service_id).change('service_id' = nextService) }}


<% CASE 'admin:subs:change:next' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin'; }}
{{
    userService = ref(us.list_for_api('admin', 1, 'filter', {"user_service_id" = args.0})).first;
    userData = user.id(userService.user_id);
    userServiceData = service.id(userService.service_id);
    userServiceNext = service.id(userService.next);
}}
{{ TEXT = BLOCK }}
‚éò –í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —Ç–∞—Ä–∏—Ñ –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ {{ userServiceData.name }} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ userData.full_name.replace('"', '\"')  }} ({{ userData.user_id }})

{{ IF userService.next != userService.service_id || userService.next != 0 }}
–°–ª–µ–¥—É—é—â–∏–π —Ç–∞—Ä–∏—Ñ: {{ userServiceNext.name }} ({{ userService.next }})
{{ END }}
{{ END }}

{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "{{ TEXT.replace('\n','\n') }}",
        "reply_markup": {
            "inline_keyboard": [
                {{ FOR list IN ref(service.api_price_list).nsort('service_id') }}
                    [
                        {
                            "text": "{{ list.name _' '_ list.descr }} - {{ list.cost }} ‚ÇΩ",
                            "callback_data": "admin:subs:change:next:confirm {{ userService.user_service_id _ ' ' _ list.service_id }}"
                        }
                    ],
                {{ END }}
                [
                    {
                        "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
                        "callback_data": "admin:subs:id {{ userService.user_service_id }}"
                    }
                ],
                [
                    {
                        "text": "üë®‚Äçüíª –ú–µ–Ω—é {{ menuRole = (user.settings.role == 'admin' ? '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞' : '–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞'); menuRole; }}",
                        "callback_data": "admin:menu"
                    },
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}

<% CASE 'admin:subs:change:next:confirm' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin'; }}
{{
    nextService = args.1;
    data = ref(us.list_for_api('admin', 1, 'filter', {"user_service_id" = args.0})).first;
    userData = user.id(data.user_id);
    serviceData = service.id(data.service_id);
    userServiceNext = service.id(nextService);
}}
{{ ret = userData.us.id(data.user_service_id).set("next", nextService) }}
{{ TEXT = BLOCK }}
‚úÖ –°–ª–µ–¥—É—é—â–∏–π —Ç–∞—Ä–∏—Ñ –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ {{ serviceData.name }} ({{ data.user_service_id }}) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ userData.full_name.replace('"', '\"') }} ({{ userData.user_id }}) –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ {{ userServiceNext.name }}
{{ END }}
{
    "answerCallbackQuery": {
         "callback_query_id": {{ callback_query.id }},
         "parse_mode":"HTML",
         "text": "{{ TEXT.replace('\n','\n') }}",
         "show_alert": true
     }
},
{
    "shmRedirectCallback": {
        "callback_data": "admin:subs:id {{ data.user_service_id }}"
    }
}
{{ END }}

<% CASE 'admin:subs:change:status' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin'; }}
{{
    data = ref(us.list_for_api('admin', 1, 'filter', {"user_service_id" = args.0})).first;
    userData = user.id(data.user_id);
    serviceData = service.id(data.service_id);
}}
{{ IF data.status == 'ACTIVE' }}
    {{ ret = userData.us.id(data.user_service_id).block }}
{{ ELSIF data.status == 'BLOCK' }}
    {{ ret = userData.us.id(data.user_service_id).activate }}
{{ END }}
{
    "answerCallbackQuery": {
         "callback_query_id": {{ callback_query.id }},
         "parse_mode":"HTML",
         "text": "‚úÖ –£—Å–ª—É–≥–∞ {{ serviceData.name }} ({{ data.user_service_id }}) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ userData.full_name.replace('"', '\"')  }} ({{ userData.user_id }}) {{ status = (data.status == 'ACTIVE' ? "üî¥ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞" : "üü¢ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞"); status; }}",
        "show_alert": true
     }
},
{
    "shmRedirectCallback": {
        "callback_data": "admin:subs:id {{ data.user_service_id }}"
    }
}
{{ END }}

<% CASE 'admin:subs:delete' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin'; }}
{{
    data = ref(us.list_for_api('admin', 1, 'filter', {"user_service_id" = args.0})).first;
    userData = user.id(data.user_id);
    serviceData = service.id(data.service_id);
}}
{{ IF data.status == 'BLOCK' || data.status == 'NOT PAID' }}
    {{ ret = userData.us.id(data.user_service_id).delete }}
{{ END }}
{
    "answerCallbackQuery": {
         "callback_query_id": {{ callback_query.id }},
         "parse_mode":"HTML",
         "text": "‚ùå –£—Å–ª—É–≥–∞ {{ serviceData.name }} ({{ data.user_service_id }}) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ userData.full_name.replace('"', '\"')  }} ({{ userData.user_id }}) —É–¥–∞–ª–µ–Ω–∞!",
        "show_alert": true
     }
},
{
    "shmRedirectCallback": {
        "callback_data": "admin:users:id:subs {{ userData.user_id }}"
    }
}
{{ END }}

<% CASE 'admin:users:id:pays' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin'; }}
{{
    limit = 5;
    offset = args.1 || 0;
    userData = user.id(args.0);
    userPays = ref(userData.pays.list_for_api('limit', limit, 'offset', offset ));
}}
{{ TEXT = BLOCK }}
üë®‚Äçüíª –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ userData.full_name.replace('"', '\"') }} ({{ userData.user_id }})

{{ END }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "{{ TEXT.replace('\n','\n') }}",
        "reply_markup": {
            "inline_keyboard": [
                {{ FOR item in userPays }}
                    [
                        {
                            "text": "(ID: {{ item.id }}), {{ item.money }} —Ä—É–±, {{ item.date }}",
                            "callback_data": "admin:pays:id {{ item.id }}"
                        }
                    ],
                {{ END }}
                {{ IF offset > 0 }}
                    [
                        {
                            "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
                            "callback_data": "admin:users:id:pays {{ userData.user_id _' ' }} {{ offset - limit }}"
                        }
                    ],
                {{ END }}
                {{ IF userPays.size == limit }}
                    [
                        {
                            "text": "–ï—â—ë ‚û°Ô∏è",
                            "callback_data": "admin:users:id:pays {{ userData.user_id _' ' }} {{ limit + offset }}"
                        }
                    ],
                {{ END }}
                [
                    {
                        "text": "‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç–µ–∂",
                        "callback_data": "admin:pays:add {{ userData.user_id }}"
                    }
                ],
                [
                    {
                        "text": "‚¨ÖÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ",
                        "callback_data": "admin:users:id {{ userData.user_id }}"
                    }
                ],
                [
                    {
                        "text": "üë®‚Äçüíªüë®‚Äçüíª –ú–µ–Ω—é {{ menuRole = (user.settings.role == 'admin' ? '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞' : '–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞'); menuRole; }}",
                        "callback_data": "admin:menu"
                    },
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}

<% CASE 'admin:pays:id' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin'; }}
{{
    userPay = ref(pay.list_for_api('admin', 1, 'filter', {"id" = args.0})).first;
    payData = userPay.comment.object;
    payMethod = payData.payment_method;
    payCard = payMethod.card;
    userData = user.id(userPay.user_id);
	partnerData = user.id(data.comment.from_user_id);
}}
{{ TEXT = BLOCK }}
üí∏ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞—Ç–µ–∂–µ ID {{ userPay.id }} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ userData.full_name.replace('"', '\"')  }} ({{ userData.user_id }})

–î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞: {{ userPay.date }}
–ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞: {{ userPay.pay_system_id }}
–°—É–º–º–∞: {{ userPay.money }} —Ä—É–±.

{{ IF data.comment.from_user_id }}
<blockquote>{{ data.comment.percent }}% –æ—Ç {{ userData.full_name.replace('"', '\"')  }} ({{ partnerData.user_id }})</blockquote>
{{ END }}

{{ IF data.comment.msg }}
<blockquote>{{ data.comment.msg }}</blockquote>
{{ END }}

{{ IF userPay.comment.comment }}
<b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø–ª–∞—Ç–µ–∂—É</b>
<blockquote>{{ userPay.comment.comment }}</blockquote>
{{ END }}

{{ IF payData }}
<b>–î–∞–Ω–Ω—ã–µ –æ –ø–ª–∞—Ç–µ–∂–µ</b>
<blockquote>
ID –≤ —Å–∏—Å—Ç–µ–º–µ: {{ payData.id }}
–°—Ç–∞—Ç—É—Å: {{ payData.status }}
{{ IF payCard }}
–¢–∏–ø –∫–∞—Ä—Ç—ã: {{ payCard.card_type }}
–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã: {{ payCard.first6 }}******{{ payCard.last4 }}
–ë–∞–Ω–∫: {{ payCard.issuer_name }}
–°—Ç—Ä–∞–Ω–∞ –±–∞–Ω–∫–∞: {{ payCard.issuer_country }}
–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: {{ payCard.expiry_month }}/{{ payCard.expiry_year }}
{{ END }}
{{ IF payMethod.type == 'sbp' }}
–¢–∏–ø –æ–ø–ª–∞—Ç—ã: –°–ë–ü
–ù–æ–º–µ—Ä –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –°–ë–ü: {{ payMethod.sbp_operation_id }}
–ë–∏–∫ –ë–∞–Ω–∫–∞: {{ payMethod.payer_bank_details.bic }}
{{ END }}

{{ IF payMethod.title.match('YooMoney') }}
–ö–æ—à–µ–ª–µ–∫ YooMoney: {{ payMethod.title }}
ID –∫–æ—à–µ–ª—å–∫–∞: {{ payMethod.account_number }}
{{ END }}
</blockquote>
{{ END }}

{{ END }}

{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "{{ TEXT.replace('\n','\n') }}",
        "reply_markup": {
            "inline_keyboard": [
    [
        {
            "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
            "callback_data": "admin:users:id:pays {{ userPay.user_id }}"
        }
    ],
    [
        {
            "text": "üë®‚Äçüíª –ú–µ–Ω—é {{ menuRole = (user.settings.role == 'admin' ? '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞' : '–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞'); menuRole; }}",
            "callback_data": "admin:menu"
        },
        {
            "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
            "callback_data": "/menu"
        }
    ]
            ]
        }
    }
}
{{ END }}

<% CASE 'admin:pays:add' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin'; }}
{{
    userData = user.id(args.0);
}}
{{ TEXT = BLOCK }}
üí∏ –í—ã–±–µ—Ä–∏—Ç–µ —Å—É–º–º—É, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—Ç–∏—Ç–µ –Ω–∞—á–∏—Å–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {{ userData.full_name.replace('"', '\"')  }} ({{ userData.user_id }})
–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: {{ userData.balance }} —Ä—É–±.

{{ END }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "{{ TEXT.replace('\n','\n') }}",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "10 —Ä—É–±",
                        "callback_data": "admin:pays:add:confirm {{ userData.user_id }} 10"
                    },
                    {
                        "text": "20 —Ä—É–±",
                        "callback_data": "admin:pays:add:confirm {{ userData.user_id }} 20"
                    }
                ],
                [
                    {
                        "text": "50 —Ä—É–±",
                        "callback_data": "admin:pays:add:confirm {{ userData.user_id }} 50"
                    },
                    {
                        "text": "100 —Ä—É–±",
                        "callback_data": "admin:pays:add:confirm {{ userData.user_id }} 100"
                    }
                ],
                [
                    {{ FOR item IN ref(service.api_price_list('category', '%')).nsort('cost') }}
                        {
                            "text": "{{ item.name }} - {{ item.cost }}‚ÇΩ",
                            "callback_data": "admin:pays:add:confirm {{ userData.user_id _ ' ' }} {{ item.cost }}"
                        },
                    {{ END }}
                ],
                [
                    {
                        "text": "–í–≤–µ—Å—Ç–∏ —Å–≤–æ—é —Å—É–º–º—É",
                        "callback_data": "admin:pays:add:manual {{ userData.user_id }}"
                    }
                ],
                [
                    {
                        "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
                        "callback_data": "admin:users:id:pays {{ userData.user_id }}"
                    }
                ],
                [
                    {
                        "text": "üë®‚Äçüíª –ú–µ–Ω—é {{ menuRole = (user.settings.role == 'admin' ? '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞' : '–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞'); menuRole; }}",
                        "callback_data": "admin:menu"
                    },
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}

<% CASE 'admin:pays:add:manual' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin'; }}
{{
    userData = user.id(args.0);

    ret = user.set_settings({'state' => 'awaiting_amount'});
    ret = user.set_settings({'bot' => {'switchUser' => userData.user_id} });
}}

{{ TEXT = BLOCK }}
üí¨ –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ userData.full_name.replace('"', '\"') }}
{{ END }}



<% CASE 'admin:pays:add:confirm' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin'; }}
{{
    userData = user.id(args.0);
    amount = args.1;
    pay = userData.payment('money', amount, 'pay_system_id', '–†—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞')
}}
{
    "answerCallbackQuery": {
         "callback_query_id": {{ callback_query.id }},
         "parse_mode":"HTML",
         "text": "–ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ userData.full_name.replace('"', '\"')  }} ({{ userData.user_id }}) –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ {{ amount }} —Ä—É–±. –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å - {{ userData.balance }}",
         "show_alert": true
     }
},
{
    "shmRedirectCallback": {
        "callback_data": "admin:pays:add {{ userData.user_id }}"
    }
}
{{ END }}

<% CASE 'admin:users:id:bonuses' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin'; }}
{{
    limit = 5;
    offset = (args.1 || 0);
    userData = user.id(args.0);
    userBonuses = ref(bonus.list_for_api('admin', 1, 'limit', limit, 'offset', offset, 'filter', {"user_id" = userData.user_id}));
}}
{{ TEXT = BLOCK }}
üë®‚Äçüíª –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ userData.full_name.replace('"', '\"')  }} ({{ userData.user_id }})

–ë–∞–ª–∞–Ω—Å –±–æ–Ω—É—Å–æ–≤: {{ userData.get_bonus }} —Ä—É–±.
{{ END }}

{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "{{ TEXT.replace('\n','\n') }}",
        "reply_markup": {
            "inline_keyboard": [
                {{ FOR item in userBonuses }}
                    [
                        {
                            "text": "ID: {{ item.id }} ‚Äî {{ item.bonus }} —Ä—É–±.",
                            "callback_data": "admin:bonuses:id {{ item.id _ ' ' _ offset }}"
                        }
                    ],
                {{ END }}
                {{ IF offset > 0 }}
                    [
                        {
                            "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
                            "callback_data": "admin:users:id:bonuses {{ userData.user_id _' ' }} {{ offset - limit }}"
                        }
                    ],
                {{ END }}
                {{ IF userBonuses.size == limit }}
                    [
                        {
                            "text": "–ï—â—ë ‚û°Ô∏è",
                            "callback_data": "admin:users:id:bonuses {{ userData.user_id _' ' }} {{ limit + offset }}"
                        }
                    ],
                {{ END }}
                [
                    {
                        "text": "‚ûï –î–æ–±–∞–≤–∏—Ç—å –±–æ–Ω—É—Å—ã",
                        "callback_data": "admin:bonuses:add {{ userData.user_id }}"
                    }
                ],
                [
                    {
                        "text": "‚¨ÖÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ",
                        "callback_data": "admin:users:id {{ userData.user_id }}"
                    }
                ],
                [
                    {
                        "text": "üë®‚Äçüíª –ú–µ–Ω—é {{ menuRole = (user.settings.role == 'admin' ? '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞' : '–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞'); menuRole; }}",
                        "callback_data": "admin:menu"
                    },
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}


<% CASE 'admin:bonuses:id' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin'; }}
{{
    offset = args.1;
    data = ref(bonus.list_for_api('admin', 1, 'limit', limit, 'offset', offset, 'filter', {"id" = args.0})).first;
    userData = user.id(data.user_id);
    partnerData = user.id(data.comment.from_user_id)
}}
{{ TEXT = BLOCK }}
üí∏ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏ –±–æ–Ω—É—Å–æ–≤ ID {{ data.id }} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {{ userData.full_name.replace('"', '\"')  }} ({{ userData.user_id }})

ID –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è: {{ data.id }}
–î–∞—Ç–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è: {{ data.date }}
–°—É–º–º–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è: {{ data.bonus }} —Ä—É–±.

{{ IF data.comment.from_user_id }}
<blockquote>{{ data.comment.percent }}% –æ—Ç {{ userData.full_name.replace('"', '\"')  }} ({{ partnerData.user_id }})</blockquote>
{{ END }}

{{ IF data.comment.msg }}
<blockquote>{{ data.comment.msg }}</blockquote>
{{ END }}
{{ END }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "{{ TEXT.replace('\n','\n') }}",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
                        "callback_data": "admin:users:id:bonuses {{ userData.user_id _ ' ' _ offset }}"
                    }
                ],
                [
                    {
                        "text": "üë®‚Äçüíª –ú–µ–Ω—é {{ menuRole = (user.settings.role == 'admin' ? '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞' : '–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞'); menuRole; }}",
                        "callback_data": "admin:menu"
                    },
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}


<% CASE 'admin:bonuses:add' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin'; }}
{{
    userData = user.id(args.0);
}}
{{ TEXT = BLOCK }}
üí∏ –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª-–≤–æ –±–æ–Ω—É—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç–∏—Ç–µ –Ω–∞—á–∏—Å–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {{ userData.full_name.replace('"', '\"')  }} ({{ userData.user_id }})
–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –±–æ–Ω—É—Å–æ–≤ {{ userData.get_bonus }} —Ä—É–±.

{{ END }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "{{ TEXT.replace('\n','\n') }}",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "10 —Ä—É–±",
                        "callback_data": "admin:bonuses:add:confirm {{ userData.user_id }} 10"
                    },
                    {
                        "text": "20 —Ä—É–±",
                        "callback_data": "admin:bonuses:add:confirm {{ userData.user_id }} 20"
                    },
                    {
                        "text": "30 —Ä—É–±",
                        "callback_data": "admin:bonuses:add:confirm {{ userData.user_id }} 30"
                    },
                    {
                        "text": "40 —Ä—É–±",
                        "callback_data": "admin:bonuses:add:confirm {{ userData.user_id }} 40"
                    }
                ],
                [
                    {
                        "text": "50 —Ä—É–±",
                        "callback_data": "admin:bonuses:add:confirm {{ userData.user_id }} 50"
                    },
                    {
                        "text": "100 —Ä—É–±",
                        "callback_data": "admin:bonuses:add:confirm {{ userData.user_id }} 100"
                    },
                    {
                        "text": "150 —Ä—É–±",
                        "callback_data": "admin:bonuses:add:confirm {{ userData.user_id }} 150"
                    },
                    {
                        "text": "200 —Ä—É–±",
                        "callback_data": "admin:bonuses:add:confirm {{ userData.user_id }} 200"
                    }
                ],
                [
                    {
                        "text": "–£–±—Ä–∞—Ç—å {{ userData.get_bonus }}",
                        "callback_data": "admin:bonuses:add:confirm {{ userData.user_id }} -{{ userData.get_bonus }}"
                    }
                ],
                [
                    {
                        "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
                        "callback_data": "admin:users:id:bonuses {{ userData.user_id }}"
                    }
                ],
                [
                    {
                        "text": "üë®‚Äçüíª –ú–µ–Ω—é {{ menuRole = (user.settings.role == 'admin' ? '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞' : '–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞'); menuRole; }}",
                        "callback_data": "admin:menu"
                    },
                    {
                        "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}


<% CASE 'admin:bonuses:add:confirm' %>
{{
    userData = user.id(args.0);
    amount = args.1;
}}

{{ IF amount < 0 }}
    {{ ret = userData.set_bonus('bonus', amount, 'comment', {'msg' => '–†—É—á–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞'}); }}
{{ ELSE }}
    {{ ret = userData.set_bonus('bonus', amount, 'comment', {'msg' => '–†—É—á–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞'}); }}
    {
        "sendMessage": {
            "chat_id": {{ userData.settings.telegram.chat_id }},
            "text": "üéÅ –í–∞–º –Ω–∞—á–∏—Å–ª–µ–Ω–æ {{ amount }} –±–æ–Ω—É—Å–æ–≤ –Ω–∞ —Å—á–µ—Ç –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞",
            "parse_mode": "HTML",
            "reply_markup": {
                "inline_keyboard": [
                    [
                        {
                            "text": "üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç",
                            "callback_data": "cabinet"
                        }
                    ]
                ]
            }
        }
    },
{{ END }}

{
    "answerCallbackQuery": {
         "callback_query_id": {{ callback_query.id }},
         "parse_mode":"HTML",
         "text": "–ë–∞–ª–∞–Ω—Å –±–æ–Ω—É—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ userData.full_name.replace('"', '\"')  }} ({{ userData.user_id }}) –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ {{ amount }} —Ä—É–±. –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å - {{ userData.get_bonus }}",
         "show_alert": true
     }
},
{
    "shmRedirectCallback": {
        "callback_data": "admin:bonuses:add {{ userData.user_id }}"
    }
}


<% CASE 'admin:withdraws:id' %>
{{
    data = ref(wd.list_for_api('admin', 1, 'filter', {"withdraw_id" = args.0})).first;
    userData = user.id(data.user_id);
}}
{{ TEXT = BLOCK }}
üí∏ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–ø–∏—Å–∞–Ω–∏–∏ ‚Ññ{{ data.withdraw_id }}

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {{ userData.full_name.replace('"', '\"')  }} ({{ userData.user_id }})

–£—Å–ª—É–≥–∞: {{ data.name }} ({{ data.user_service_id }})
–°—Ç–æ–∏–º–æ—Å—Ç—å: {{ data.cost }}
–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: {{ data.create_date }}
–î–∞—Ç–∞ —Å–ø–∏—Å–∞–Ω–∏—è: {{ data.withdraw_date }}
–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ —Å–ø–∏—Å–∞–Ω–∏—é: {{ data.end_date }}
–ö–æ–ª-–≤–æ –º–µ—Å—è—Ü–µ–≤: {{ data.months }}

<b>–°–ø–∏—Å–∞–Ω–∏–µ:</b>
<blockquote>
–°–∫–∏–¥–∫–∞: {{ data.discount }}%
–ë–æ–Ω—É—Å–æ–≤: {{ data.bonus }} —Ä—É–±
<b>–í—Å–µ–≥–æ: {{ data.total }}</b>

</blockquote>
{{ END }}

{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "{{ TEXT.replace('\n','\n') }}",
        "reply_markup": {
            "inline_keyboard": [
    [
        {
            "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
            "callback_data": "admin:subs:id {{ data.user_service_id _ ' ' _  userData.user_id }}"
        }
    ],
    [
        {
            "text": "üë®‚Äçüíª –ú–µ–Ω—é {{ menuRole = (user.settings.role == 'admin' ? '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞' : '–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞'); menuRole; }}",
            "callback_data": "admin:menu"
        },
        {
            "text": "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
            "callback_data": "/menu"
        }
    ]
]
        }
    }
}


<% CASE '/admuserblock_toggle' %>
{{ IF user.settings.role == 'moderator' || user.settings.role == 'admin'; }}
{{
    # Arguments 
    #   0. - id of user

    # Variables
        userData = user.id(args.0);
}}
{{ retcode = (userData.block == 1 ? "0" : "1"); }}
{{ ret = userData.set(block = retcode) }}

{
    "answerCallbackQuery": {
        "callback_query_id": {{ callback_query.id }},
        "parse_mode": "HTML",
        "text": "‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {{ userData.full_name.replace('"', '\"')  }} ({{ userData.user_id }}) {{ status = (userData.block == 1 ? "üî¥ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω" : "üü¢ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω"); status; }}",
        "show_alert": true
    }
},
{
    "shmRedirectCallback": {
        "callback_data": "/admuser {{ userData.user_id }}"
    }
}
{{ END }}

<% END %>
