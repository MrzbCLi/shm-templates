<% SWITCH cmd %>
<% CASE 'USER_NOT_FOUND' %>
{
    "shmRegister": {
        "partner_id": "{{ args.0 }}",
        "callback_data": "/start",
        "error": "–û–®–ò–ë–ö–ê: –õ–æ–≥–∏–Ω {{ message.chat.username }} –∏–ª–∏ chat_id {{ message.chat.id }} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    }
}
<% CASE ['/start', '/menu', 'üåç –ì–ª–∞–≤–Ω–æ–µ –ú–µ–Ω—é', 'üîÑ –û–±–Ω–æ–≤–∏—Ç—å'] %>
{{ IF cmd != '/start' }}
{
    "deleteMessage": {
        "message_id": {{ message.message_id }}
    }
},
{{ END }}
{
    "sendPhoto": {
        "photo": "{{ config.logo.url }}", 
        "caption": "üëã <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <u>{{ user.full_name }}</u>!</b>\n\nüåê <b>{{ config.company.name }}</b> ‚Äî –≤–∞—à —ç–∫—Å–ø–µ—Ä—Ç –≤ –æ–±–ª–∞—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∏ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.\n\n<b>‚ú® –ß—Ç–æ –º—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º?</b>\n\nüíº <b>–ü–µ—Ä–µ–¥–æ–≤—ã–µ —Ç–∞—Ä–∏—Ñ—ã:</b>\n‚úîÔ∏è –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.\n‚úîÔ∏è –ù–∞–¥—ë–∂–Ω–∞—è –∑–∞—â–∏—Ç–∞ –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö.\n‚úîÔ∏è –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.\n\nüì≤ <b>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞–ª–æ –ø—Ä–æ—â–µ:</b>\n- <a href=\"{{ config.apk.android }}\">üì≤ <b>–°–∫–∞—á–∞—Ç—å –¥–ª—è Android</b></a>\n- <a href=\"{{ config.apk.ios }}\">üì≤ <b>–°–∫–∞—á–∞—Ç—å –¥–ª—è iOS</b></a>\n\n‚≠ê <b>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã —Å –Ω–∞–º–∏:</b>\n- –£–¥–æ–±—Å—Ç–≤–æ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ.\n- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 24/7.\n- –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä–æ–π –º–æ–∂–Ω–æ –¥–æ–≤–µ—Ä—è—Ç—å.\n\nüí° <i>–û—Å—Ç–∞–≤–∞–π—Ç–µ—Å—å –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏ ‚Äî —ç—Ç–æ –ø—Ä–æ—â–µ, —á–µ–º –∫–∞–∂–µ—Ç—Å—è!</i>",
		"parse_mode": "HTML",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üíµ –ë–∞–ª–∞–Ω—Å: {{ user.balance }} ‚ÇΩ",
                        "callback_data": "/balance"
                    },
                    {
                        "text": "‚ûï –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å",
                        "web_app": {
                            "url": "{{ config.api.url }}/shm/v1/template/tg_payments_webapp?format=html&session_id={{ user.gen_session.id }}"
                        }
                    }
                ],
                [
                    {
                        "text": "üóù –°–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π",
                        "callback_data": "/list"
                    },
                    {
                        "text": "üõí –ö—É–ø–∏—Ç—å –∫–ª—é—á",
                        "callback_data": "/buy_mz_key"
                    }
                ],
                [
                    {
                        "text": "üéÅ –¢–µ—Å—Ç 5 –¥–Ω–µ–π",
                        "callback_data": "/test_mz"
                    },
					{
                        "text": "ü§ù –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞",
                        "callback_data": "/referrals"
                    }
                ],
                [
                    {
                        "text": "üìñ –ü–æ–º–æ—â—å",
                        "callback_data": "/help"
                    }
                ]
                {{ IF message.chat.id == config.telegram_admin.id OR message.chat.id == config.telegram_admin2.id OR message.chat.id == config.telegram_admin3.id }},
                [
                    {
                        "text": "üîß –ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/adminmenu"
                    }
                ]
                {{ END }},
                [
                    {
                        "text": "üîÑ –û–±–Ω–æ–≤–∏—Ç—å",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}

<% CASE '/balance' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendMessage": {
        "text": "üí∞ <b>–ë–∞–ª–∞–Ω—Å</b>: {{ user.balance }}\n\n–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø–ª–∞—Ç–∏—Ç—å: <b>{{ user.pays.forecast('blocked',1).total }}</b>",
        "reply_markup" : {
            "inline_keyboard": [
                [ { "text": "‚úö –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å", "web_app": { "url": "{{ config.api.url }}/shm/v1/template/tg_payments_webapp?format=html&session_id={{ user.gen_session.id }}" } } ],
                [ { "text": "‚ò∞ –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π", "callback_data": "/pays" } ],
                [ { "text": "üîÑ –û–±–Ω–æ–≤–∏—Ç—å", "callback_data": "/balance" } ],
                [ { "text": "‚á¶ –ù–∞–∑–∞–¥", "callback_data": "/menu" } ]
            ]
        }
    }
}

<% CASE ['/pays', '–ò—Å—Ç–æ—Ä–∏—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π'] %>
{
    "deleteMessage": { 
        "message_id": {{ message.message_id }} 
    },
    "sendPhoto": {
        "photo": "{{ config.logo.url }}",
        "protect_content": false,
        "parse_mode": "HTML",
        "caption": "üí≥ <b>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π</b> üßæ\n\nüìÖ <i>–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è.</i>\n\nüîΩ <b>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:</b>\n\n{{ FOR item IN pay.list_for_api('limit', 3) }}\n<u>üìÖ <b>–î–∞—Ç–∞:</b> {{ item.date }} | üíµ <b>–°—É–º–º–∞:</b> {{ item.money }} —Ä—É–±. | üè¶ <b>–ü–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:</b> {{ item.pay_system_id }}</u>\n{{ END }}\n\n<b>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π:</b>",
        "reply_markup": {
            "inline_keyboard": [
                [ 
                    { "text": "üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é", "callback_data": "/pays" } 
                ],
                [ 
                    { 
                        "text": "üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é",
                        "callback_data": "/menu" 
                    }
                ]
            ]
        }
    }
}



<% CASE '/list' %>
{{ hasnotpaidus = ref(user.services.list_for_api('category', '%', 'filter', { 'status' => 'NOT PAID' } )).size }}
{{ hasblocked = ref(user.services.list_for_api('category', '%', 'filter', { 'status' => 'BLOCK' } )).size }}
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendPhoto": {
        "photo": "{{ config.logo.url }}",
		"parse_mode": "HTML",
        "caption": "‚≠êÔ∏è <b>–ú–æ–π ID:</b> {{ user.id }} ‚≠êÔ∏è\n\nüí° –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–∞—à–µ–º –∫–ª—é—á–µ, –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –µ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏–µ.\n\n‚ùáÔ∏è –î–ª—è <b>—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏–ª–∏ –ø—Ä–æ–¥–ª–µ–Ω–∏—è</b> —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è –∫–ª—é—á–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å.\n\nüîë <b>–í–∞—à–∏ –∫—É–ø–ª–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏:</b>",
        "reply_markup": {
            "inline_keyboard": [
                {{ FOR item IN ref( user.services.list_for_api( 'category', '%' ) ) }}
                {{ SWITCH item.status }}
                  {{ CASE 'ACTIVE' }}
                  {{ icon = '‚úÖ' }}
                  {{ status = ' –†–∞–±–æ—Ç–∞–µ—Ç' }}
                  {{ CASE 'BLOCK' }}
                  {{ icon = '‚ùå' }}
                  {{ status = ' –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞' }}
                  {{ CASE 'NOT PAID' }}
                  {{ icon = 'üí∞' }}
                  {{ status = ' –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã' }}
                  {{ CASE }}
                  {{ icon = '‚è≥' }}
                  {{ status = ' –û–±—Ä–∞–±–æ—Ç–∫–∞' }}
                {{ END }}
                [
                    {
                        "text": "{{ item.name }} - {{ icon }} {{ status }}",
                        "callback_data": "/service {{ item.user_service_id }}"
                    }
                ],
                {{ END }}
                [
                    {
                        "text": "üõí –ö—É–ø–∏—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á üõí",
                        {{ IF hasnotpaidus > 0 || hasblocked > 0 }}
                            "callback_data": "/hint"
                        {{ ELSE }}
                            "callback_data": "/buy_mz_key"
                        {{ END }}
                    }
                ],
                [
                    {
                        "text": "üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ üîÑ",
                        "callback_data": "/list"
                    }
                ],
                [
                    {
                        "text": "üîå –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫–ª—é—á? üîå",
                        "url": "https://telegra.ph/Instrukciya-dlya-iPhoneiPad-11-27"
                    }
                ],
                [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é ‚á¶",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}


<% CASE '/hint' %>
{
   "answerCallbackQuery": {
        "callback_query_id": {{ callback_query.id }},
        "parse_mode":"HTML",
        "text": "üßê –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ üí≥ –∏–ª–∏ —É–¥–∞–ª–∏—Ç–µ üóëÔ∏è –≤—Å–µ –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ –∏–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏..–≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤–∞—à–µ–π —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏",
        "show_alert": true
    }
}

<% CASE '/service' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{{ item = us.id(args.0) }}
{{ us = user.services.list_for_api('usi', args.0) }}
{
    "sendPhoto": {
        {{ SWITCH us.status }}
          {{ CASE 'ACTIVE' }}
              {{ icon = '‚úÖ' }}
              {{ status = ' –†–∞–±–æ—Ç–∞–µ—Ç' }}
          {{ CASE 'BLOCK' }}
              {{ icon = '‚ùå' }}
              {{ status = ' –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞' }}
          {{ CASE 'NOT PAID' }}
              {{ icon = 'üí∞' }}
              {{ status = ' –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã' }}
          {{ CASE }}
              {{ icon = '‚è≥' }}
              {{ status = ' –û–±—Ä–∞–±–æ—Ç–∫–∞' }}
        {{ END }}
        "photo": "https://vpnbot.pro/images/DALL-E-2024-11-30-19-58.jpg",
        "caption": "üîî <b>–ü–æ–¥–ø–∏—Å–∫–∞:</b> <i>{{ item.name }} {{ item.user_service_id }}</i>\nüìÖ <b>–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞:</b> {{ USE date }}{{ date.format(item.created, '%d.%m.%Y–≥. %H:%M') }}\n‚è≥ <b>–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ:</b> {{ USE date }}{{ date.format(item.expire, '%d.%m.%Y–≥. %H:%M') }}",
        "parse_mode": "HTML",
        "reply_markup": {
            "inline_keyboard": [
                {{ IF us.status == 'ACTIVE' }}
                {{ subscription_url = storage.read('name', 'vpn_mrzb_' _ args.0).subscription_url }}
                {{ IF us.category.grep('^(VPN-)').first }}
                {{ IF subscription_url.grep('^https:').first }}
                [
                    {
                        "text": "üîó –ü–æ–∫–∞–∑–∞—Ç—å –∫–ª—é—á–∏ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è",
                        "callback_data": "/show_mz_keys {{ args.0 }}"
                    }
                ],
                {{ ELSE }}
                [
                    {
                        "text": "‚ö†Ô∏è –û–®–ò–ë–ö–ê: –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ SSL –¥–ª—è Marzban",
                        "callback_data": "/menu"
                    }
                ],
                {{ END }}
                {{ ELSE }}
                [
                    {
                        "text": "üóù –°–∫–∞—á–∞—Ç—å –∫–ª—é—á",
                        "callback_data": "/download_qr {{ args.0 }}"
                    },
                    {
                        "text": "üëÅ –ü–æ–∫–∞–∑–∞—Ç—å QR –∫–æ–¥",
                        "callback_data": "/show_qr {{ args.0 }}"
                    }
                ],
                {{ END }}
                {{ END }}
                  {{ IF us.status == 'NOT PAID' || us.status == 'BLOCK' }}
                [
                    {
                        "text": "üí≥ –û–ø–ª–∞—Ç–∏—Ç—å —Å–µ–π—á–∞—Å",
                        "callback_data": "/balance {{ user.pays.forecast('blocked', 1).total }}"
                    }
                ],
                {{ END }}
                {{ IF us.status != 'PROGRESS' }}
                [
                    {
                        "text": "üóë –£–¥–∞–ª–∏—Ç—å –∫–ª—é—á",
                        "callback_data": "/delete {{ args.0 }}"
                    }
                ],
                {{ END }}
                [
                    {
                        "text": "üîç –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ VPN",
                        "callback_data": "/xray"
                    }
                ],
                [
                    {
                        "text": "‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É —É—Å–ª—É–≥",
                        "callback_data": "/list"
                    }
                ]
            ]
        }
    }
}



<% CASE ['/pricelist', 'üöÄ –ü—Ä–∞–π—Å –ª–∏—Å—Ç'] %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendPhoto": {
        "photo": "{{ config.logo.url }}",
        "protect_content": true,
        "parse_mode": "HTML",
        "caption": "üí°<b>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É üîê –í—ã–¥–∞—Ç—å VPN:</b>\n",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üîê –í—ã–¥–∞—Ç—å VPN",
                        "callback_data": "/buy_mz_key"
                    }
                ],
                [
                    {
                        "text": "üìã –ú–æ–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–ª—é—á–∏",
                        "callback_data": "/list"
                    }
                ],
                [
                    {
                        "text": "üí¨ –ü–æ–º–æ—â—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞",
                        "callback_data": "/support"
                    }
                ],
                [
                    {
                        "text": "‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}


<% CASE '/buy_mz_key' %>
{{ hasnotpaidus = ref(user.services.list_for_api('category', '%', 'filter',{ 'status' => 'NOT PAID' } )).size }}
{{ hasblocked = ref(user.services.list_for_api('category', '%', 'filter',{ 'status' => 'BLOCK' } )).size }}
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendMessage": {
        "text": "üîë <b>–ü–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –Ω–∞—à–∏–º VPN —Å–µ—Ä–≤–∏—Å–∞–º –∏ —É–ª—É—á—à–∏—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å!</b>\n\nüåç –°—Ç–∞–±–∏–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –≤ –ï–≤—Ä–æ–ø–µ –∏ –†–æ—Å—Å–∏–∏!\nüíª –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ –ø–µ—Ä–≤–æ–º –º–µ—Å—Ç–µ —Å –Ω–∞—à–∏–º–∏ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏.\nüöÄ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ –∏–ª–∏ –æ–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.\n\n<b>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</b>\n\n‚úÖ –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\n‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É\n‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è\n\n–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ç–∞—Ä–∏—Ñ:",
        "reply_markup": {
            "inline_keyboard": [
                {{ FOR item IN ref(service.api_price_list).nsort('service_id') }}
                    {{ IF item.category == 'VPN-EUROPE-MONTH' or item.category == 'VPN-EUROPE-HOUR' or item.category == 'RESET-BALANCE' or item.category == 'VPN-RUSSIA-MONTH' }}
                        {{ IF item.service_id }}
                            [
                                {
                                    "text": "{{ item.name }} - {{ item.cost }} —Ä—É–±/–º–µ—Å.",
                                    {{ IF hasnotpaidus > 0 || hasblocked > 0 }}
                                    "callback_data": "/hint"
                                    {{ ELSE }}
                                    "callback_data": "/serviceorder {{ item.service_id }}"
                                    {{ END }}
                                },
                                {
                                    "text": "6/–º–µ—Å - {{ item.cost * 6 }} —Ä—É–±.",
                                    {{ IF hasnotpaidus > 0 || hasblocked > 0 }}
                                    "callback_data": "/hint"
                                    {{ ELSE }}
                                    "callback_data": "/serviceorder {{ item.service_id }} 6"
                                    {{ END }}
                                }
                            ],
                        {{ ELSE }}
                            [
                                {
                                    "text": "–û—à–∏–±–∫–∞: –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Å–ª—É–≥.",
                                    "callback_data": "/menu"
                                }
                            ]
                        {{ END }}
                    {{ END }}
                {{ END }}
                [
                    {
                        "text": "‚Ü©Ô∏è –û–±–Ω–æ–≤–∏—Ç—å",
                        "callback_data": "/buy_mz_key"
                    },
                    {
                        "text": "‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ —Ç–∞—Ä–∏—Ñ–∞–º",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}

<% CASE '/serviceorder' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "shmServiceOrder": {
        "service_id": "{{ args.0 }}",
        "callback_data": "/list",
        "cb_not_enough_money": "/menu",
        "error": "–û–®–ò–ë–ö–ê"
    }
},
{
    "answerCallbackQuery": {
        "callback_query_id": {{ callback_query.id }},
        "parse_mode":"HTML",
        "text": "–í–∞—à –∫–ª—é—á —Å–æ–∑–¥–∞–µ—Ç—Å—è...",
        "show_alert": true
    }
}


<% CASE '/notifications_active' %>
{{ item = us.id( args.0 ) }}
{{ subscription_url = storage.read('name','vpn_mrzb_' _ args.0 ).subscription_url }}
{
    "sendMessage": {
        "text": " –ü–æ–¥–ø–∏—Å–∫–∞: {{ item.name }} {{ item.user_service_id }} –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞.\nÔø®  {{ USE date }}{{  date.format( item.created, '%d.%m.%Y–≥. %H:%M')  }}\n–¥–æ: {{ USE date }}{{  date.format( item.expire, '%d.%m.%Y–≥. %H:%M')  }}",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üöÄ –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏",
                        "web_app": {
                            "url": "{{ config.api.url }}/shm/v1/template/subscriptions_link?format=html&session_id={{ user.gen_session.id }}&service_id={{ args.0 }}"
                        }
                    }
                ],
                [
                    {
                        "text": "–ú–µ–Ω—é",
                        "callback_data": "/start"
                    }
                ]
            ]
        }
    }
}


<% CASE '/delete' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendMessage": {
        "text": "ü§î <b>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∏. –£—Å–ª—É–≥—É –Ω–µ–ª—å–∑—è –±—É–¥–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å!</b>",
        "reply_markup" : {
            "inline_keyboard": [
                [
                    {
                        "text": "üß® –î–ê, –£–î–ê–õ–ò–¢–¨! üî•",
                        "callback_data": "/delete_confirmed {{ args.0 }}"
                    }
                ],

                [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/list"
                    }
                ]
            ]
        }
    }
}
<% CASE '/delete_confirmed' %>
{
    "deleteMessage": { 
        "message_id": "{{ message.message_id }}" 
    }
},
{
    "shmServiceDelete": {
        "usi": "{{ args.0 }}",
        "callback_data": "/list",
        "error": "–û–®–ò–ë–ö–ê"
    }
},
{
    "answerCallbackQuery": {
        "callback_query_id": "{{ callback_query.id }}",
        "parse_mode": "HTML",
        "text": "–í–∞—à –∫–ª—é—á —É–¥–∞–ª—è–µ—Ç—Å—è...",
        "show_alert": true
    }
}


<% CASE '/referrals' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendMessage": {
        "text": "ü§ù <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à—É —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É!</b>\n\n–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ <b>{{ config.billing.partner.income_percent }}% –æ—Ç –∫–∞–∂–¥–æ–≥–æ –∏—Ö –ø–ª–∞—Ç–µ–∂–∞</b>.\n\nüë• <b>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö –¥—Ä—É–∑–µ–π:</b> {{ user.referrals_count }}\nüí∞ <b>–í–∞—à –¥–æ—Ö–æ–¥ –æ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤:</b> {{ user.get_bonus }}\n\nüîó <b>–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</b>\n<code>{{ config.tg_bot.url }}?start={{ user.id }}</code>\n\n–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å—Å—ã–ª–∫–æ–π —Å –¥—Ä—É–∑—å—è–º–∏!",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π",
                        "switch_inline_query": "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ {{ config.company.name }} –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π —Å –Ω–∞–º–∏! üõ° {{ config.tg_bot.url }}?start={{ user.id }}"
                    }
                ],
                [
                    {
                        "text": "‚ùì –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?",
                        "callback_data": "/referral_help"
                    }
                ],
                [
                    {
                        "text": "üîô –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}


<% CASE '/referral_help' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendMessage": {
        "text": "üîç <b>–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞?</b>\n\n–í –Ω–∞—à–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å, –ø—Ä–∏–≥–ª–∞—à–∞—è –¥—Ä—É–∑–µ–π! –ö–∞–∂–¥—ã–π –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–π —á–µ–ª–æ–≤–µ–∫ –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –æ–Ω –º–æ–∂–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ –Ω–∞—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–∞—à–∏–º–∏ —É—Å–ª—É–≥–∞–º–∏.\n\nüí∏ <b>–ß—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ:</b>\n–í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ <b>{{ config.billing.partner.income_percent }}%</b> –æ—Ç –∫–∞–∂–¥–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–¥–µ–ª–∞–µ—Ç –≤–∞—à —Ä–µ—Ñ–µ—Ä–∞–ª. –≠—Ç–æ –æ—Ç–ª–∏—á–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥!\n\nüîó <b>–ö–∞–∫ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–≥–∞:</b>\n1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–≤–æ—é —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É.\n2. –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –µ—é —Å –¥—Ä—É–∑—å—è–º–∏, –∫–æ–ª–ª–µ–≥–∞–º–∏ –∏–ª–∏ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö.\n3. –ö–æ–≥–¥–∞ –≤–∞—à —Ä–µ—Ñ–µ—Ä–∞–ª —Å–¥–µ–ª–∞–µ—Ç –ø–µ—Ä–≤—ã–π –ø–ª–∞—Ç—ë–∂, –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —Å–≤–æ—é –¥–æ–ª—é!\n\nüí° <b>–°–æ–≤–µ—Ç—ã –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –¥–æ—Ö–æ–¥–∞:</b>\n1. –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ —Å—Å—ã–ª–∫—É –≤ —Å–æ—Ü—Å–µ—Ç—è—Ö –∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞—Ö.\n2. –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞—Ö –Ω–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –∏ –±–æ–Ω—É—Å–∞—Ö –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.\n\n–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã, –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –Ω–∞—à—É —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏.\n\nüîó –í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:\n<code>{{ config.tg_bot.url }}?start={{ user.id }}</code>",
        "parse_mode": "HTML",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üéØ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π",
                        "switch_inline_query": "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ {{ config.company.name }} –∏ –ø–æ–ª—É—á–∞–π –±–æ–Ω—É—Å—ã! üõ° {{ config.tg_bot.url }}?start={{ user.id }}"
                    }
                ],
                [
                    {
                        "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ",
                        "callback_data": "/referrals"
                    }
                ],
                [
                    {
                        "text": "üè† –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}

<% CASE ['/help', '‚ùì –ü–æ–º–æ—â—å'] %>
{{ IF cmd == '/help' OR cmd == '‚ùì –ü–æ–º–æ—â—å' }}
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{{ END }}
{
    "sendMessage": {
        "text": "üì° <b>–ü–æ–º–æ—â—å –∏ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</b>\n\n–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π –≤–∞—Å –ø—É–Ω–∫—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–∏–∂–µ:",
        "parse_mode": "HTML",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üñ• –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ VPN",
                        "callback_data": "/xray"
                    }
                ],
                [
                    {
                        "text": "üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –≤ —á–∞—Ç",
                        "url": "{{ config.chat.url }}"
                    }
                ],
                [
                    {
                        "text": "üåç –ì–ª–∞–≤–Ω–æ–µ –ú–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}

<% CASE '/vpn_instruction' %>
{
    "sendPhoto": {
        "photo": "{{ config.logo.url }}",
        "protect_content": false,
        "parse_mode": "HTML",
        "caption": "<b>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é —á–µ—Ä–µ–∑ VLESS TCP</b>\n\nüöÄ –ß—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ VPN —á–µ—Ä–µ–∑ VLESS —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º TCP, —Å–ª–µ–¥—É–π—Ç–µ –ø–æ—à–∞–≥–æ–≤–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∏–∂–µ.\n\n<b>1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç:</b>\n\n- –î–ª—è Windows –∏ Linux: —Å–∫–∞—á–∞–π—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ [Xray](https://github.com/XTLS/Xray-core/releases)\n- –î–ª—è macOS: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ [V2RayU](https://github.com/yanue/V2rayU)\n- –î–ª—è Android: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ [V2RayNG](https://github.com/2dust/v2rayNG)\n- –î–ª—è iOS: —Å–∫–∞—á–∞–π—Ç–µ [Shadowrocket](https://apps.apple.com/us/app/shadowrocket/id932747118)\n\n<b>2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞:</b>\n\n–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –µ–≥–æ —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:\n\n<b>–¢–∏–ø –ø—Ä–æ—Ç–æ–∫–æ–ª–∞:</b> VLESS\n<b>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç:</b> TCP\n<b>–°–µ—Ä–≤–µ—Ä:</b> {{ vpn_server_address }}\n<b>–ü–æ—Ä—Ç:</b> {{ vpn_port }}\n<b>UUID:</b> {{ vpn_uuid }}\n<b>–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ:</b> aes-128-gcm\n<b>–¢–æ–∫–µ–Ω:</b> {{ vpn_token }}\n\n<b>3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:</b>\n\n- –í–∫–ª—é—á–∏—Ç–µ <i>TCP Fast Open</i>, –µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.\n- –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º TLS, –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –∫–ª–∏–µ–Ω—Ç–µ.\n- –î–ª—è –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TLS —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º.\n\n<b>4. –ó–∞–≤–µ—Ä—à–∞—é—â–∏–µ —à–∞–≥–∏:</b>\n\n- –ù–∞–∂–º–∏—Ç–µ <i>–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</i>, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å VPN-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ VLESS TCP.\n- –í —Å–ª—É—á–∞–µ –æ—à–∏–±–æ–∫, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤–≤–µ–¥–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Å–µ—Ä–≤–µ—Ä, –ø–æ—Ä—Ç, UUID –∏ —Ç. –¥.).\n\n<b>5. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</b>\n\n- –î–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å DNS-—Å–µ—Ä–≤–µ—Ä—ã –≤ –≤–∞—à–µ–º –∫–ª–∏–µ–Ω—Ç–µ.\n- –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.\n\n<b>6. –ü–æ–ª—É—á–∏—Ç–µ –ø–æ–º–æ—â—å:</b>\n\n- –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏–ª–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞—à–µ–π —Å–ª—É–∂–±–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏.\n\n<b>–ù–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –∏ –±—ã—Å—Ç—Ä—ã–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º!</b>",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üîô –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}




<% CASE ['/xray', 'üñ• –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ VPN'] %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{
    "sendPhoto": {
        "photo": "{{ config.logo.url }}",
        "protect_content": false,
        "parse_mode": "HTML",
        "caption": "üõ°Ô∏è <b>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ VPN</b>\n\nüì±\n1Ô∏è‚É£ –°–∫–æ–ø–∏—Ä—É–π—Ç–µ <b>URL –∞–¥—Ä–µ—Å –ø–æ–¥–ø–∏—Å–∫–∏</b> (—Ñ–æ—Ä–º–∞—Ç <i>https://</i>).\n2Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ \niPhone <a href=\"{{ config.apk.ios }}\">Streisand</a>\n Android<a href=\"{{ config.apk.android }}\">v2rayNG </a>\n Huawei <a href=\"{{ config.apk.huawei }}\">v2RayTun</a>\n3Ô∏è‚É£ –í—Å—Ç–∞–≤—å—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ(+ –î–æ–±–∞–≤–∏—Ç—å –∏–∑ –±—É—Ñ–µ—Ä–∞).\n4Ô∏è‚É£ –í—ã–±–∏—Ä–∞–π—Ç–µ –õ–æ–∫–∞—Ü–∏—é –∏ –ù–∞–∂–º–∏—Ç–µ <b>'–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è'</b> ‚Äî –≥–æ—Ç–æ–≤–æ!\n\nüí°–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ –≤ üñ• –ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏!",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üñ• –ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏",
                        "url": "{{ config.chat.url }}"
                    },
                    {
                        "text": "üîë –ú–æ–π VPN",
                        "callback_data": "/list"
                    }
                ],
                [
                    {
                        "text": "üìñ –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏",
                        "web_app": {
                            "url": "https://telegra.ph/Instrukciya-dlya-iPhoneiPad-11-27"
                        }
                    }
                ],
				
                [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}

<% CASE '/show_mz_keys' %>
{{ us = user.services.list_for_api('usi', args.0) }}
{{ subscription_url = storage.read('name','vpn_mrzb_' _ args.0 ).subscription_url }}
{
    "printQrCode": {
        "data": "{{ subscription_url }}",
        "parameters": {
            "parse_mode": "HTML",
            "caption": "<b>Subscription URL:</b>\n<code>{{ subscription_url }}</code>"
        }
    }
},
{{ vless_tcp = storage.read('name','vpn_mrzb_' _ args.0 ).links.grep('^vless:').first }}
{
    "printQrCode": {
        "data": "{{ vless_tcp }}",
        "parameters": {
            "parse_mode": "HTML",
            "caption": "<b>VLESS TCP:</b>\n<code>{{ vless_tcp }}</code>"
        }
    }
},
{
    "sendMessage": {
        "text": "‚úÖ <b>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞–ª—å–Ω–µ–π—à–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ:</b>",
        "parse_mode": "HTML",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üõ† –£—Å–ª—É–≥–∏",
                        "callback_data": "/services"
                    }
                ],
                [
                    {
                        "text": "üåç –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}

<% CASE ['/test_mz', 'üåê MZ Test'] %>
{
    "sendPhoto": {
        "photo": "https://appleinsider.ru/wp-content/uploads/2022/04/vpn_app_screenshot.jpg",
        "protect_content": true,
        "parse_mode": "HTML",
        "caption": "üåê MZ (Beta) - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",
        "reply_markup": {
            "inline_keyboard": [
                {{ FOR item IN ref(service.api_price_list('category', 'VPN-EUROPE-TEST')) }}
                [
                    {
                        "text": "üåê {{ item.name }} - {{ item.cost }} —Ä—É–±/–º–µ—Å.",
                        "callback_data": "/serviceorder {{ item.service_id }} 1"
                    }
                ],
                {{ END }}
                [
                    {
                        "text": "üöÄ –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö —É—Å–ª—É–≥",
                        "callback_data": "/test_services_mz"
                    }
                ],
                [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}

<% CASE '/test_services_mz' %>
{
    "sendMessage": {
        "text": "üìã <b>–¢–µ—Å—Ç–æ–≤—ã–µ —É—Å–ª—É–≥–∏ PROXY:</b>\n\nüåü **–ò—Å–ø—ã—Ç–∞–π—Ç–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ PROXY!** üåü\n\nPROXY –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤–∞–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞. –ü–æ–¥–∫–ª—é—á–∞–π—Ç–µ—Å—å –∫ —Ç–µ—Å—Ç–æ–≤—ã–º —É—Å–ª—É–≥–∞–º –∏ —É–±–µ–¥–∏—Ç–µ—Å—å –≤ –∏—Ö —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏!\n\n**–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —É—Å–ª—É–≥–∏:**\n\n",
        "reply_markup": {
            "inline_keyboard": [
                {{ FOR item IN ref(user.services.list_for_api('category', 'VPN-EUROPE-TEST')) }}
                {{ SWITCH item.status }}
                    {{ CASE 'ACTIVE' }}
                        {{ icon = '‚úÖ' }}
                        {{ status = '–†–∞–±–æ—Ç–∞–µ—Ç' }}
                    {{ CASE 'BLOCK' }}
                        {{ icon = '‚ùå' }}
                        {{ status = '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞' }}
                    {{ CASE 'NOT PAID' }}
                        {{ icon = 'üí∞' }}
                        {{ status = '–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã' }}
                    {{ CASE }}
                        {{ icon = '‚è≥' }}
                        {{ status = '–û–±—Ä–∞–±–æ—Ç–∫–∞' }}
                {{ END }}
                [
                    {
                        "text": "{{ item.name }} - {{ icon }} {{ status }}",
                        "callback_data": "/service_beta {{ item.user_service_id }}"
                    }
                ],
                {{ END }}

                {{ FOR item IN ref(user.services.list_for_api('category', 'vpn-lt-wg-beta')) }}
                {{ SWITCH item.status }}
                    {{ CASE 'ACTIVE' }}
                        {{ icon = '‚úÖ' }}
                        {{ status = '–†–∞–±–æ—Ç–∞–µ—Ç' }}
                    {{ CASE 'BLOCK' }}
                        {{ icon = '‚ùå' }}
                        {{ status = '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞' }}
                    {{ CASE 'NOT PAID' }}
                        {{ icon = 'üí∞' }}
                        {{ status = '–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã' }}
                    {{ CASE }}
                        {{ icon = '‚è≥' }}
                        {{ status = '–û–±—Ä–∞–±–æ—Ç–∫–∞' }}
                {{ END }}
                [
                    {
                        "text": "{{ item.name }} - {{ icon }} {{ status }}",
                        "callback_data": "/service_beta {{ item.user_service_id }}"
                    }
                ],
                {{ END }}

                [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/test_mz"
                    }
                ]
            ]
        }
    }
}


<% CASE '/service_beta' %>
{
    "deleteMessage": { "message_id": {{ message.message_id }} }
},
{{ item = us.id(args.0) }}
{{ us = user.services.list_for_api('usi', args.0) }}
{
    "sendPhoto": {
        {{ SWITCH us.status }}
          {{ CASE 'ACTIVE' }}
              {{ icon = '‚úÖ' }}
              {{ status = ' –†–∞–±–æ—Ç–∞–µ—Ç' }}
          {{ CASE 'BLOCK' }}
              {{ icon = '‚ùå' }}
              {{ status = ' –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞' }}
          {{ CASE 'NOT PAID' }}
              {{ icon = 'üí∞' }}
              {{ status = ' –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã' }}
          {{ CASE }}
              {{ icon = '‚è≥' }}
              {{ status = ' –û–±—Ä–∞–±–æ—Ç–∫–∞' }}
        {{ END }}
        "photo": "https://vpnbot.pro/images/DALL-E-2024-11-30-19-58.jpg",
        "caption": "üîî <b>–ü–æ–¥–ø–∏—Å–∫–∞:</b> <i>{{ item.name }} {{ item.user_service_id }}</i>\nüìÖ <b>–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞:</b> {{ USE date }}{{ date.format(item.created, '%d.%m.%Y–≥. %H:%M') }}\n‚è≥ <b>–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ:</b> {{ USE date }}{{ date.format(item.expire, '%d.%m.%Y–≥. %H:%M') }}",
        "parse_mode": "HTML",
        "reply_markup": {
            "inline_keyboard": [
                {{ IF us.status == 'ACTIVE' }}
                {{ subscription_url = storage.read('name', 'vpn_mrzb_' _ args.0).subscription_url }}
                {{ IF us.category.grep('^(VPN-EUROPE-TEST|VPN-RUSSIA-MONTH|RESET-BALANCE)').first }}
                {{ IF subscription_url.grep('^https:').first }}
                [
                    {
                        "text": "üîó –ü–æ–∫–∞–∑–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É",
                        "callback_data": "/show_mz_keys {{ args.0 }}"
                    }
                ],
                {{ ELSE }}
                [
                    {
                        "text": "‚ö†Ô∏è –û–®–ò–ë–ö–ê: –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ SSL –¥–ª—è Marzban",
                        "callback_data": "/menu"
                    }
                ],
                {{ END }}
                {{ ELSE }}
                [
                    {
                        "text": "üóù –°–∫–∞—á–∞—Ç—å –∫–ª—é—á",
                        "callback_data": "/download_qr {{ args.0 }}"
                    },
                    {
                        "text": "üëÅ –ü–æ–∫–∞–∑–∞—Ç—å QR –∫–æ–¥",
                        "callback_data": "/show_qr {{ args.0 }}"
                    }
                ],
                {{ END }}
                {{ END }}
                  {{ IF us.status == 'NOT PAID' || us.status == 'BLOCK' }}
                [
                    {
                        "text": "üí≥ –û–ø–ª–∞—Ç–∏—Ç—å —Å–µ–π—á–∞—Å",
                        "callback_data": "/balance {{ user.pays.forecast('blocked', 1).total }}"
                    }
                ],
                {{ END }}
                {{ IF us.status != 'PROGRESS' }}
                [
                    {
                        "text": "üóë –£–¥–∞–ª–∏—Ç—å —É—Å–ª—É–≥—É",
                        "callback_data": "/delete {{ args.0 }}"
                    }
                ],
                {{ END }}
                [
                    {
                        "text": "üîç –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ VPN",
                        "callback_data": "/xray"
                    }
                ],
                [
                    {
                        "text": "‚Ü©Ô∏è –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É —É—Å–ª—É–≥",
                        "callback_data": "/list"
                    }
                ]
            ]
        }
    }
}
<% CASE '/adminmenu' %>
{{ IF message.chat.id == config.telegram_admin.id OR message.chat.id == config.telegram_admin2.id OR message.chat.id == config.telegram_admin3.id }}
{
    "sendMessage": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "üì° <b>–ê–¥–º–∏–Ω–∫–∞</b>\n\n–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—É—é –∫–æ–º–∞–Ω–¥—É –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:\n\n1Ô∏è‚É£ <b>–£—Å–ª—É–≥–∏</b>\n2Ô∏è‚É£ <b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ª—É–≥</b>\n3Ô∏è‚É£ <b>–ü—Ä–æ–º–æ–∫–æ–¥—ã</b>\n4Ô∏è‚É£ <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</b>\n5Ô∏è‚É£ <b>–û—Ç—á–µ—Ç –∑–∞ –º–µ—Å—è—Ü</b>",
        "reply_markup": {
            "inline_keyboard": [
                [
                    { "text": "üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏", "callback_data": "/admusers" },
                    { "text": "üìÖ –û—Ç—á–µ—Ç –∑–∞ –º–µ—Å—è—Ü", "callback_data": "/monthlyreport" },
                    { "text": "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ª—É–≥", "callback_data": "/admservicestats" }
                ],
                [
                    { "text": "üéÅ –ü—Ä–æ–º–æ–∫–æ–¥—ã", "callback_data": "/adminpromocodes" },
                    { "text": "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏", "callback_data": "/adminsettings" }
                ],
                [
                    { "text": "üìÖ –û—Ç—á–µ—Ç –∑–∞ –º–µ—Å—è—Ü", "callback_data": "/monthlyreport" },
                    { "text": "üîô –ù–∞–∑–∞–¥", "callback_data": "/menu" }
                ]
            ]
        }
    }
}
{{ END }}

<% CASE '/adminsettings' %>
{{ IF message.chat.id == config.telegram_admin.id OR message.chat.id == config.telegram_admin2.id OR message.chat.id == config.telegram_admin3.id }}
{
    "sendMessage": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "‚öôÔ∏è <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</b>\n\n–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é –Ω–∏–∂–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:",
        "reply_markup": {
            "inline_keyboard": [
                [
                    { "text": "üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é", "callback_data": "/updateconfig" },
                    { "text": "üõ† –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏", "callback_data": "/manageparams" }
                ],
                [
                    { "text": "üîî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏", "callback_data": "/managenotifications" },
                    { "text": "üåê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API –∫–ª—é—á–∞–º–∏", "callback_data": "/manageapikeys" }
                ],
                [
                    { "text": "üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º", "callback_data": "/managestorage" }
                ],
                [
                    { "text": "üîô –í –∞–¥–º–∏–Ω–∫—É", "callback_data": "/adminmenu" },
                    { "text": "üè† –î–æ–º–æ–π", "callback_data": "/menu" }
                ]
            ]
        }
    }
}
{{ ELSE }}
{
    "sendMessage": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "‚ö†Ô∏è –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ."
    }
}
{{ END }}

<% CASE '/manageparams' %>
{{ IF message.chat.id == config.telegram_admin.id OR message.chat.id == config.telegram_admin2.id OR message.chat.id == config.telegram_admin3.id }}
{
    "sendMessage": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "‚öôÔ∏è <b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏</b>\n\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:",
        "reply_markup": {
            "inline_keyboard": [
                [
                    { "text": "üìù –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤", "callback_data": "/viewparams" },
                    { "text": "‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã", "callback_data": "/editparams" }
                ],
                [
                    { "text": "‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä", "callback_data": "/addparam" },
                    { "text": "‚ùå –£–¥–∞–ª–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä", "callback_data": "/deleteparam" }
                ],
                [
                    { "text": "üîô –ù–∞–∑–∞–¥", "callback_data": "/adminmenu" },
                    { "text": "üè† –î–æ–º–æ–π", "callback_data": "/menu" }
                ]
            ]
        }
    }
}
{{ ELSE }}
{
    "sendMessage": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "‚ö†Ô∏è –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ."
    }
}
{{ END }}

<% CASE '/updateconfig' %>
{{ IF message.chat.id == config.telegram_admin.id OR message.chat.id == config.telegram_admin2.id OR message.chat.id == config.telegram_admin3.id }}
{{ exec("sudo bash -c 'cd /opt/shm && docker compose pull && docker compose down && docker compose up -d'") }}
{
    "sendMessage": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "üîÑ <b>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞—á–∞–ª–æ—Å—å...</b>\n\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç.",
        "reply_markup": {
            "inline_keyboard": [
                [
                    { "text": "üîô –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∏", "callback_data": "/adminsettings" },
                    { "text": "üè† –î–æ–º–æ–π", "callback_data": "/menu" }
                ]
            ]
        }
    }
},
{{ sleep(35) }}
{
    "sendMessage": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "‚úÖ <b>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!</b>\n\nDocker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω—ã.",
        "reply_markup": {
            "inline_keyboard": [
                [
                    { "text": "üîô –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∏", "callback_data": "/adminsettings" },
                    { "text": "üè† –î–æ–º–æ–π", "callback_data": "/menu" }
                ]
            ]
        }
    }
}
{{ ELSE }}
{
    "sendMessage": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "‚ö†Ô∏è –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ."
    }
}
{{ END }}

<% CASE '/dockerlogs' %>
{{ IF message.chat.id == config.telegram_admin.id OR message.chat.id == config.telegram_admin2.id OR message.chat.id == config.telegram_admin3.id }}
{{ exec("cd /opt/shm && docker compose logs -f > /tmp/docker_logs_output.log 2>&1 &") }}
{
    "sendMessage": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "üîç <b>–õ–æ–≥–∏ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∑–∞–ø—É—â–µ–Ω—ã –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ</b>\n\n–§–∞–π–ª –ª–æ–≥–æ–≤: <code>/tmp/docker_logs_output.log</code>.",
        "reply_markup": {
            "inline_keyboard": [
                [
                    { "text": "üîô –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∏", "callback_data": "/adminsettings" },
                    { "text": "üè† –î–æ–º–æ–π", "callback_data": "/menu" }
                ]
            ]
        }
    }
}
{{ ELSE }}
{
    "sendMessage": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "‚ö†Ô∏è –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ."
    }
}
{{ END }}


<% CASE '/adminpromocodes' %>
{{ IF message.chat.id == config.telegram_admin.id OR message.chat.id == config.telegram_admin2.id OR message.chat.id == config.telegram_admin3.id }}
{{  
  limit = 10; 
  data = []; 
}} 

{{  
  offset = (args.0 || 0); 
  arr = ref(user.promocodes.list_for_api('admin', 1, 'limit', limit, 'offset', offset)) 
}} 

{{ IF arr.size > 0 }}
{
  "sendMessage": {
    "message_id": {{ message.message_id }},
    "parse_mode": "HTML",
    "text": "üí≥ <b>–ü—Ä–æ–º–æ–∫–æ–¥—ã</b>\n\n–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤: <b>{{ arr.size }}</b>\n\n",
    "reply_markup": {
      "inline_keyboard": [
        {{ FOR item IN arr }}
        {{  
          promocode = item.promocode || "N/A";
          status = item.status == "ACTIVE" ? "üü¢ –ê–∫—Ç–∏–≤–µ–Ω" : "üî¥ –ù–µ–∞–∫—Ç–∏–≤–µ–Ω";
        }}
        [
          { 
            "text" = "<b>–ü—Ä–æ–º–æ–∫–æ–¥:</b> " _ promocode _ "\n<b>–°—Ç–∞—Ç—É—Å:</b> " _ status,
            "callback_data" = "/viewpromocode " _ item.id
          },
          { 
            "text" = "‚ùå <b>–£–¥–∞–ª–∏—Ç—å</b>", 
            "callback_data" = "/deletepromocode " _ item.id 
          },
          { 
            "text" = "‚úèÔ∏è <b>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</b>", 
            "callback_data" = "/editpromocode " _ item.id 
          }
        ]
        {{ END }},
        [
          { 
            "text" = "–î–∞–ª–µ–µ ‚ñ∂Ô∏è", 
            "callback_data" = "/adminpromocodes " _ (offset + limit) 
          }
        ],
        [
          { 
            "text" = "‚óÄÔ∏è –ù–∞–∑–∞–¥", 
            "callback_data" = "/adminpromocodes " _ (offset - limit) 
          }
        ],
        [
          { 
            "text" = "–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–º–æ–∫–æ–¥ ‚ûï", 
            "callback_data" = "/addpromocode" 
          },
          { 
            "text" = "üè† –î–æ–º–æ–π", 
            "callback_data" = "/menu" 
          }
        ]
      ]
    }
  }
}
{{ ELSE }}
{
  "sendMessage": {
    "message_id": {{ message.message_id }},
    "parse_mode": "HTML",
    "text": "‚ö†üí≥ <b>–ü—Ä–æ–º–æ–∫–æ–¥—ã</b>\n\n–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤: <b>{{ FOR code IN codes }}{{ code }}{{ END }}</b>\n\n"
  }
}
{{ END }}
{{ END }}

<% CASE '/monthlyreport' %>
{{ IF message.chat.id == config.telegram_admin.id OR message.chat.id == config.telegram_admin2.id OR message.chat.id == config.telegram_admin3.id }}
{{ sum = 0 }}
{{ page = 1 }}
{{ items_per_page = 10 }}
{{ month = '12' }}
{{ year = '2024' }}

{{ arr = ref(user.pays.list_for_api('admin', 1, 'limit', items_per_page, 'offset', (page - 1) * items_per_page, 'filter', { 'date' => '2024-%-%' })) }}
{{ FOR item IN arr }}
{{ sum = sum + item.money }}
{{ END }}

{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "üí∞ –î–æ—Ö–æ–¥:\nüíµ –ò—Ç–æ–≥–æ –∑–∞ {{ month }}/{{ year }}: {{ sum }} —Ä—É–±. üè¶",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üõ† –ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/adminmenu"
                    }
                ],
                [
                    {
                        "text": "üè† –î–æ–º–æ–π",
                        "callback_data": "/menu"
                    }
                ],
                [
                    {
                        "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
                        "callback_data": "/monthlyreport?page={{ page - 1 }}"
                    },
                    {
                        "text": "‚û°Ô∏è –î–∞–ª–µ–µ",
                        "callback_data": "/monthlyreport?page={{ page + 1 }}"
                    }
                ]
            ]
        }
    }
}
{{ END }}


<% CASE '/admservicestats' %>
{{ IF message.chat.id == config.telegram_admin.id OR message.chat.id == config.telegram_admin2.id OR message.chat.id == config.telegram_admin3.id }}

{{ active_services = ref(user.services.list_for_api('admin', 1, 'limit', 0, 'filter', { 'status' => 'ACTIVE' })) }}
{{ blocked_services = ref(user.services.list_for_api('admin', 1, 'limit', 0, 'filter', { 'status' => 'BLOCK' })) }}
{{ unpaid_services = ref(user.services.list_for_api('admin', 1, 'limit', 0, 'filter', { 'status' => 'NOT PAID' })) }}

{
    "sendMessage": {
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML",
        "text": "üìä <b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ª—É–≥</b>\n\nüíº <b>–ê–∫—Ç–∏–≤–Ω—ã–µ —É—Å–ª—É–≥–∏:</b> <b>{{ active_services.size }}</b>\nüö´ <b>–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏:</b> <b>{{ blocked_services.size }}</b>\nüí≥ <b>–ù–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏:</b> <b>{{ unpaid_services.size }}</b>\n\nüìù <b>–î–µ—Ç–∞–ª–∏:</b>\n–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ª—É–≥: <b>{{ active_services.size + blocked_services.size + unpaid_services.size }}</b>\n–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ —É—Å–ª—É–≥–∏: <b>{{ (active_services.sum('withdraws.cost') / active_services.size) * 100 / 100 }}</b> —Ä—É–±.\n–°—Ä–µ–¥–Ω—è—è —Å–∫–∏–¥–∫–∞: <b>{{ (active_services.sum('withdraws.discount') / active_services.size) * 100 / 100 }}%</b>\n\nüïë <b>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</b> {{ current_time }}",
        "reply_markup": {
            "inline_keyboard": [
                [
                    {
                        "text": "üöÄ –ê–∫—Ç–∏–≤–Ω—ã–µ —É—Å–ª—É–≥–∏",
                        "callback_data": "/admservices_active"
                    },
                    {
                        "text": "‚õî –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏",
                        "callback_data": "/admservices_stop"
                    },
                    {
                        "text": "üí≥ –ù–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏",
                        "callback_data": "/admservices_notpaid"
                    }
                ],
                [
                    {
                        "text": "üöÄ –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —É—Å–ª—É–≥–∞–º",
                        "callback_data": "/admservices"
                    }
                ],
                [
                    {
                        "text": "üìã –í—Å–µ —É—Å–ª—É–≥–∏",
                        "callback_data": "/admallservices"
                    }
                ],
                [
                    {
                        "text": "üîô –ù–∞–∑–∞–¥",
                        "callback_data": "/adminmenu"
                    },
                    {
                        "text": "üè† –î–æ–º–æ–π",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}

<% CASE '/admservices_active' %>
{{ usisbl = user.services.list_for_api('usi', {}) }}
{{ IF message.chat.id == config.telegram_admin.id OR message.chat.id == config.telegram_admin2.id OR message.chat.id == config.telegram_admin3.id }}
{{  
  limit = 10; 
  data = []; 
}} 

{{  
  offset = (args.0 || 0); 
  arr = ref(user.services.list_for_api('admin', 1, 'limit', limit, 'offset', offset, 'filter', { 'status' = 'ACTIVE' })) 
}} 

{{ FOR item IN arr }} 
{{  
  status = (item.status == "ACTIVE" ? "üü¢" : "üî¥") 
}}
{{  
  # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —É —É—Å–ª—É–≥–∏
  service_id = (item.id || item.user_service_id || "N/A")
}} 
{{  
  # Add service details to the button text 
  data.push( 
    [{ 
      "text" = status _ " –£—Å–ª—É–≥–∞: " _ item.name _  " ID: " _ service_id _ "", 
      "callback_data" = "/admallservices " _ item.id 
    }],
    [{ 
      "text" = "–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å ‚ùå", 
      "callback_data" = "/admuserblock " _ item.id 
    }],
    [{ 
      "text" = "–£–¥–∞–ª–∏—Ç—å üóëÔ∏è", 
      "callback_data" = "/admdelete " _ item.id 
    }]
  ) 
}} 
{{ END }} 

{{ IF arr.size == limit }}
{{  
  data.push( 
    [{ 
      "text" = "–î–∞–ª–µ–µ ‚ñ∂Ô∏è", 
      "callback_data" = "/admaddservice_block " _ (offset + limit) 
    }] 
  )
}} 
{{ END }}

{{ IF offset > 0 }}
{{  
  data.push( 
    [{ 
      "text" = "‚óÄÔ∏è –ù–∞–∑–∞–¥", 
      "callback_data" = "/admaddservice_block " _ (offset - limit) 
    }] 
  ) 
}}
{{ END }}

{{ data.push( 
    [{ 
      "text" = "–í–µ—Å—å —Å–ø–∏—Å–æ–∫", 
      "callback_data" = "/admservices_active 0" 
    }], 
    [{ 
      "text" = "–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏ üî¥", 
      "callback_data" = "/admaddservice_block" 
    }],
    [{ 
      "text" = "–£—Å–ª—É–≥–∏ –±–µ–∑ –æ–ø–ª–∞—Ç—ã üí≥", 
      "callback_data" = "/admaddservice_notpaid" 
    }],
    [{ 
      "text" = "–ê–¥–º–∏–Ω–∫–∞", 
      "callback_data" = "/adminmenu" 
    }, { 
      "text" = "üè† –î–æ–º–æ–π", 
      "callback_data" = "/menu" 
    }] 
  ) 
}} 

{{ IF cmd == "/qadmservices" }} 
{ 
    "sendMessage": {  
{{ ELSIF cmd == "/admservices_active" }} 
{ 
    "editMessageText": { 
    {{ END }}
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML", 
        "text": "üíº <b>–£—Å–ª—É–≥–∏</b>\n\n–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ª—É–≥: <b>{{ arr.size }}</b>\n\n", 
        "reply_markup": { 
          "inline_keyboard": {{ toJson(data) }} 
        } 
    } 
}
{{ END }}

<% CASE '/block_service' %>
{{ IF message.chat.id == config.telegram_admin.id OR message.chat.id == config.telegram_admin2.id OR message.chat.id == config.telegram_admin3.id }}
{{  
  service_id = args.0; 
  # Code to block the service
  result = ref(user.services.update_service_status(service_id, "BLOCK"))
}} 

{{ IF result.success }}
  { 
    "sendMessage": {  
      "chat_id": {{ message.chat.id }},
      "text": "üî¥ –£—Å–ª—É–≥–∞ –±—ã–ª–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞."
    } 
  }
{{ ELSE }}
  { 
    "sendMessage": {  
      "chat_id": {{ message.chat.id }},
      "text": "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ —É—Å–ª—É–≥–∏."
    } 
  }
{{ END }}
{{ END }}

<% CASE '/delete_service' %>
{{ IF message.chat.id == config.telegram_admin.id OR message.chat.id == config.telegram_admin2.id OR message.chat.id == config.telegram_admin3.id }}
{{  
  service_id = args.0; 
  # Code to delete the service
  result = ref(user.services.delete_service(service_id))
}} 

{{ IF result.success }}
  { 
    "sendMessage": {  
      "chat_id": {{ message.chat.id }},
      "text": "üóëÔ∏è –£—Å–ª—É–≥–∞ –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞."
    } 
  }
{{ ELSE }}
  { 
    "sendMessage": {  
      "chat_id": {{ message.chat.id }},
      "text": "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É—Å–ª—É–≥–∏."
    } 
  }
{{ END }}
{{ END }}

<% CASE '/activate_service' %>
{{ IF message.chat.id == config.telegram_admin.id OR message.chat.id == config.telegram_admin2.id OR message.chat.id == config.telegram_admin3.id }}
{{  
  service_id = args.0; 
  # Code to activate the service
  result = ref(user.services.update_service_status(service_id, "ACTIVE"))
}} 

{{ IF result.success }}
  { 
    "sendMessage": {  
      "chat_id": {{ message.chat.id }},
      "text": "üü¢ –£—Å–ª—É–≥–∞ –±—ã–ª–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞."
    } 
  }
{{ ELSE }}
  { 
    "sendMessage": {  
      "chat_id": {{ message.chat.id }},
      "text": "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —É—Å–ª—É–≥–∏."
    } 
  }
{{ END }}
{{ END }}


<% CASE '/admaddservice_block' %> 

{{ usisbl = user.services.list_for_api('usi', {}) }}
{{ IF message.chat.id == config.telegram_admin.id OR message.chat.id == config.telegram_admin2.id OR message.chat.id == config.telegram_admin3.id }}
{{  
  limit = 10; 
  data = []; 
}} 

{{  
  offset = (args.0 || 0); 
  arr = ref(user.services.list_for_api('admin', 1, 'limit', limit, 'offset', offset, 'filter', { 'status' = 'BLOCK' })) 
}} 

{{ FOR item IN arr }} 
{{  
  status = (item.status == "ACTIVE" ? "üü¢" : "üî¥") 
}}
{{  
  # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —É —É—Å–ª—É–≥–∏
  service_id = (item.id || item.user_service_id || "N/A")
}} 
{{  
  # Add service details to the button text 
  data.push( 
    [{ 
      "text" = status _ " –£—Å–ª—É–≥–∞: " _ item.name _  " ID: " _ service_id _ "", 
      "callback_data" = "/admallservices " _ item.id 
    }],
	[{ 
      "text" = "–£–¥–∞–ª–∏—Ç—å üóëÔ∏è", 
      "callback_data" = "/delete_service " _ item.id 
    }],
    [{ 
      "text" = "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å üü¢", 
      "callback_data" = "/activate_service " _ item.id 
    }]
  ) 
}} 
{{ END }} 

{{ IF arr.size == limit }}
{{  
  data.push( 
    [{ 
      "text" = "–î–∞–ª–µ–µ ‚ñ∂Ô∏è", 
      "callback_data" = "/admaddservice_block " _ (offset + limit) 
    }] 
  )
}} 
{{ END }}

{{ IF offset > 0 }}
{{  
  data.push( 
    [{ 
      "text" = "‚óÄÔ∏è –ù–∞–∑–∞–¥", 
      "callback_data" = "/admaddservice_block " _ (offset - limit) 
    }] 
  ) 
}}
{{ END }}

{{ data.push( 
    [{ 
      "text" = "–í–µ—Å—å —Å–ø–∏—Å–æ–∫", 
      "callback_data" = "/admservicesall" 
    }],
    [{ 
      "text" = "–£—Å–ª—É–≥–∏ –±–µ–∑ –æ–ø–ª–∞—Ç—ã üí≥", 
      "callback_data" = "/admaddservice_notpaid" 
    }],
    [{ 
      "text" = "–ê–∫—Ç–∏–≤–Ω—ã–µ —É—Å–ª—É–≥–∏ üü¢", 
      "callback_data" = "/admaddservice_active" 
    }],
    [{ 
      "text" = "–ê–¥–º–∏–Ω–∫–∞", 
      "callback_data" = "/adminmenu" 
    }, { 
      "text" = "üè† –î–æ–º–æ–π", 
      "callback_data" = "/menu" 
    }] 
  ) 
}} 

{{ IF cmd == "/qadmservices" }} 
{ 
    "sendMessage": {  
{{ ELSIF cmd == "/admaddservice_block" }} 
{ 
    "editMessageText": { 
    {{ END }}
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML", 
        "text": "üíº <b>–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏</b>\n\n–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—Å–ª—É–≥: <b>{{ arr.size }}</b>\n\n", 
        "reply_markup": { 
          "inline_keyboard": {{ toJson(data) }} 
        } 
    } 
}
{{ END }}

<% CASE '/admaddservice_notpaid' %>
{{ usisact = user.services.list_for_api('usi', {}) }}
{{ IF message.chat.id == config.telegram_admin.id OR message.chat.id == config.telegram_admin2.id OR message.chat.id == config.telegram_admin3.id }}
{{  
  limit = 10; 
  data = []; 
}} 

{{  
  offset = (args.0 || 0); 
  arr = ref(user.services.list_for_api('admin', 1, 'limit', limit, 'offset', offset, 'filter', { 'status' = 'NOT_PAID' })) 
}} 

{{ FOR item IN arr }} 
{{  
  status = (item.status == "ACTIVE" ? "üü¢" : "üî¥") 
}}
{{  
  # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —É —É—Å–ª—É–≥–∏
  service_id = (item.id || item.user_service_id || "N/A")
}} 
{{  
  # Add service details to the button text 
  data.push( 
    [{ 
      "text" = status _ " –£—Å–ª—É–≥–∞: " _ item.name _  " ID: " _ service_id _ "", 
      "callback_data" = "/admallservices " _ item.id 
    }],
	[{ 
      "text" = "–£–¥–∞–ª–∏—Ç—å üóëÔ∏è", 
      "callback_data" = "/delete_service " _ item.id 
    }],
    [{ 
      "text" = "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å üü¢", 
      "callback_data" = "/activate_service " _ item.id 
    }]
  ) 
}} 
{{ END }} 


{{ IF arr.size == limit }}
{{  
  data.push( 
    [{ 
      "text" = "–î–∞–ª–µ–µ ‚ñ∂Ô∏è", 
      "callback_data" = "/admaddservice_notpaid " _ (offset + limit) 
    }] 
  )
}} 
{{ END }}

{{ IF offset > 0 }}
{{  
  data.push( 
    [{ 
      "text" = "‚óÄÔ∏è –ù–∞–∑–∞–¥", 
      "callback_data" = "/admaddservice_notpaid " _ (offset - limit) 
    }] 
  ) 
}}
{{ END }}

{{ data.push( 
    [{ 
      "text" = "–í–µ—Å—å —Å–ø–∏—Å–æ–∫", 
      "callback_data" = "/admaddservice_notpaid " _ (offset - limit)
    }],
    [{ 
      "text" = "–ê–∫—Ç–∏–≤–Ω—ã–µ —É—Å–ª—É–≥–∏ üü¢", 
      "callback_data" = "/admaddservice_active" 
    }],
	[{ 
      "text" = "–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏ üî¥", 
      "callback_data" = "/admaddservice_block" 
    }],
    [{ 
      "text" = "–ê–¥–º–∏–Ω–∫–∞", 
      "callback_data" = "/adminmenu" 
    }, { 
      "text" = "üè† –î–æ–º–æ–π", 
      "callback_data" = "/menu" 
    }] 
  ) 
}} 

{{ IF cmd == "/qadmservices" }} 
{ 
    "sendMessage": {  
{{ ELSIF cmd == "/admaddservice_notpaid" }} 
{ 
    "editMessageText": { 
    {{ END }}
        "message_id": {{ message.message_id }},
        "parse_mode": "HTML", 
        "text": "üíº <b>–£—Å–ª—É–≥–∏ –±–µ–∑ –æ–ø–ª–∞—Ç—ã</b>\n\n–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö —É—Å–ª—É–≥: <b>{{ arr.size }}</b>\n\n", 
        "reply_markup": { 
          "inline_keyboard": {{ toJson(data) }} 
        } 
    } 
}
{{ END }}
<% CASE ['/admusers', '/qadmusers'] %>
{{ IF message.chat.id == config.telegram_admin.id }}
{{
  limit = 10
  data = []
}}
{{
  offset = args.0 || 0
  itemsa = ref( user.list_for_api('admin',1,'limit',limit, 'offset',offset,'sort_direction'asc,'filter',{"gid" = 0}) )
}}
{{ FOR itema IN itemsa }}
{{ status = (itema.block == 0 ? "üü¢" : "üî¥") }}
{{ data.push(
    [{
      "text" = status _ itema.user_id _ '.' _ itema.full_name _ '-' _ itema.login
      "callback_data" = '/admuser ' _ itema.user_id
    }]
  )
}}
{{ END }}
{{ IF itemsa.size == limit }}
{{ data.push(
    [{
      "text" = '–î–∞–ª–µ–µ ‚ñ∂Ô∏è',
      "callback_data" = '/admusers ' _ (limit + offset)
    }]
  )
}}
{{ END }}
{{ IF offset > 0 }}
{{ data.push(
    [{
      "text" = '‚óÄÔ∏è –ù–∞–∑–∞–¥',
      "callback_data" = '/admusers ' _ (offset - limit)
    }]
  )
}}
{{ END }}
{{ data.push(
 [{
      "text" = '–í–µ—Å—å —Å–ø–∏—Å–æ–∫',
      "callback_data" = '/admusersall'
    }], [{
      "text" = '–ê–¥–º–∏–Ω–∫–∞'
      "callback_data" = '/adminmenu'
    },{
      "text" = 'üè† –î–æ–º–æ–π'
      "callback_data" = '/menu'
    }]
  )
}}
{{ IF cmd == '/qadmusers' }}
{
    "sendMessage": {
{{ END }}
{{ IF cmd == '/admusers' }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode":"HTML",
{{ END }}
    "text": "–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",
    "reply_markup" : {
      "inline_keyboard": {{ toJson( data ) }}
    }
  }
}
{{ END }}
<% CASE '/admusersall' %>
{{ IF message.chat.id == config.telegram_admin.id }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode":"HTML",
        "text": "–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",
        "reply_markup" : {
            "inline_keyboard": [
                {{ FOR itema IN ref(user.list_for_api( 'admin', 1, 'limit', 999).nsort('user_id')) }}
                  {{ IF itema.gid == 0 }}
                [
                    {
                        "text": "{{ IF itema.block == 0}}üü¢{{ ELSE }}üî¥{{ END }}{{ itema.user_id }}.{{ itema.full_name }}  - {{ itema.login }} ",
                        "callback_data": "/admuser {{ itema.user_id }} "
                    }
                ],    {{ END }}  
{{ END }}           
                  [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/admusers"
                    }
                ],[
                    {
                        "text": "–ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/adminmenu"
                    }, {
                        "text": "üè† –î–æ–º–æ–π",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}
<% CASE ['/admuser', '/qadmuser'] %>
{{ IF message.chat.id == config.telegram_admin.id }}
{{ user = user.switch(args.0) }}
{{ user_services = ref(user.services.list_for_api('category','%')) }}
{{ FOR itemlk IN ref(user.id(args.0)) }}
{{ IF cmd == '/qadmuser' }}
{
    "sendMessage": {
{{ END }}
{{ IF cmd == '/admuser' }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode":"HTML",
{{ END }}
        "text": "{{ itemlk.full_name }}\n{{ itemlk.login }}\n–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: {{ itemlk.created }}\n–£—Å–ª—É–≥: {{ user_services.size }}\n–ë–∞–ª–∞–Ω—Å: {{ itemlk.balance }}‚ÇΩ\n–°–∫–∏–¥–∫–∞: {{ itemlk.discount }}%\n–ë–æ–Ω—É—Å—ã: {{ itemlk.get_bonus }}{{ IF user.block == 1 }}\nüî¥ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω{{ END }}",
        "reply_markup" : {
            "inline_keyboard": [
                         {{ IF user.block == 0 }}
                         {{ IF user_services.size > 0 }}
                       [
                    {
                        "text": "–£—Å–ª—É–≥–∏",
                        "callback_data": "/admservice {{ itemlk.id }}"
                    }
                ],{{ ELSE }} 
                 [
                    {
                        "text": "–î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É",
                        "callback_data": "/admpricelist {{ itemlk.id }}"
                    }
                ],
                  {{ END }} [
                    {
                        "text": "–ü–ª–∞—Ç–µ–∂–∏",
                        "callback_data": "/admpay {{ itemlk.id }}"
                    }
                ],[
                    {
                        "text": "–ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π",
                        "callback_data": "/admpayhistory {{ itemlk.id }}"
                    }
                ],
                 [
                    {
                        "text": "–ë–æ–Ω—É—Å—ã",
                        "callback_data": "/admpayb {{ itemlk.id }}"
                    }
                ], [
                    {
                        "text": "–ù–∞–ø–∏—Å–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é",
                        "callback_data": "/admusermsg {{ user.settings.telegram.chat_id }}"
                    }
                ],{{ END }}
                  {{ IF user.block == 0 }}
                     [
                    {
                        "text": "–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å",
                        "callback_data": "/admuserblock {{ itemlk.id }}"
                    }
                ], {{ ELSE }}[
                    {
                        "text": "–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å",
                        "callback_data": "/admuseractiv {{ itemlk.id }}"
                    }
                ],
               {{ END }}
                 [
                   {
                        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
                        "callback_data": "/admusers"
                    }, {
                        "text": "–ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/adminmenu"
                    }
                ],
                 [
                    {
                        "text": "üè† –î–æ–º–æ–π",
                        "callback_data": "/menu"
                    }
                ]
            ]{{ END }}    
        }
    }
}
{{ END }}
<% CASE '/admusermsg' %>
{
"sendMessage": {
        "text": "#{{ args.0 }}#\n–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
        "reply_markup": {
            "force_reply": true
        }
    }
}
<% CASE '/admservice' %>
{{ IF message.chat.id == config.telegram_admin.id }}
{{ FOR itemlks IN ref(user.id(args.0)) }}
{{ user = user.switch(args.0) }}
{{ usis = user.services.list_for_api( 'usi', args.1 ) }}
{{ USE date }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode":"HTML",
        "text": "–£—Å–ª—É–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n{{ itemlks.full_name }}\n{{ itemlks.login }}\n–£—Å–ª—É–≥–∞: {{ usis.name }}\n–°—Ç–∞—Ç—É—Å: {{ usis.status }}\n–°–æ–∑–¥–∞–Ω: {{ usis.created }}\n–û–ø–¥–∞—á–µ–Ω –¥–æ: {{ usis.expire }}{{ IF usis.next }} {{ FOR itemis IN ref(service.api_price_list)}}{{ IF itemis.service_id == usis.next }}\n\n<b>–°–º–µ–Ω–∞ —Ç–∞—Ä–∏—Ñ–∞:</b>{{ itemis.name }} \n–ü—Ä–æ–∏–∑–æ–π–¥—ë—Ç: {{ date.format(usis.expire, '%H:%M %d.%m.%Y') }}  (–ú–°–ö) {{ END }} {{ END }}{{ ELSE }}  {{ END }}",
        "reply_markup" : {
            "inline_keyboard": [
               {{ IF usis.status == 'ACTIVE' }}     
                 [
                    {
                        "text": "–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —É—Å–ª—É–≥—É",
                        "callback_data": "/admusiblock {{ user.id }}"
                    }
                ],  {{ ELSE }}         
              [
                    {
                        "text": "–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —É—Å–ª—É–≥—É",
                        "callback_data": "/admusiactive {{ user.id }}"
                    }
                ],    {{ END }}   
{{ IF usis.next }}
{{ FOR itemis IN ref(service.api_price_list)}}
{{ IF itemis.service_id == usis.next }}
                 [
                    {
                        "text": "–û—Ç–º–µ–Ω–∏—Ç—å —Å–º–µ–Ω—É —Ç–∞—Ä–∏—Ñ–∞",
                        "callback_data": "/admchoisenull {{ user.id }}"
                    }
                ],
{{ END }} {{ END }}
{{ ELSE }} 
                   [
                    {
                        "text": "–ò–∑–º–µ–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ",
                        "callback_data": "/admsmena {{ user.id }}"
                    }
                ],
{{ END }}
                [
                    {
                        "text": "‚ùå –£–¥–∞–ª–∏—Ç—å —É—Å–ª—É–≥—É",
                        "callback_data": "/admdelete {{ user.id }}"
                    }
                ], [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/admuser {{ user.id }}"
                    }
                ], [
                    {
                        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
                        "callback_data": "/admusers"
                    },{
                        "text": "–ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/adminmenu"
                    }
                ],
                 [
                    {
                        "text": "üè† –î–æ–º–æ–π",
                        "callback_data": "/menu"
                    }
                ]
            ]{{ END }}    
        }
    }
}
{{ END }}
<% CASE '/admpricelist' %>
{{ IF message.chat.id == config.telegram_admin.id }}
{{ user = user.switch(args.0) }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode":"HTML",
        "text": "‚ò∑ –í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É –¥–ª—è\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {{ user.full_name }}",
        "reply_markup" : {
            "inline_keyboard": [
                {{ FOR itemprl IN ref(service.api_price_list).nsort('cost') }}
                [
                    {
                        "text": "{{ itemprl.name }}.",
                        "callback_data": "/admserviceorder {{ user.id }} 0 {{ itemprl.service_id }}"
                    }
                ],
                {{ END }}
                [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/admuser {{ user.id }}"
                    }
                ], [
                   {
                        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
                        "callback_data": "/admusers"
                    }, {
                        "text": "–ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/adminmenu"
                    }
                ],
                 [
                    {
                        "text": "üè† –î–æ–º–æ–π",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}{{ END }}
<% CASE '/admserviceorder' %>
{{ IF message.chat.id == config.telegram_admin.id }}
{{ user = user.switch(args.0) }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }} }
},
{
    "billcpServiceOrder": {
        "service_id": "{{ args.2 }}",
        "callback_data": "/admuser {{ user.id }}",
        "cb_not_enough_money": "/admuser {{ user.id }}",
        "error": "–û–®–ò–ë–ö–ê"
    }
}{{ END }}
<% CASE '/admuserblock' %>
{{ IF message.chat.id == config.telegram_admin.id }}
{{ user = user.switch(args.0) }}
{{ usisbl = user.services.list_for_api('usi', {}) }}
{{ usblall =  us.id(usisbl.user_service_id(usisbl.user_service_id)).block }}
{{ userblocks = user.set('block',1) }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode":"HTML",
        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {{ user.full_name }}\n–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ωüî¥\n–£—Å–ª—É–≥–∞: {{ usisbl.name }}\n–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞üî¥",
        "reply_markup" : {
            "inline_keyboard": [
                       [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/admuser {{ user.id }}"
                    }
                ], [
                     {
                        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
                        "callback_data": "/admusers"
                    },{
                        "text": "–ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/adminmenu"
                    }
                ],
                 [
                    {
                        "text": "üè† –î–æ–º–æ–π",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}
<% CASE '/admuseractiv' %>
{{ IF message.chat.id == config.telegram_admin.id }}
{{ user = user.switch(args.0) }}
{{ usisact = user.services.list_for_api('usi', {}) }}
{{ activ =  us.id(usisact.user_service_id(usisact.user_service_id)).activate }}
{{ useractivs = user.set('block',0) }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode":"HTML",
        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {{ user.full_name }}\n–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ωüü¢\n–£—Å–ª—É–≥–∞: {{ usisact.name }}\n–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞üü¢",
        "reply_markup" : {
            "inline_keyboard": [
                       [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/admuser {{ user.id }}"
                    }
                ], [
                     {
                        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
                        "callback_data": "/admusers"
                    },{
                        "text": "–ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/adminmenu"
                    }
                ],
                 [
                    {
                        "text": "üè† –î–æ–º–æ–π",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}
<% CASE '/admusiblock' %>
{{ IF message.chat.id == config.telegram_admin.id }}
{{ user = user.switch(args.0) }}
{{ usisb = user.services.list_for_api('usi', {}) }}
{{ blocks =  us.id(usisb.user_service_id(usisb.user_service_id)).block }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode":"HTML",
        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {{ user.full_name }}\n–£—Å–ª—É–≥–∞: {{ usisb.name }}\n–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ",
        "reply_markup" : {
            "inline_keyboard": [
                       [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/admuser {{ user.id }}"
                    }
                ], [
                     {
                        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
                        "callback_data": "/admusers"
                    },{
                        "text": "–ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/adminmenu"
                    }
                ],
                 [
                    {
                        "text": "üè† –î–æ–º–æ–π",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}
<% CASE '/admusiactive' %>
{{ IF message.chat.id == config.telegram_admin.id }}
{{ user = user.switch(args.0) }}
{{ usisa = user.services.list_for_api('usi', {}) }}
{{ activ =  us.id(usisa.user_service_id(usisa.user_service_id)).activate }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode":"HTML",
        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {{ user.full_name }}\n–£—Å–ª—É–≥–∞: {{ usisa.name }}\n–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ",
        "reply_markup" : {
            "inline_keyboard": [
                       [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/admuser {{ user.id }}"
                    }
                ], [
                     {
                        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
                        "callback_data": "/users"
                    },{
                        "text": "–ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/admin"
                    }
                ],
                 [
                    {
                        "text": "üè† –î–æ–º–æ–π",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}
<% CASE '/admsmena' %>
{{ IF message.chat.id == config.telegram_admin.id }}
{{ user = user.switch(args.0) }}
{{ ussm = user.services.list_for_api('usi', {}) }}
{{ USE date }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode":"HTML",
        "text": "–°–º–µ–Ω–∞ —Ç–∞—Ä–∏—Ñ–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –ø—Ä–æ–¥–ª–µ–Ω–∏–∏\n\n<b>–¢–µ–∫—É—â–∏–π —Ç–∞—Ä–∏—Ñ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {{ user.full_name }}\n</b>{{ ussm.name }}\n<b>–î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ</b>: {{ date.format(us.expire, '%H:%M %d.%m.%Y') }}  (–ú–°–ö)\n\n<b>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –ø–µ—Ä–∏–æ–¥</b>",
        "reply_markup" : {
            "inline_keyboard": [               
                {{ FOR itemsm IN ref(service.api_price_list).nsort('cost') }}                 
                [
                    {
                        "text": "{{ itemsm.name }}.",
                        "callback_data": "/admchoise {{ ussm.user_id }} 0 {{ itemsm.service_id }}"
                    }
                ],
                {{ END }} 
                  [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/admuser {{ user.id }}"
                    }
                ], [
                   {
                        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
                        "callback_data": "/admusers"
                    }, {
                        "text": "–ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/adminmenu"
                    }
                ],
                 [
                    {
                        "text": "üè† –î–æ–º–æ–π",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}{{ END }} 
<% CASE '/admchoise' %>
{{ IF message.chat.id == config.telegram_admin.id }}
{{ user = user.switch(args.0) }}
{{ itemadmch = user.services.list_for_api('usi', {}) }}
{{ ntch = us.id(itemadmch.user_service_id).set('next', args.2) }}
{{ USE date }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode":"HTML",
        "text": "–¢–∞—Ä–∏—Ñ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ user.full_name }} –∏–∑–º–µ–Ω—ë–Ω. \n\n–°–º–µ–Ω–∞ —Ç–∞—Ä–∏—Ñ–∞ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç {{ date.format(us.expire, '%H:%M %d.%m.%Y') }}",
        "reply_markup" : {
            "inline_keyboard": [ 
                  [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/admuser {{ user.id }}"
                    }
                ],[
                   {
                        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
                        "callback_data": "/admusers"
                    }, {
                        "text": "–ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/adminmenu"
                    }
                ],
                 [
                    {
                        "text": "üè† –î–æ–º–æ–π",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}{{ END }}
<% CASE '/admchoisenull' %>
{{ IF message.chat.id == config.telegram_admin.id }}
{{ user = user.switch(args.0) }}
{{ itemadmchn = user.services.list_for_api('usi', {}) }}
{{ ntchn = us.id(itemadmchn.user_service_id).set('next') }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode":"HTML",
        "text": "–°–º–µ–Ω–∞ —Ç–∞—Ä–∏—Ñ–∞: {{ itemadmchn.name }}\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {{ user.full_name }}\n–û—Ç–º–µ–Ω–µ–Ω–∞.",
        "reply_markup" : {
            "inline_keyboard": [ 
                  [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/admuser {{ user.id }}"
                    }
                ], [
                   {
                        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
                        "callback_data": "/admusers"
                    }, {
                        "text": "–ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/adminmenu"
                    }
                ],
                 [
                    {
                        "text": "üè† –î–æ–º–æ–π",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}
{{ END }}
<% CASE '/admdelete' %>
{{ IF message.chat.id == config.telegram_admin.id }}
{{ user = user.switch(args.0) }}
{{ usisdel = user.services.list_for_api( 'usi', {} ) }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode":"HTML",
        "text": "–£–¥–∞–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∏: {{ usisdel.name }}\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {{ user.full_name }}\n\nü§î <b>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ. –ö–ª—é—á –Ω–µ–ª—å–∑—è –±—É–¥–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å!</b>",
        "reply_markup" : {
            "inline_keyboard": [
                [
                    {
                        "text": "üóë –î–ê, –£–î–ê–õ–ò–¢–¨! üóë",
                        "callback_data": "/admdelete_confirmed {{ user.id }}"
                    }
                ],
                [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/admuser {{ user.id }}"
                    }
                ], [
                   {
                        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
                        "callback_data": "/admusers"
                    }, {
                        "text": "–ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/adminmenu"
                    }
                ],
                 [
                    {
                        "text": "üè† –î–æ–º–æ–π",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}{{ END }}
<% CASE '/admdelete_confirmed' %>
{{ IF message.chat.id == config.telegram_admin.id }}
{{ user = user.switch(args.0) }}
{{ usisdels = user.services.list_for_api( 'usi', {} ) }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }} }
},
{
    "billcpServiceDelete": {
        "usi": "{{ usisdels.user_service_id }}",
        "callback_data": "/admuser {{ user.id }}",
        "error": "–û–®–ò–ë–ö–ê"
    }
}
 {{ END }}
<% CASE '/admpay' %>
{{ IF message.chat.id == config.telegram_admin.id }}
{{ user = user.switch(args.0) }}
{{ FOR itempl IN ref(user.id(args.0)) }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode":"HTML",
        "text": "{{ itempl.full_name }}\n–ë–∞–ª–∞–Ω—Å: {{ itempl.balance }}‚ÇΩ\n\n–ó–∞—á–∏—Å–ª–∏—Ç—å:",
        "reply_markup" : {
            "inline_keyboard": [
                       [
                    {
                        "text": "10‚ÇΩ",
                        "callback_data": "/admpayment {{ itempl.user_id }} 10"
                    }
                ], [
                    {
                        "text": "50‚ÇΩ",
                        "callback_data": "/admpayment {{ itempl.user_id }} 50"
                    }
                ], [
                    {
                        "text": "100‚ÇΩ",
                        "callback_data": "/admpayment {{ itempl.user_id }} 100"
                    }
                ],
                           [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/admuser {{ user.id }}"
                    }
                ], [
                   {
                        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
                        "callback_data": "/admusers"
                    }, {
                        "text": "–ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/adminmenu"
                    }
                ],
                 [
                    {
                        "text": "üè† –î–æ–º–æ–π",
                        "callback_data": "/menu"
                    }
                ]
            ]{{ END }}    
        }
    }
}
{{ END }}  
<% CASE '/admpayb' %>
{{ IF message.chat.id == config.telegram_admin.id }}
{{ user = user.switch(args.0) }}
{{ FOR itemplb IN ref(user.id(args.0)) }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode":"HTML",
        "text": "{{ itemplb.full_name }}\n–ë–æ–Ω—É—Å–æ–≤: {{ itemplb.get_bonus }}\n\n–ó–∞—á–∏—Å–ª–∏—Ç—å –±–æ–Ω—É—Å–æ–≤:",
        "reply_markup" : {
            "inline_keyboard": [
                       [
                    {
                        "text": "10",
                        "callback_data": "/admpaymentb {{ itemplb.user_id }} 10"
                    }
                ], [
                    {
                        "text": "50",
                        "callback_data": "/admpaymentb {{ itemplb.user_id }} 50"
                    }
                ], [
                    {
                        "text": "100",
                        "callback_data": "/admpaymentb {{ itemplb.user_id }} 100"
                    }
                ],
                          [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/admuser {{ user.id }}"
                    }
                ],  [
                    {
                        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
                        "callback_data": "/admusers"
                    },{
                        "text": "–ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/adminmenu"
                    }
                ],
                 [
                    {
                        "text": "üè† –î–æ–º–æ–π",
                        "callback_data": "/menu"
                    }
                ]
            ]{{ END }}    
        }
    }
}
{{ END }}  
<% CASE '/admpayment' %>
{{ IF message.chat.id == config.telegram_admin.id }}
{{ user = user.switch(args.0) }}
{{ pay = user.id(args.0).payment('money', args.1, 'pay_system_id', 'manual') }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode":"HTML",
        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {{ user.full_name }} –Ω–∞—á–∏—Å–ª–µ–Ω–æ {{ args.1 }}‚ÇΩ",
        "reply_markup" : {
            "inline_keyboard": [
                       [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/admuser {{ user.id }}"
                    }
                ], [
                     {
                        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
                        "callback_data": "/admusers"
                    },{
                        "text": "–ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/adminmenu"
                    }
                ],
                 [
                    {
                        "text": "üè† –î–æ–º–æ–π",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}{{ END }} 
<% CASE '/admpaymentb' %>
{{ IF message.chat.id == config.telegram_admin.id }}
{{ user = user.switch( args.0 ) }}
{{ bon = user.add_bonus( args.1 ) }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode":"HTML",
        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {{ userb.full_name }} –Ω–∞—á–∏—Å–ª–µ–Ω–æ {{ args.1 }}  - {{ args.0 }}–±–æ–Ω—É—Å–æ–≤",
        "reply_markup" : {
            "inline_keyboard": [
                       [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/admuser {{ user.id }}"
                    }
                ],  [
                    {
                        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
                        "callback_data": "/admusers"
                    },{
                        "text": "–ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/adminmenu"
                    }
                ],
                 [
                    {
                        "text": "üè† –î–æ–º–æ–π",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}{{ END }}
<% CASE '/payitogo' %>
{{ IF message.chat.id == config.telegram_admin.id }}
{{ sum = 0 }}
{{ arr = ref(user.pays.list_for_api( 'admin', 1, 'limit', 0,  'filter', { 'date' => '2024-%-%'} )) }}
{{ FOR item IN arr }}
{{ sum = sum + item.money }}
{{ END }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode":"HTML",
        "text": "–î–æ—Ö–æ–¥:\n–ò—Ç–æ–≥–æ –∑–∞ 2024 –≥–æ–¥: {{ sum }} —Ä—É–±.",
        "reply_markup" : {
            "inline_keyboard": [
                       [
                    {
                        "text": "–ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/adminmenu"
                    }
                ],
                 [
                    {
                        "text": "üè† –î–æ–º–æ–π",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}{{ END }}
<% CASE '/admpayhistory' %>
{{ IF message.chat.id == config.telegram_admin.id }}
{{ user = user.switch(args.0) }}
{
    "editMessageText": {
        "message_id": {{ message.message_id }},
        "parse_mode":"HTML",
        "text": "–ü–ª–∞—Ç–µ–∂–∏",
        "reply_markup" : {
            "inline_keyboard": [
                {{ FOR itemhis IN ref(user.pays.list_for_api('limit', 10)) }}
                [
                    {
                        "text": "–î–∞—Ç–∞: {{ itemhis.date }}, –°—É–º–º–∞: {{ itemhis.money }} —Ä—É–±.",
                        "callback_data": "/admuser {{ user.id }}"
                    }
                ],
                {{ END }}
                 [
                    {
                        "text": "‚á¶ –ù–∞–∑–∞–¥",
                        "callback_data": "/admuser {{ user.id }}"
                    }
                ], [
                    {
                        "text": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
                        "callback_data": "/admusers"
                    },{
                        "text": "–ê–¥–º–∏–Ω–∫–∞",
                        "callback_data": "/adminmenu"
                    }
                ],
                 [
                    {
                        "text": "üè† –î–æ–º–æ–π",
                        "callback_data": "/menu"
                    }
                ]
            ]
        }
    }
}{{ END }}
<% END %>
